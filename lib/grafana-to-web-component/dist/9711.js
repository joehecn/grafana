(this.webpackChunkGrafanaToWebComponent=this.webpackChunkGrafanaToWebComponent||[]).push([[9711],{34397:(de,k,m)=>{"use strict";m.d(k,{K:()=>G});var S=m(41407),x=m(39953),y=m(82803);const G=({children:t})=>{const d=(0,y.wW)(ae);return x.createElement("div",{className:d.root},t)},ae=t=>({root:(0,S.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:t.spacing(3),minHeight:t.spacing(4)})})},13579:(de,k,m)=>{"use strict";m.d(k,{B:()=>x});var S=m(39953);const x=({grow:y,shrink:G})=>S.createElement("div",{style:{display:"block",flexGrow:y,flexShrink:G}})},56504:(de,k,m)=>{"use strict";m.d(k,{X:()=>se});var S=m(41407),x=m(39953),y=m(82803),G=m(9558),ae=m(28987),t=Object.defineProperty,d=Object.defineProperties,$=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,oe=(f,O,o)=>O in f?t(f,O,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[O]=o,he=(f,O)=>{for(var o in O||(O={}))Ee.call(O,o)&&oe(f,o,O[o]);if(re)for(var o of re(O))ne.call(O,o)&&oe(f,o,O[o]);return f},ve=(f,O)=>d(f,$(O)),fe=(f,O)=>{var o={};for(var i in f)Ee.call(f,i)&&O.indexOf(i)<0&&(o[i]=f[i]);if(f!=null&&re)for(var i of re(f))O.indexOf(i)<0&&ne.call(f,i)&&(o[i]=f[i]);return o};function se(f){var O=f,{label:o}=O,i=fe(O,["label"]);const Y=(0,y.wW)(ge),[F]=(0,x.useState)(()=>Math.random().toString(16).slice(2)),g={SelectContainer:ce,ValueContainer:E,SingleValue:E};return x.createElement("div",{className:Y.root},o&&x.createElement("label",{className:Y.label,htmlFor:F},o,":","\xA0"),x.createElement(G.Ph,ve(he({openMenuOnFocus:!0,inputId:F},i),{components:g})))}const ce=f=>{const{children:O}=f,o=(0,y.wW)(ge);return x.createElement(ae.e,ve(he({},f),{className:(0,S.cx)(f.className,o.container)}),O)},E=f=>{const{className:O,children:o}=f,i=(0,y.wW)(ge);return x.createElement("div",{className:(0,S.cx)(O,i.valueContainer)},o)},ge=f=>({root:(0,S.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,S.css)({color:f.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,S.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,S.css)({display:"flex",alignItems:"center",flex:"initial",color:f.colors.text.secondary,fontSize:12})})},8739:(de,k,m)=>{var S;S={value:!0};var x=m(9744),y=m(41730),G=m(39953),ae=m(86832);function t(I){return I&&typeof I=="object"&&"default"in I?I:{default:I}}var d=t(G);const $={JWT:"jwt",GCE:"gce"},re="Configuration help box",Ee="Configuration drop zone",ne="Configuration text area",oe="Paste JWT button",he="JWT form",ve="JWT button",fe="GCE button",se="Private Key Path Input",ce="Private Key Input",E="Fill JWT info manually",ge="Show private key path input",f="Show private key input",O=["private_key","token_uri","client_email","project_id"],o=({onChange:I,showConfigEditor:T})=>{const[M,J]=G.useState(),[C,w]=G.useState(null),V=y.useTheme2(),q=G.useCallback(Q=>{J(null),w(!0)},[w]),ue=G.useCallback(Q=>{w(null),J(null)},[w]),ee=G.useCallback(Q=>{if(Q.trim()!==""){let H;try{H=JSON.parse(Q)}catch{J("Invalid JWT token")}const B=i(H);B.isValid?(T(),I({privateKey:H.private_key,tokenUri:H.token_uri,clientEmail:H.client_email,projectId:H.project_id})):J(B.error)}},[J,I,T]);return d.default.createElement(d.default.Fragment,null,d.default.createElement(y.Field,{label:"JWT token",invalid:!!M,description:C?"Paste JWT token below":"Upload or paste Google JWT token",error:M},d.default.createElement(d.default.Fragment,null,C!==!0&&d.default.createElement("div",{"data-testid":Ee},y.FileDropzone&&d.default.createElement(y.FileDropzone,{options:{multiple:!1,accept:".json"},readAs:"readAsText",onLoad:Q=>{ee(Q),w(!1)}},d.default.createElement("p",{style:{margin:0,fontSize:`${V.typography.h4.fontSize}`,textAlign:"center"}},"Drop the Google JWT file here",d.default.createElement("br",null),d.default.createElement("br",null),d.default.createElement(y.Button,{fill:"outline"},"Click to browse files")))),C&&d.default.createElement(y.TextArea,{"data-testid":ne,autoFocus:!0,invalid:!!M,placeholder:"Paste Google JWT token here",onBlur:Q=>ee(Q.currentTarget.value),rows:12}))),!C&&d.default.createElement(d.default.Fragment,null,d.default.createElement(y.Button,{"data-testid":oe,type:"button",fill:"outline",style:{color:`${V.colors.primary.text}`},onClick:q},"Paste JWT Token"),d.default.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or"),d.default.createElement(y.Button,{"data-testid":E,type:"button",fill:"outline",style:{color:`${V.colors.primary.text}`},onClick:T},"Fill In JWT Token manually")),C&&M&&d.default.createElement(y.Field,null,d.default.createElement(y.Button,{type:"button",fill:"outline",style:{color:`${V.colors.primary.text}`},onClick:ue},"Upload JWT Token")))},i=I=>{if(!ae.isObject(I))return{isValid:!1,error:"Invalid JWT token"};const T=O.filter(M=>!I[M]);return T.length>0?{isValid:!1,error:`Missing keys: ${T.join(", ")}`}:{isValid:!0}},{SecretFormField:Y}=y.LegacyForms;var F;(function(I){I.PATH="path",I.JWT="jwt"})(F||(F={}));const g=({options:I,onReset:T,onOptionsChange:M})=>{var J;const[C,w]=d.default.useState((Q=>"privateKeyPath"in Q&&Q.privateKeyPath!==""?F.PATH:F.JWT)(I.jsonData)),V=Q=>x.onUpdateDatasourceJsonDataOption({options:I,onOptionsChange:M},Q),q=()=>{C===F.JWT?w(F.PATH):w(F.JWT)},ue=d.default.createElement("span",null,C===F.PATH?d.default.createElement("a",{className:"external-link",onClick:q,"data-testid":f},"Paste private key"):"Paste private key"," ","or \xA0",C===F.JWT?d.default.createElement("a",{className:"external-link",onClick:q,"data-testid":ge},"provide path to private file"):"provide path to private key file"),ee={isConfigured:!!I.secureJsonFields.privateKey,value:((J=I.secureJsonData)===null||J===void 0?void 0:J.privateKey)||"",placeholder:"Enter Private key",onReset:()=>T(),onChange:x.onUpdateDatasourceSecureJsonDataOption({options:I,onOptionsChange:M},"privateKey"),"data-testid":ce};return d.default.createElement("div",{"data-testid":he},d.default.createElement(y.Field,{label:"Project ID"},d.default.createElement(y.Input,{id:"defaultProject",width:60,value:I.jsonData.defaultProject||"",onChange:V("defaultProject")})),d.default.createElement(y.Field,{label:"Client email"},d.default.createElement(y.Input,{width:60,id:"clientEmail",value:I.jsonData.clientEmail||"",onChange:V("clientEmail")})),d.default.createElement(y.Field,{label:"Token URI"},d.default.createElement(y.Input,{width:60,id:"tokenUri",value:I.jsonData.tokenUri||"",onChange:V("tokenUri")})),C===F.PATH&&d.default.createElement(y.Field,{label:"Private key path",description:ue},d.default.createElement(y.Input,{width:60,id:"privateKeyPath",value:I.jsonData.privateKeyPath||"",placeholder:"File location of your private key (e.g. /etc/secrets/gce.pem)",onChange:V("privateKeyPath"),"data-testid":se})),C===F.JWT&&d.default.createElement(d.default.Fragment,null,y.SecretInput?d.default.createElement(y.Field,{label:"Private key",description:ue},d.default.createElement(y.SecretInput,Object.assign({},ee,{width:60}))):d.default.createElement(Y,Object.assign({},ee,{label:"Private key",labelWidth:10,inputWidth:20}))))};function Z(I){const{options:T,onOptionsChange:M,authOptions:J}=I,{jsonData:C,secureJsonFields:w,secureJsonData:V}=T,q=()=>!!(C.clientEmail&&C.defaultProject&&C.tokenUri&&(w&&w.privateKey||C.privateKeyPath));C.authenticationType||(C.authenticationType=$.JWT);const[ue,ee]=G.useState(P(C.authenticationType)),[Q,H]=G.useState(q());return d.default.createElement(d.default.Fragment,null,d.default.createElement(y.FieldSet,{label:"Authentication"},d.default.createElement(y.Field,{label:"Authentication type"},d.default.createElement(y.RadioButtonGroup,{options:J,value:C.authenticationType||$.JWT,onChange:B=>{H(q()),M(Object.assign(Object.assign({},T),{jsonData:Object.assign(Object.assign({},T.jsonData),{authenticationType:B})})),ee(P(B))}}))),ue&&d.default.createElement(y.FieldSet,{label:"JWT Key Details"},Q?d.default.createElement(g,{options:T,onReset:()=>(B=>{const Ie=Object.assign({},V),te=B?Object.assign(Object.assign({},T.jsonData),B):Object.assign({},T.jsonData);delete te.clientEmail,delete te.defaultProject,delete te.tokenUri,delete te.privateKeyPath,delete Ie.privateKey,ee(!0),H(!1),M(Object.assign(Object.assign({},T),{secureJsonFields:Object.assign(Object.assign({},T.secureJsonFields),{privateKey:!1}),secureJsonData:Ie,jsonData:te}))})(),onOptionsChange:M}):d.default.createElement(o,{showConfigEditor:()=>{H(!0)},onChange:B=>{M(Object.assign(Object.assign({},T),{secureJsonFields:Object.assign(Object.assign({},w),{privateKey:!0}),secureJsonData:Object.assign(Object.assign({},V),{privateKey:B.privateKey}),jsonData:Object.assign(Object.assign({},C),{clientEmail:B.clientEmail,defaultProject:B.projectId,tokenUri:B.tokenUri})}))}})," "),C.authenticationType===$.GCE&&d.default.createElement(y.Field,{label:"Default project"},d.default.createElement(y.Input,{id:"defaultProject",width:60,value:T.jsonData.defaultProject||"",onChange:x.onUpdateDatasourceJsonDataOption(I,"defaultProject")})))}const P=I=>I===$.JWT||I===void 0,Se=[{label:"Google JWT File",value:$.JWT,ariaLabel:ve},{label:"GCE Default Service Account",value:$.GCE,ariaLabel:fe}];S=Z,k.ConnectionConfig=I=>{const{options:{jsonData:T}}=I;T.authenticationType||(T.authenticationType=$.JWT);const M=T.authenticationType===$.JWT||T.authenticationType===void 0;return d.default.createElement(d.default.Fragment,null,d.default.createElement(Z,Object.assign({authOptions:Se},I)),d.default.createElement("div",{className:"grafana-info-box",style:{marginTop:"16px"},"data-testid":re},d.default.createElement("p",null,"Don\u2019t know how to get a service account key file or create a service account? Read more"," ",d.default.createElement("a",{className:"external-link",target:"_blank",rel:"noopener noreferrer",href:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/google-authentication/"},"in the documentation."))),!M&&d.default.createElement(y.Alert,{title:"",severity:"info"},"Verify GCE default service account by clicking Save & Test"))},S=Se,S=$,S=o,S=g},36721:(de,k,m)=>{"use strict";de.exports=m(8739)},9711:(de,k,m)=>{"use strict";m.r(k),m.d(k,{plugin:()=>pa});var S=m(86832),x=m(54721),y=m(36316),G=m(77014),ae=m(41407),t=m(39953);class d extends t.PureComponent{render(){return t.createElement("div",null,t.createElement("h2",null,"Cloud Monitoring alias patterns"),t.createElement("div",null,t.createElement("p",null,"Format the legend keys any way you want by using alias patterns. Format the legend keys any way you want by using alias patterns."),"Example:",t.createElement("code",null,"{{metric.name}} - {{metric.label.instance_name}}"),t.createElement("br",null),"Result: \xA0\xA0",t.createElement("code",null,"cpu/usage_time - server1-europe-west-1"),t.createElement("br",null),t.createElement("br",null),t.createElement("span",null,"Patterns:"),t.createElement("br",null),t.createElement("ul",{className:(0,ae.css)`
              list-style: none;
            `},t.createElement("li",null,t.createElement("code",null,"{{metric.type}}")," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"),t.createElement("li",null,t.createElement("code",null,"{{metric.name}}")," = name part of metric e.g. instance/cpu/usage_time"),t.createElement("li",null,t.createElement("code",null,"{{metric.service}}")," = service part of metric e.g. compute"),t.createElement("li",null,t.createElement("code",null,"{{metric.label.label_name}}")," = Metric label metadata e.g. metric.label.instance_name"),t.createElement("li",null,t.createElement("code",null,"{{resource.label.label_name}}")," = Resource label metadata e.g. resource.label.zone"),t.createElement("li",null,t.createElement("code",null,"{{metadata.system_labels.name}}")," = Meta data system labels e.g. metadata.system_labels.name. For this to work, the needs to be included in the group by"),t.createElement("li",null,t.createElement("code",null,"{{metadata.user_labels.name}}")," = Meta data user labels e.g. metadata.user_labels.name. For this to work, the needs to be included in the group by"),t.createElement("li",null,t.createElement("code",null,"{{bucket}}")," = bucket boundary for distribution metrics when using a heatmap in Grafana"),t.createElement("li",null,t.createElement("code",null,"{{project}}")," = The project name that was specified in the query editor"),t.createElement("li",null,t.createElement("code",null,"{{service}}")," = The service id that was specified in the SLO query editor"),t.createElement("li",null,t.createElement("code",null,"{{slo}}")," = The SLO id that was specified in the SLO query editor"),t.createElement("li",null,t.createElement("code",null,"{{selector}}")," = The Selector function that was specified in the SLO query editor"))))}}var $=m(17613),re=m(27770),Ee=m(36721),ne=m(72639),oe=m(68832),he=m(47169),ve=m(50820);class fe extends t.PureComponent{constructor(){super(...arguments),this.handleOnOptionsChange=e=>{(e.jsonData.privateKeyPath||e.secureJsonFields.privateKey)&&(0,ne.ff)("grafana_cloud_monitoring_config_changed",{authenticationType:"JWT",privateKey:e.secureJsonFields.privateKey,privateKeyPath:!!e.jsonData.privateKeyPath}),this.props.onOptionsChange(e)}}render(){const{options:e,onOptionsChange:a}=this.props;return t.createElement(t.Fragment,null,t.createElement($.j,{dataSourceName:"Google Cloud Monitoring",docsLink:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/",hasRequiredFields:!0}),t.createElement(oe.i,null),t.createElement(Ee.ConnectionConfig,{...this.props,onOptionsChange:this.handleOnOptionsChange}),ve.config.secureSocksDSProxyEnabled&&t.createElement(t.Fragment,null,t.createElement(oe.i,null),t.createElement(re.K,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:e.jsonData.enableSecureSocksProxy!==void 0},t.createElement(he.i,{options:e,onOptionsChange:a}))))}}var se=m(99456),ce=m(91386),E=(n=>(n.ANNOTATION="annotation",n.PROMQL="promQL",n.SLO="slo",n.TIME_SERIES_LIST="timeSeriesList",n.TIME_SERIES_QUERY="timeSeriesQuery",n))(E||{});const ge={filters:[],groupBys:[],secondaryGroupBys:[]};var f=(n=>(n.Delta="delta",n.None="none",n.Rate="rate",n))(f||{});const O={filters:[],groupBys:[]};var o=(n=>(n.CUMULATIVE="CUMULATIVE",n.DELTA="DELTA",n.GAUGE="GAUGE",n.METRIC_KIND_UNSPECIFIED="METRIC_KIND_UNSPECIFIED",n))(o||{}),i=(n=>(n.BOOL="BOOL",n.DISTRIBUTION="DISTRIBUTION",n.DOUBLE="DOUBLE",n.INT64="INT64",n.MONEY="MONEY",n.STRING="STRING",n.VALUE_TYPE_UNSPECIFIED="VALUE_TYPE_UNSPECIFIED",n))(i||{}),Y=(n=>(n.ALIGN_COUNT="ALIGN_COUNT",n.ALIGN_COUNT_FALSE="ALIGN_COUNT_FALSE",n.ALIGN_COUNT_TRUE="ALIGN_COUNT_TRUE",n.ALIGN_DELTA="ALIGN_DELTA",n.ALIGN_FRACTION_TRUE="ALIGN_FRACTION_TRUE",n.ALIGN_INTERPOLATE="ALIGN_INTERPOLATE",n.ALIGN_MAX="ALIGN_MAX",n.ALIGN_MEAN="ALIGN_MEAN",n.ALIGN_MIN="ALIGN_MIN",n.ALIGN_NEXT_OLDER="ALIGN_NEXT_OLDER",n.ALIGN_NONE="ALIGN_NONE",n.ALIGN_PERCENTILE_05="ALIGN_PERCENTILE_05",n.ALIGN_PERCENTILE_50="ALIGN_PERCENTILE_50",n.ALIGN_PERCENTILE_95="ALIGN_PERCENTILE_95",n.ALIGN_PERCENTILE_99="ALIGN_PERCENTILE_99",n.ALIGN_PERCENT_CHANGE="ALIGN_PERCENT_CHANGE",n.ALIGN_RATE="ALIGN_RATE",n.ALIGN_STDDEV="ALIGN_STDDEV",n.ALIGN_SUM="ALIGN_SUM",n))(Y||{});const F={filters:[]};var g=(n=>(n.Aggregations="aggregations",n.Aligners="aligners",n.AlignmentPeriods="alignmentPeriods",n.DefaultProject="defaultProject",n.LabelKeys="labelKeys",n.LabelValues="labelValues",n.MetricTypes="metricTypes",n.Projects="projects",n.ResourceTypes="resourceTypes",n.SLO="slo",n.SLOServices="sloServices",n.Selectors="selectors",n.Services="services",n))(g||{}),Z=m(87355),P=m(46101),Se=m(68421),I=m(38637),T=m(9558);function M({refId:n,projectName:e,datasource:a,onChange:r,templateVariableOptions:s}){const[l,c]=(0,t.useState)([]);(0,t.useEffect)(()=>{a.getProjects().then(p=>c(p))},[a]);const u=(0,t.useMemo)(()=>[{label:"Template Variables",options:s},...l],[l,s]);return t.createElement(P.S,{label:"Project"},t.createElement(T.Ph,{width:"auto",allowCustomValue:!0,formatCreateLabel:p=>`Use project: ${p}`,onChange:({value:p})=>r(p),options:u,value:{value:e,label:e},placeholder:"Select Project",inputId:`${n}-project`}))}const J=n=>({projectName:n.getDefaultProject(),expr:"",step:"10s"});function C({refId:n,query:e,datasource:a,onChange:r,variableOptionGroup:s,onRunQuery:l}){function c(u){u.key==="Enter"&&u.shiftKey&&(l(),u.preventDefault(),u.stopPropagation())}return t.createElement(t.Fragment,null,t.createElement(Z.p,null,t.createElement(M,{refId:n,templateVariableOptions:s.options,projectName:e.projectName,datasource:a,onChange:u=>r({...e,projectName:u})}),t.createElement(Se.K,{name:"Query",className:"slate-query-field",value:e.expr,rows:10,placeholder:"Enter a Cloud Monitoring Prometheus query (Run with Shift+Enter)",onBlur:l,onKeyDown:c,onChange:u=>r({...e,expr:u.currentTarget.value})}),t.createElement(P.S,{label:"Min step",tooltip:"Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: 10s)"},t.createElement(I.I,{type:"string",placeholder:"auto",onChange:u=>r({...e,step:u.currentTarget.value}),onKeyDown:c,value:e.step??""}))))}var w=m(34397),V=m(56504),q=m(13579);const ue=71,ee=19,Q=14,H=28,B=[{text:"none",value:"ALIGN_NONE",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION,i.STRING,i.VALUE_TYPE_UNSPECIFIED,i.BOOL],metricKinds:[o.GAUGE]},{text:"delta",value:"ALIGN_DELTA",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.CUMULATIVE,o.DELTA]},{text:"rate",value:"ALIGN_RATE",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.CUMULATIVE,o.DELTA]},{text:"interpolate",value:"ALIGN_INTERPOLATE",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE]},{text:"next older",value:"ALIGN_NEXT_OLDER",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION,i.STRING,i.VALUE_TYPE_UNSPECIFIED,i.BOOL],metricKinds:[o.GAUGE]},{text:"min",value:"ALIGN_MIN",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE,o.DELTA]},{text:"max",value:"ALIGN_MAX",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE,o.DELTA]},{text:"mean",value:"ALIGN_MEAN",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE,o.DELTA]},{text:"count",value:"ALIGN_COUNT",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.BOOL],metricKinds:[o.GAUGE,o.DELTA]},{text:"sum",value:"ALIGN_SUM",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA]},{text:"stddev",value:"ALIGN_STDDEV",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE,o.DELTA]},{text:"count true",value:"ALIGN_COUNT_TRUE",valueTypes:[i.BOOL],metricKinds:[o.GAUGE]},{text:"count false",value:"ALIGN_COUNT_FALSE",valueTypes:[i.BOOL],metricKinds:[o.GAUGE]},{text:"fraction true",value:"ALIGN_FRACTION_TRUE",valueTypes:[i.BOOL],metricKinds:[o.GAUGE]},{text:"percentile 99",value:"ALIGN_PERCENTILE_99",valueTypes:[i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA]},{text:"percentile 95",value:"ALIGN_PERCENTILE_95",valueTypes:[i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA]},{text:"percentile 50",value:"ALIGN_PERCENTILE_50",valueTypes:[i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA]},{text:"percentile 05",value:"ALIGN_PERCENTILE_05",valueTypes:[i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA]},{text:"percent change",value:"ALIGN_PERCENT_CHANGE",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE,o.DELTA]}],Ie=[{text:"none",value:"REDUCE_NONE",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION,i.BOOL,i.STRING],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE,o.METRIC_KIND_UNSPECIFIED]},{text:"mean",value:"REDUCE_MEAN",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE]},{text:"min",value:"REDUCE_MIN",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE,o.METRIC_KIND_UNSPECIFIED]},{text:"max",value:"REDUCE_MAX",valueTypes:[i.INT64,i.DOUBLE,i.MONEY],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE,o.METRIC_KIND_UNSPECIFIED]},{text:"sum",value:"REDUCE_SUM",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE,o.METRIC_KIND_UNSPECIFIED]},{text:"std. dev.",value:"REDUCE_STDDEV",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE,o.METRIC_KIND_UNSPECIFIED]},{text:"count",value:"REDUCE_COUNT",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION,i.BOOL,i.STRING],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE]},{text:"count true",value:"REDUCE_COUNT_TRUE",valueTypes:[i.BOOL],metricKinds:[o.GAUGE,o.DELTA]},{text:"count false",value:"REDUCE_COUNT_FALSE",valueTypes:[i.BOOL],metricKinds:[o.GAUGE,o.DELTA]},{text:"99th percentile",value:"REDUCE_PERCENTILE_99",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE]},{text:"95th percentile",value:"REDUCE_PERCENTILE_95",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE]},{text:"50th percentile",value:"REDUCE_PERCENTILE_50",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE]},{text:"5th percentile",value:"REDUCE_PERCENTILE_05",valueTypes:[i.INT64,i.DOUBLE,i.MONEY,i.DISTRIBUTION],metricKinds:[o.GAUGE,o.DELTA,o.CUMULATIVE]}],te=[{text:"grafana auto",value:"grafana-auto"},{text:"stackdriver auto",value:"stackdriver-auto",hidden:!0},{text:"cloud monitoring auto",value:"cloud-monitoring-auto"},{text:"1m",value:"+60s"},{text:"2m",value:"+120s"},{text:"5m",value:"+300s"},{text:"10m",value:"+600s"},{text:"30m",value:"+1800s"},{text:"1h",value:"+3600s"},{text:"3h",value:"+7200s"},{text:"6h",value:"+21600s"},{text:"1d",value:"+86400s"},{text:"3d",value:"+259200s"},{text:"1w",value:"+604800s"}],ct=[{text:"auto",value:"auto"},{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"1d",value:"1d"},{text:"3d",value:"3d"},{text:"1w",value:"1w"}],ut=[{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"24h",value:"24h"},{text:"72h",value:"72h"}],Ke=["metadata.system_labels.cloud_account","metadata.system_labels.name","metadata.system_labels.region","metadata.system_labels.state","metadata.system_labels.instance_group","metadata.system_labels.node_name","metadata.system_labels.service_name","metadata.system_labels.top_level_controller_type","metadata.system_labels.top_level_controller_name","metadata.system_labels.container_image"],Pe="select_slo_burn_rate",Re=[{label:"SLI Value",value:"select_slo_health"},{label:"SLO Compliance",value:"select_slo_compliance"},{label:"SLO Error Budget Remaining",value:"select_slo_budget_fraction"},{label:"SLO Burn Rate",value:Pe}],mt=[{label:"Builder",value:E.TIME_SERIES_LIST},{label:"MQL",value:E.TIME_SERIES_QUERY},{label:"Service Level Objectives (SLO)",value:E.SLO},{label:"PromQL",value:E.PROMQL}],pt=n=>{const{query:e,onChange:a,onRunQuery:r}=n,{queryType:s}=e;return t.createElement(w.K,null,t.createElement(V.X,{label:"Query type",options:mt,value:s,onChange:({value:l})=>{a({...e,queryType:l}),r()}}),t.createElement(q.B,{grow:1}))};var Ne=m(60481),dt=m(81626),X=m(79059);const Fe=n=>(0,S.uniqBy)(n,"service"),_e=(n,e)=>n.filter(a=>a.service===e),Me=(n,e,a,r)=>{const s=_e(n,r).map(p=>({value:p.type,name:p.displayName})),l=s.some(p=>p.value===a),c=s.length?s[0].value:"";return{metricTypes:s,selectedMetricType:l?e:c}},we=(n,e,a)=>(a&&a===f.Rate&&(e=o.GAUGE),n?B.filter(r=>r.valueTypes.indexOf(n)!==-1&&r.metricKinds.indexOf(e)!==-1):[]),Ve=(n,e)=>e?Ie.filter(a=>a.valueTypes.indexOf(n)!==-1&&a.metricKinds.indexOf(e)!==-1):[],$e=async(n,e,a)=>{const r="handleLabelKeysQuery",s=await n.getLabels(e,r,a);return[...Object.keys(s),...Ke]},Ue=(n=i.DOUBLE,e=o.GAUGE,a=Y.ALIGN_MEAN,r)=>{const s=(0,X.J)(),l=we(n,e,r).map(c=>({...c,label:c.text}));return l.some(c=>c.value===s.replace(a))||(a=l.length>0?l[0].value:Y.ALIGN_MEAN),{alignOptions:l,perSeriesAligner:a}},Je=n=>{const e=n.reduce((a,r)=>{const s=r.split(".").map(S.startCase),l=(s.length===2?s:(0,S.initial)(s)).join(" "),c={value:r,label:r};return a[l]?a[l]=[...a[l],c]:a[l]=[c],a},{});return Object.entries(e).map(([a,r])=>({label:a,options:r,expanded:!0}),[])},Et=n=>(0,S.chunk)(n,4).map(([e,a,r,s="AND"])=>({key:e,operator:a,value:r,condition:s})),We=(n,e)=>{const{perSeriesAligner:a,alignmentPeriod:r}=n;if(!r||!a)return"";const s=B.find(u=>u.value===e.templateSrv.replace(a)),l=parseInt(r,10);return`${dt.secondsToHms(l)} interval (${s?.text??""})`},ke=n=>{const e=n?.filters?.findIndex(r=>r==="metric.type");return n?.filters?.[e+2]||""},Ye=(n,e)=>{if(!n.filters)return n.filters=["metric.type","=",e],n;const a=n?.filters?.findIndex(r=>r==="metric.type");return a===-1?n.filters.push("metric.type","=",e):n.filters[a+2]=e,n},je=({refId:n,value:e="",onChange:a})=>{const[r,s]=(0,t.useState)(e??""),l=(0,S.debounce)(a,1e3);return a=c=>{s(c.target.value),l(c.target.value)},t.createElement(P.S,{label:"Alias by"},t.createElement(I.I,{id:`${n}-alias-by`,value:r,onChange:a}))},ht=({refId:n,current:e,templateVariableOptions:a,onChange:r})=>{const s=ut.map(c=>({...c,label:c.text}));e&&!s.find(c=>c.value===e)&&s.push({label:e,text:e,value:e,hidden:!1});const l=s.filter(c=>!c.hidden);return t.createElement(P.S,{label:"Lookback period",htmlFor:`${n}-lookback-period`},t.createElement(T.Ph,{inputId:`${n}-lookback-period`,width:"auto",allowCustomValue:!0,value:[...s,...a].find(c=>c.value===e),options:[{label:"Template Variables",options:a},{label:"Predefined periods",expanded:!0,options:l}],onChange:({value:c})=>r(c)}))};function xe({inputId:n,templateVariableOptions:e,onChange:a,current:r,disabled:s,aligmentPeriods:l}){const c=(0,t.useMemo)(()=>l.map(p=>({...p,label:p.text})),[l]),u=(0,t.useMemo)(()=>c.filter(p=>!p.hidden),[c]);return t.createElement(T.Ph,{width:"auto",onChange:({value:p})=>a(p),value:[...c,...e].find(p=>p.value===r),options:[{label:"Template Variables",options:e},{label:"Aggregations",expanded:!0,options:u}],placeholder:"Select Period",inputId:n,disabled:s,allowCustomValue:!0,menuPlacement:"top"})}const vt=({refId:n,query:e,templateVariableOptions:a,onChange:r,datasource:s})=>{const[l,c]=(0,t.useState)([]),{projectName:u,serviceId:p}=e;return(0,t.useEffect)(()=>{!u||!p||s.getServiceLevelObjectives(u,p).then(h=>{c([{label:"Template Variables",options:a},...h])})},[s,u,p,a]),t.createElement(P.S,{label:"SLO"},t.createElement(T.Ph,{inputId:`${n}-slo`,width:"auto",allowCustomValue:!0,value:e?.sloId&&{value:e?.sloId,label:e?.sloName||e?.sloId},placeholder:"Select SLO",options:l,onChange:async({value:h="",label:A=""})=>{const L=(await s.getServiceLevelObjectives(u,p)).find(({value:U})=>U===s.templateSrv.replace(h));r({...e,sloId:h,sloName:A,goal:L?.goal})}}))},gt=({refId:n,query:e,templateVariableOptions:a,onChange:r,datasource:s})=>t.createElement(P.S,{label:"Selector",htmlFor:`${n}-slo-selector`},t.createElement(T.Ph,{inputId:`${n}-slo-selector`,width:"auto",allowCustomValue:!0,value:[...Re,...a].find(l=>l.value===e?.selectorName),options:[{label:"Template Variables",options:a},...Re],onChange:({value:l})=>r({...e,selectorName:l??""})})),Tt=({refId:n,query:e,templateVariableOptions:a,onChange:r,datasource:s})=>{const[l,c]=(0,t.useState)([]),{projectName:u}=e;return(0,t.useEffect)(()=>{u&&s.getSLOServices(u).then(p=>{c([{label:"Template Variables",options:a},...p])})},[s,u,a]),t.createElement(P.S,{label:"Service"},t.createElement(T.Ph,{inputId:`${n}-slo-service`,width:"auto",allowCustomValue:!0,value:e?.serviceId&&{value:e?.serviceId,label:e?.serviceName||e?.serviceId},placeholder:"Select service",options:l,onChange:({value:p="",label:h=""})=>r({...e,serviceId:p,serviceName:h,sloId:""})}))},yt=n=>({projectName:n.getDefaultProject(),alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:Y.ALIGN_MEAN,aliasBy:"",selectorName:"select_slo_health",serviceId:"",serviceName:"",sloId:"",sloName:"",lookbackPeriod:""});function ft({refId:n,query:e,datasource:a,onChange:r,variableOptionGroup:s,customMetaData:l,aliasBy:c,onChangeAliasBy:u}){const p=(0,t.useMemo)(()=>We(l,a),[l,a]);return t.createElement(t.Fragment,null,t.createElement(Z.p,null,t.createElement(M,{refId:n,templateVariableOptions:s.options,projectName:e.projectName,datasource:a,onChange:h=>r({...e,projectName:h})}),t.createElement(Tt,{refId:n,datasource:a,templateVariableOptions:s.options,query:e,onChange:r}),t.createElement(vt,{refId:n,datasource:a,templateVariableOptions:s.options,query:e,onChange:r}),t.createElement(gt,{refId:n,datasource:a,templateVariableOptions:s.options,query:e,onChange:r}),e.selectorName===Pe&&t.createElement(ht,{refId:n,onChange:h=>r({...e,lookbackPeriod:h}),current:e.lookbackPeriod,templateVariableOptions:s.options}),t.createElement(Ne.s,null,t.createElement(P.S,{label:"Alignment period",tooltip:p},t.createElement(xe,{inputId:`${n}-alignment-period`,templateVariableOptions:s.options,current:e.alignmentPeriod,onChange:h=>r({...e,alignmentPeriod:h}),aligmentPeriods:te}))),t.createElement(je,{refId:n,value:c,onChange:u})))}const St=n=>{const e=It(n),a=Lt(e,n);return t.createElement(P.S,{label:"Group by function","data-testid":"cloud-monitoring-aggregation"},t.createElement(T.Ph,{width:"auto",onChange:({value:r})=>n.onChange(r),value:a,options:[{label:"Template Variables",options:n.templateVariableOptions},{label:"Aggregations",expanded:!0,options:e}],placeholder:"Select Reducer",inputId:`${n.refId}-group-by-function`,menuPlacement:"top"}))},It=({metricDescriptor:n})=>{const e=n?.valueType,a=n?.metricKind;return(0,t.useMemo)(()=>!e||!a?[]:Ve(e,a).map(r=>({...r,label:r.text})),[e,a])},Lt=(n,e)=>(0,t.useMemo)(()=>[...n,...e.templateVariableOptions].find(r=>r.value===e.crossSeriesReducer),[n,e.crossSeriesReducer,e.templateVariableOptions]),Nt=({refId:n,labels:e=[],query:a,onChange:r,variableOptionGroup:s,metricDescriptor:l})=>{const c=(0,t.useMemo)(()=>[s,...Je([...e,...Ke])],[e,s]);return t.createElement(Ne.s,null,t.createElement(P.S,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series."},t.createElement(T.NU,{inputId:`${n}-group-by`,width:"auto",placeholder:"Choose label",options:c,value:a.groupBys??[],onChange:u=>{r({...a,groupBys:u.map(p=>p.value)})},menuPlacement:"top"})),t.createElement(St,{metricDescriptor:l,templateVariableOptions:s.options,crossSeriesReducer:a.crossSeriesReducer,groupBys:a.groupBys??[],onChange:u=>r({...a,crossSeriesReducer:u}),refId:n}))},bt=({inputId:n,query:e,templateVariableOptions:a,onChange:r,metricDescriptor:s,preprocessor:l})=>{const{perSeriesAligner:c}=e;let{valueType:u,metricKind:p}=s||{};const{perSeriesAligner:h,alignOptions:A}=(0,t.useMemo)(()=>Ue(u,p,c,l),[u,p,c,l]);return t.createElement(T.Ph,{onChange:({value:v})=>r({...e,perSeriesAligner:v}),value:[...A,...a].find(v=>v.value===h),options:[{label:"Template Variables",options:a},{label:"Alignment options",expanded:!0,options:A}],placeholder:"Select Alignment",inputId:n,menuPlacement:"top"})},Ot=({refId:n,templateVariableOptions:e,onChange:a,query:r,customMetaData:s,datasource:l,metricDescriptor:c,preprocessor:u})=>{const p=(0,t.useMemo)(()=>We(s,l),[s,l]);return t.createElement(Ne.s,null,t.createElement(P.S,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result."},t.createElement(bt,{inputId:`${n}-alignment-function`,templateVariableOptions:e,query:r,onChange:h=>a({...r,...h}),metricDescriptor:c,preprocessor:u})),t.createElement(P.S,{label:"Alignment period",tooltip:p},t.createElement(xe,{inputId:`${n}-alignment-period`,templateVariableOptions:e,current:r.alignmentPeriod,onChange:h=>a({...r,alignmentPeriod:h}),aligmentPeriods:te})))};var At=m(81803),Ct=m(46298),He=m(12223);const Ge="=",ze="AND",Dt=n=>n.flatMap(({key:e,operator:a,value:r,condition:s})=>[e,a,r,s]).slice(0,-1),Pt=["=","!=","=~","!=~"].map(se.E),Xe=["metric.type"],Rt=({labels:n={},filters:e,onChange:a,variableOptionGroup:r})=>{const s=Et(e),l=s.filter(({key:v})=>!Xe.includes(v)),c=s.filter(({key:v})=>Xe.includes(v)),u=(0,t.useMemo)(()=>[r,...Je(Object.keys(n))],[n,r]),p=({key:v="",value:L=""})=>{u.some(b=>b.options?u.some(me=>me.label===v):b.label===v)||u.push({label:v,value:v});const j=n.hasOwnProperty(v)?[r,...n[v].map(se.E)]:[r];return j.some(b=>b.label===L)||j.push({label:L,value:L}),{options:u,valueOptions:j}},h=v=>{const L=v.concat(c).map(({key:U,operator:j,value:K,condition:b})=>({key:U||"",operator:j||Ge,value:K||"",condition:b||ze}));a(Dt(L))},A=(v,L,U)=>{const{key:j="",operator:K=Ge,value:b="",condition:me=ze}=v,{options:Te,valueOptions:Le}=p(v);return t.createElement(He.Lh,{spacing:"xs",width:"auto"},t.createElement(T.Ph,{"aria-label":"Filter label key",formatCreateLabel:_=>`Use label key: ${_}`,allowCustomValue:!0,value:j,options:Te,onChange:({value:_=""})=>L({key:_,operator:K,value:b,condition:me})}),t.createElement(T.Ph,{value:K,options:Pt,onChange:({value:_=Ge})=>L({key:j,operator:_,value:b,condition:me})}),t.createElement(T.Ph,{"aria-label":"Filter label value",placeholder:"add filter value",formatCreateLabel:_=>`Use label value: ${_}`,allowCustomValue:!0,value:b,options:Le,onChange:({value:_=""})=>L({key:j,operator:K,value:_,condition:me})}),t.createElement(At._,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:U,type:"button"}))};return t.createElement(Z.p,null,t.createElement(P.S,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression."},t.createElement(Ct.k,{items:l,renderItem:A,onChange:h})))},Mt=()=>t.createElement("div",{className:"gf-form grafana-info-box alert-info"},t.createElement("div",null,t.createElement("h5",null,"Annotation Query Format"),t.createElement("p",null,"An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is important to limit the number of rows returned."," "),t.createElement("p",null,"The Title and Text fields support templating and can use data returned from the query. For example, the Title field could have the following text:"),t.createElement("code",null,"{{metric.type}}"," has value: ","{{metric.value}}"),t.createElement("p",null,"Example Result: ",t.createElement("code",null,"monitoring.googleapis.com/uptime_check/http_status has this value: 502")),t.createElement("span",null,"Patterns:"),t.createElement("p",null,t.createElement("code",null,"{{metric.value}}")," = value of the metric/point"),t.createElement("p",null,t.createElement("code",null,"{{metric.type}}")," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"),t.createElement("p",null,t.createElement("code",null,"{{metric.name}}")," = name part of metric e.g. instance/cpu/usage_time"),t.createElement("p",null,t.createElement("code",null,"{{metric.service}}")," = service part of metric e.g. compute"),t.createElement("p",null,t.createElement("code",null,"{{metric.label.label_name}}")," = Metric label metadata e.g. metric.label.instance_name"),t.createElement("p",null,t.createElement("code",null,"{{resource.label.label_name}}")," = Resource label metadata e.g. resource.label.zone")));var Ut=m(27366),jt=m(26286);const xt=({refId:n,onChange:e,graphPeriod:a,variableOptionGroup:r})=>t.createElement(Z.p,null,t.createElement(P.S,{label:"Graph period",htmlFor:`${n}-graph-period`,tooltip:t.createElement(t.Fragment,null,"Set ",t.createElement("code",null,"graph_period")," which forces a preferred period between points. Automatically set to the current interval if left blank.")},t.createElement(He.Lh,null,t.createElement(jt.r,{"data-testid":`${n}-switch-graph-period`,value:a!=="disabled",onChange:s=>e(s.currentTarget.checked?"":"disabled")}),t.createElement(xe,{inputId:`${n}-graph-period`,templateVariableOptions:r.options,current:a,onChange:e,disabled:a==="disabled",aligmentPeriods:ct}))));function Gt({query:n,onChange:e,onRunQuery:a}){const r=s=>{s.key==="Enter"&&(s.shiftKey||s.ctrlKey)&&(s.preventDefault(),a())};return t.createElement(t.Fragment,null,t.createElement(Se.K,{name:"Query",className:"slate-query-field",value:n,rows:10,placeholder:"Enter a Cloud Monitoring MQL query (Run with Shift+Enter)",onBlur:a,onChange:s=>e(s.currentTarget.value),onKeyDown:r}))}var Qt=m(97368),Bt=m.n(Qt),Ze=m(82803),Kt=m(15246),Ft=m(20454);const qe={label:"None",value:f.None},_t=({query:n,metricDescriptor:e,onChange:a})=>{const r=wt(e);return t.createElement(P.S,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metric's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series"},t.createElement(Ft.S,{onChange:s=>{const{perSeriesAligner:l}=n,{valueType:c,metricKind:u}=e??{},{perSeriesAligner:p}=Ue(c,u,l,s);a({...n,preprocessor:s,perSeriesAligner:p})},value:n.preprocessor??f.None,options:r}))},wt=n=>{const e=n?.metricKind,a=n?.valueType;return(0,t.useMemo)(()=>{if(!e||e===o.GAUGE||a===i.DISTRIBUTION)return[qe];const r=[qe,{label:"Rate",value:f.Rate,description:"Data points are aligned and converted to a rate per time series"}];return e===o.CUMULATIVE?[...r,{label:"Delta",value:f.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:r},[e,a])};function Vt({refId:n,onChange:e,datasource:a,query:r,variableOptionGroup:s,customMetaData:l,aliasBy:c,onChangeAliasBy:u}){const[p,h]=(0,t.useState)({}),[A,v]=(0,t.useState)([]),[L,U]=(0,t.useState)(),[j,K]=(0,t.useState)([]),[b,me]=(0,t.useState)([]),[Te,Le]=(0,t.useState)(""),[_,da]=(0,t.useState)({...a.timeSrv.timeRange()});(N=>{_!==null&&(_.raw.from.toString()!==N.raw.from.toString()||_.raw.to.toString()!==N.raw.to.toString())&&da({...N})})(a.timeSrv.timeRange());const Ea=(0,Ze.l4)(),be=(0,Kt.D)(Ea),Oe=(0,Ze.wW)($t),{projectName:le,groupBys:lt,crossSeriesReducer:it}=r,ie=ke(r),{templateSrv:Ae}=a,Ce=(0,t.useCallback)((N,R)=>N.find(D=>D.type===Ae.replace(R)),[Ae]);(0,t.useEffect)(()=>{le&&ie&&a.getLabels(ie,n,le,{groupBys:lt,crossSeriesReducer:it},_).then(N=>h(N))},[a,lt,ie,le,n,it,_]),(0,t.useEffect)(()=>{(async()=>{if(le){const R=await a.getMetricTypes(le);(0,ne.ff)("cloud-monitoring-metric-descriptors-loaded",{count:R.length});const D=va(R);v(R),me(D)}})()},[a,le,Oe,be.optionDescription]),(0,t.useEffect)(()=>{const R=(ye=>{const De=Ce(ye,ie);return De?ye.filter(pe=>pe.service===De.service).map(pe=>({service:pe.service,value:pe.type,label:pe.displayName,component:function(){return t.createElement("div",null,t.createElement("div",{className:Oe},pe.type),t.createElement("div",{className:be.optionDescription},pe.description))}})):[]})(A),D=R.length>0?R[0].service:"",z=Ce(A,ie);U(z),K(R),Le(D)},[A,Ce,ie,Oe,be.optionDescription]);const ha=({value:N})=>{const R=A.filter(D=>D.service===Ae.replace(N)).map(D=>({service:D.service,value:D.type,label:D.displayName,description:D.description}));r.filters=[],R.length>0&&!R.some(D=>D.value===Ae.replace(ie))?(ot(R[0]),Le(N),K(R)):(Le(N),K(R))},va=N=>{const R=N.map(D=>({value:D.service,label:(0,S.startCase)(D.serviceShortName)}));return R.length>0?(0,S.uniqBy)(R,D=>D.value):[]},ga=async N=>{const D=(await a.filterMetricsByType(le,Te)).filter(z=>z.type.includes(N.toLowerCase())).map(z=>({value:z.type,label:z.displayName,component:function(){return t.createElement("div",null,t.createElement("div",{className:Oe},z.type),t.createElement("div",{className:be.optionDescription},z.description))}}));return[{label:"Template Variables",options:s.options},...D]},Ta=Bt()(ga,400),ot=({value:N})=>{const R=Ce(A,N);U(R);const{metricKind:D,valueType:z}=R,ye=D===o.GAUGE||z===i.DISTRIBUTION?f.None:f.Rate,{perSeriesAligner:De}=Ue(z,D,r.perSeriesAligner,ye);Object.assign(r,{...Qe(a),projectName:r.projectName,filters:r.filters}),e({...Ye({...r,perSeriesAligner:De},N),preprocessor:ye})};return t.createElement(t.Fragment,null,t.createElement(Z.p,null,t.createElement(Ne.s,null,t.createElement(M,{refId:n,templateVariableOptions:s.options,projectName:le,datasource:a,onChange:N=>{e({...r,projectName:N})}}),t.createElement(P.S,{label:"Service",width:"auto"},t.createElement(T.Ph,{width:"auto",onChange:ha,isLoading:b.length===0,value:[...b,...s.options].find(N=>N.value===Te),options:[{label:"Template Variables",options:s.options},...b],placeholder:"Select Services",inputId:`${n}-service`})),t.createElement(P.S,{label:"Metric name",width:"auto",htmlFor:`${n}-select-metric`},t.createElement("span",{title:Te===""?"Select a service first":"Type to search metrics"},t.createElement(T.qb,{width:"auto",onChange:ot,value:[...j,...s.options].find(N=>N.value===ie),loadOptions:Ta,defaultOptions:[{label:"Template Variables",options:s.options},...j.slice(0,100)],placeholder:"Select Metric",inputId:`${n}-select-metric`,disabled:Te===""}))))),t.createElement(t.Fragment,null,t.createElement(Rt,{labels:p,filters:r.filters,onChange:N=>e({...r,filters:N}),variableOptionGroup:s}),t.createElement(Z.p,null,t.createElement(_t,{metricDescriptor:L,query:r,onChange:e}),t.createElement(Nt,{refId:n,labels:Object.keys(p),query:r,onChange:e,variableOptionGroup:s,metricDescriptor:L}),t.createElement(Ot,{refId:n,datasource:a,templateVariableOptions:s.options,query:r,customMetaData:l,onChange:e,metricDescriptor:L,preprocessor:r.preprocessor}),t.createElement(je,{refId:n,value:c,onChange:u}))))}const $t=n=>(0,ae.css)`
  label: grafana-select-option-description;
  font-weight: normal;
  font-style: italic;
  color: ${n.colors.text.secondary};
`,Jt=t.memo(Vt),Qe=n=>({projectName:n.getDefaultProject(),crossSeriesReducer:"REDUCE_NONE",alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:Y.ALIGN_MEAN,groupBys:[],filters:[]}),Wt=n=>({projectName:n.getDefaultProject(),query:""});function kt({refId:n,query:e,datasource:a,onChange:r,onRunQuery:s,customMetaData:l,variableOptionGroup:c}){const u=(0,t.useCallback)(h=>{r({...e,timeSeriesList:h}),s()},[r,s,e]),p=(0,t.useCallback)(h=>{r({...e,timeSeriesQuery:h}),s()},[r,s,e]);return(0,t.useEffect)(()=>{e.queryType===E.TIME_SERIES_LIST&&!e.timeSeriesList&&r({refId:e.refId,datasource:e.datasource,queryType:E.TIME_SERIES_LIST,timeSeriesList:Qe(a),aliasBy:e.aliasBy}),e.queryType===E.TIME_SERIES_QUERY&&!e.timeSeriesQuery&&r({refId:e.refId,datasource:e.datasource,queryType:E.TIME_SERIES_QUERY,timeSeriesQuery:Wt(a),aliasBy:e.aliasBy})},[r,e,a]),t.createElement(ce._,null,(e.queryType===E.ANNOTATION||e.queryType===E.TIME_SERIES_LIST)&&e.timeSeriesList&&t.createElement(Jt,{refId:n,variableOptionGroup:c,customMetaData:l,onChange:u,datasource:a,query:e.timeSeriesList,aliasBy:e.aliasBy,onChangeAliasBy:h=>r({...e,aliasBy:h})}),e.queryType===E.TIME_SERIES_QUERY&&e.timeSeriesQuery&&t.createElement(t.Fragment,null,t.createElement(Ut.K,{gap:1,direction:"row"},t.createElement(M,{refId:n,datasource:a,onChange:h=>p({...e.timeSeriesQuery,projectName:h}),templateVariableOptions:c.options,projectName:e.timeSeriesQuery.projectName}),t.createElement(je,{refId:n,value:e.aliasBy,onChange:h=>r({...e,aliasBy:h})})),t.createElement(Gt,{onChange:h=>p({...e.timeSeriesQuery,query:h}),onRunQuery:s,query:e.timeSeriesQuery.query}),t.createElement(xt,{onChange:h=>p({...e.timeSeriesQuery,graphPeriod:h}),graphPeriod:e.timeSeriesQuery.graphPeriod,refId:n,variableOptionGroup:c})))}const et=t.memo(kt);var Yt=m(69171);const W=({label:n,onChange:e,value:a,options:r,allowCustomValue:s=!1})=>t.createElement(Yt._,{label:n,labelWidth:20},t.createElement(T.Ph,{width:25,allowCustomValue:s,value:a,onChange:({value:l})=>e(l),options:r})),Ht=n=>{const{datasource:e,query:a,onRunQuery:r,onChange:s}=n,[l,c]=(0,t.useState)(!1),u=(0,t.useMemo)(()=>{if(!l){c(!0);const b=e.migrateQuery(a);return s({...b}),b}return a},[a,e,s,l]),p={...yt(e),...u.sloQuery},h=b=>{s({...u,sloQuery:b}),r()},A={projectName:e.getDefaultProject(),expr:"",step:"10s",...u.promQLQuery},v=b=>{s({...u,promQLQuery:b})},U=(n.data?.series.length?n.data?.series[0].meta:{})?.custom??{},j={label:"Template Variables",expanded:!1,options:e.getVariables().map(se.E)};(0,t.useEffect)(()=>{(!u.queryType||!Object.values(E).includes(u.queryType))&&s({...u,queryType:E.TIME_SERIES_LIST})});const K=u.queryType;return t.createElement(ce._,null,t.createElement(pt,{query:u,onChange:s,onRunQuery:r}),K===E.PROMQL&&t.createElement(C,{refId:u.refId,variableOptionGroup:j,onChange:v,onRunQuery:r,datasource:e,query:A}),K!==E.SLO&&t.createElement(et,{refId:u.refId,variableOptionGroup:j,customMetaData:U,onChange:s,onRunQuery:r,datasource:e,query:u}),K===E.SLO&&t.createElement(ft,{refId:u.refId,variableOptionGroup:j,customMetaData:U,onChange:h,onRunQuery:r,datasource:e,query:p,aliasBy:u.aliasBy,onChangeAliasBy:b=>s({...u,aliasBy:b})}))};class tt extends t.PureComponent{constructor(e){super(e),this.queryTypes=[{value:g.Projects,label:"Projects"},{value:g.Services,label:"Services"},{value:g.MetricTypes,label:"Metric Types"},{value:g.LabelKeys,label:"Label Keys"},{value:g.LabelValues,label:"Label Values"},{value:g.ResourceTypes,label:"Resource Types"},{value:g.Aggregations,label:"Aggregations"},{value:g.Aligners,label:"Aligners"},{value:g.AlignmentPeriods,label:"Alignment Periods"},{value:g.Selectors,label:"Selectors"},{value:g.SLOServices,label:"SLO Services"},{value:g.SLO,label:"Service Level Objectives (SLO)"}],this.defaults={selectedQueryType:this.queryTypes[0].value,metricDescriptors:[],selectedService:"",selectedMetricType:"",labels:[],labelKey:"",metricTypes:[],services:[],sloServices:[],selectedSLOService:"",projects:[],projectName:"",loading:!0},this.onPropsChange=()=>{const{metricDescriptors:a,labels:r,metricTypes:s,services:l,...c}=this.state;this.props.onChange({...c,refId:"CloudMonitoringVariableQueryEditor-VariableQuery"})},this.state=Object.assign(this.defaults,this.props.query)}async componentDidMount(){await this.props.datasource.ensureGCEDefaultProject();const e=this.props.query.projectName||this.props.datasource.getDefaultProject(),a=await this.props.datasource.getProjects(),r=await this.props.datasource.getMetricTypes(this.props.query.projectName||this.props.datasource.getDefaultProject()),s=Fe(r).map(A=>({value:A.service,label:A.serviceShortName}));let l="";s.some(A=>A.value===(0,X.J)().replace(this.state.selectedService))?l=this.state.selectedService:s&&s.length>0&&(l=s[0].value);const{metricTypes:c,selectedMetricType:u}=Me(r,this.state.selectedMetricType,(0,X.J)().replace(this.state.selectedMetricType),(0,X.J)().replace(l)),p=await this.props.datasource.getSLOServices(e),h={services:s,selectedService:l,metricTypes:c,selectedMetricType:u,metricDescriptors:r,projects:a,...await this.getLabels(u,e),sloServices:p,loading:!1,projectName:e};this.setState(h,()=>this.onPropsChange())}async onQueryTypeChange(e){const a={selectedQueryType:e,...await this.getLabels(this.state.selectedMetricType,this.state.projectName,e)};this.setState(a)}async onProjectChange(e){const a=await this.props.datasource.getMetricTypes(e),r=await this.getLabels(this.state.selectedMetricType,e),{metricTypes:s,selectedMetricType:l}=Me(a,this.state.selectedMetricType,(0,X.J)().replace(this.state.selectedMetricType),(0,X.J)().replace(this.state.selectedService)),c=await this.props.datasource.getSLOServices(e);this.setState({...r,metricTypes:s,selectedMetricType:l,metricDescriptors:a,projectName:e,sloServices:c},()=>this.onPropsChange())}async onServiceChange(e){const{metricTypes:a,selectedMetricType:r}=Me(this.state.metricDescriptors,this.state.selectedMetricType,(0,X.J)().replace(this.state.selectedMetricType),(0,X.J)().replace(e)),s={selectedService:e,metricTypes:a,selectedMetricType:r,...await this.getLabels(r,this.state.projectName)};this.setState(s,()=>this.onPropsChange())}async onMetricTypeChange(e){const a={selectedMetricType:e,...await this.getLabels(e,this.state.projectName)};this.setState(a,()=>this.onPropsChange())}onLabelKeyChange(e){this.setState({labelKey:e},()=>this.onPropsChange())}componentDidUpdate(e,a){const r=a.selectedQueryType!==this.state.selectedQueryType,s=this.state.selectedSLOService!==a.selectedSLOService;(r||s)&&this.onPropsChange()}async getLabels(e,a,r=this.state.selectedQueryType){let s={labels:this.state.labels,labelKey:this.state.labelKey};if(e&&r===g.LabelValues){const l=await $e(this.props.datasource,e,a),c=l.some(u=>u===(0,X.J)().replace(this.state.labelKey))?this.state.labelKey:l[0];s={labels:l,labelKey:c}}return s}renderQueryTypeSwitch(e){const a={label:"Template Variables",expanded:!1,options:(0,X.J)().getVariables().map(r=>({value:`$${r.name}`,label:`$${r.name}`}))};switch(e){case g.MetricTypes:return t.createElement(t.Fragment,null,t.createElement(W,{allowCustomValue:!0,value:this.state.projectName,options:[a,...this.state.projects],onChange:r=>this.onProjectChange(r),label:"Project"}),t.createElement(W,{value:this.state.selectedService,options:[a,...this.state.services],onChange:r=>this.onServiceChange(r),label:"Service"}));case g.LabelKeys:case g.LabelValues:case g.ResourceTypes:return t.createElement(t.Fragment,null,t.createElement(W,{allowCustomValue:!0,value:this.state.projectName,options:[a,...this.state.projects],onChange:r=>this.onProjectChange(r),label:"Project"}),t.createElement(W,{value:this.state.selectedService,options:[a,...this.state.services],onChange:r=>this.onServiceChange(r),label:"Service"}),t.createElement(W,{value:this.state.selectedMetricType,options:[a,...this.state.metricTypes.map(({value:r,name:s})=>({value:r,label:s}))],onChange:r=>this.onMetricTypeChange(r),label:"Metric Type"}),e===g.LabelValues&&t.createElement(W,{value:this.state.labelKey,options:[a,...this.state.labels.map(r=>({value:r,label:r}))],onChange:r=>this.onLabelKeyChange(r),label:"Label Key"}));case g.Aligners:case g.Aggregations:return t.createElement(t.Fragment,null,t.createElement(W,{value:this.state.selectedService,options:[a,...this.state.services],onChange:r=>this.onServiceChange(r),label:"Service"}),t.createElement(W,{value:this.state.selectedMetricType,options:[a,...this.state.metricTypes.map(({value:r,name:s})=>({value:r,label:s}))],onChange:r=>this.onMetricTypeChange(r),label:"Metric Type"}));case g.SLOServices:return t.createElement(t.Fragment,null,t.createElement(W,{allowCustomValue:!0,value:this.state.projectName,options:[a,...this.state.projects],onChange:r=>this.onProjectChange(r),label:"Project"}));case g.SLO:return t.createElement(t.Fragment,null,t.createElement(W,{allowCustomValue:!0,value:this.state.projectName,options:[a,...this.state.projects],onChange:r=>this.onProjectChange(r),label:"Project"}),t.createElement(W,{value:this.state.selectedSLOService,options:[a,...this.state.sloServices],onChange:r=>{this.setState({...this.state,selectedSLOService:r})},label:"SLO Service"}));default:return""}}render(){return this.state.loading?t.createElement("div",{className:"gf-form max-width-21"},t.createElement("span",{className:"gf-form-label width-10 query-keyword"},"Query Type"),t.createElement("div",{className:"gf-form-select-wrapper max-width-12"},t.createElement("select",{className:"gf-form-input"},t.createElement("option",null,"Loading...")))):t.createElement(t.Fragment,null,t.createElement(W,{value:this.state.selectedQueryType,options:this.queryTypes,onChange:e=>this.onQueryTypeChange(e),label:"Query Type"}),this.renderQueryTypeSwitch(this.state.selectedQueryType))}}var at=m(31312),zt=m(63302),Be=m(22605),rt=m(84289),nt=m(71476),Xt=m(92743),Zt=m(4148),qt=m(4649),ea=m(6278),ta=m(41182),st=m(48993);const aa=n=>({...Qe(n),title:"",text:""}),ra=n=>{const{datasource:e,query:a,onRunQuery:r,data:s,onChange:l}=n,u=(s?.series.length?s?.series[0].meta:{})?.custom??{},p={...aa(e),...a.timeSeriesList},[h,A]=(0,t.useState)(p.title||""),[v,L]=(0,t.useState)(p.text||""),U={label:"Template Variables",options:e.getVariables().map(se.E)},j=b=>{A(b.target.value)},K=b=>{L(b.target.value)};return(0,st.Z)(()=>{l({...a,timeSeriesList:{...p,title:h}})},1e3,[h,l]),(0,st.Z)(()=>{l({...a,timeSeriesList:{...p,text:v}})},1e3,[v,l]),(0,t.useEffect)(()=>{(!a.queryType||!Object.values(E).includes(a.queryType))&&l({...a,queryType:E.TIME_SERIES_LIST})}),t.createElement(ce._,null,t.createElement(t.Fragment,null,t.createElement(et,{refId:a.refId,variableOptionGroup:U,customMetaData:u,onChange:l,onRunQuery:r,datasource:e,query:a}),t.createElement(P.S,{label:"Title",htmlFor:"annotation-query-title"},t.createElement(I.I,{id:"annotation-query-title",value:h,onChange:j})),t.createElement(P.S,{label:"Text",htmlFor:"annotation-query-text"},t.createElement(I.I,{id:"annotation-query-text",value:v,onChange:K}))),t.createElement(Mt,null))},na=n=>n.target?.title!==void 0||n.target?.text!==void 0,sa=n=>({prepareAnnotation:e=>{if(!na(e))return e;const{enable:a,name:r,iconColor:s}=e,{target:l}=e;return{datasource:e.datasource,enable:a,name:r,iconColor:s,target:{intervalMs:n.intervalMs,refId:l?.refId||"annotationQuery",queryType:E.ANNOTATION,timeSeriesList:{projectName:l?.projectName||n.getDefaultProject(),filters:l?.filters||[],crossSeriesReducer:"REDUCE_NONE",perSeriesAligner:Y.ALIGN_NONE,title:l?.title||"",text:l?.text||""}}}},prepareQuery:e=>{if(e.target)return{...e.target,queryType:E.ANNOTATION,type:"annotationQuery"}},QueryEditor:ra});var la=m(95405);class ia{constructor(e){this.datasource=e}async execute(e){try{switch(e.projectName||(e.projectName=this.datasource.getDefaultProject()),e.selectedQueryType){case g.Projects:return this.handleProjectsQuery();case g.Services:return this.handleServiceQuery(e);case g.MetricTypes:return this.handleMetricTypesQuery(e);case g.LabelKeys:return this.handleLabelKeysQuery(e);case g.LabelValues:return this.handleLabelValuesQuery(e);case g.ResourceTypes:return this.handleResourceTypeQuery(e);case g.Aligners:return this.handleAlignersQuery(e);case g.AlignmentPeriods:return this.handleAlignmentPeriodQuery();case g.Aggregations:return this.handleAggregationQuery(e);case g.SLOServices:return this.handleSLOServicesQuery(e);case g.SLO:return this.handleSLOQuery(e);case g.Selectors:return this.handleSelectorQuery();default:return[]}}catch(a){return console.error(`Could not run CloudMonitoringMetricFindQuery ${e}`,a),[]}}async handleProjectsQuery(){return(await this.datasource.getProjects()).map(a=>({text:a.label,value:a.value,expandable:!0}))}async handleServiceQuery({projectName:e}){const a=await this.datasource.getMetricTypes(e);return Fe(a).map(s=>({text:s.serviceShortName,value:s.service,expandable:!0}))}async handleMetricTypesQuery({selectedService:e,projectName:a}){if(!e)return[];const r=await this.datasource.getMetricTypes(a);return _e(r,this.datasource.templateSrv.replace(e)).map(s=>({text:s.displayName,value:s.type,expandable:!0}))}async handleLabelKeysQuery({selectedMetricType:e,projectName:a}){return e?(await $e(this.datasource,e,a)).map(this.toFindQueryResult):[]}async handleLabelValuesQuery({selectedMetricType:e,labelKey:a,projectName:r}){if(!e)return[];const s="handleLabelValuesQuery",l=await this.datasource.getLabels(e,s,r,{groupBys:[a],crossSeriesReducer:"REDUCE_MEAN"}),c=this.datasource.templateSrv.replace(a);return(l.hasOwnProperty(c)?l[c]:[]).map(this.toFindQueryResult)}async handleResourceTypeQuery({selectedMetricType:e,projectName:a}){if(!e)return[];const r="handleResourceTypeQueryQueryType";return(await this.datasource.getLabels(e,r,a))["resource.type"]?.map(this.toFindQueryResult)??[]}async handleAlignersQuery({selectedMetricType:e,projectName:a}){if(!e)return[];const s=(await this.datasource.getMetricTypes(a)).find(l=>l.type===this.datasource.templateSrv.replace(e));return s?we(s.valueType,s.metricKind).map(this.toFindQueryResult):[]}async handleAggregationQuery({selectedMetricType:e,projectName:a}){if(!e)return[];const s=(await this.datasource.getMetricTypes(a)).find(l=>l.type===this.datasource.templateSrv.replace(e));return s?Ve(s.valueType,s.metricKind).map(this.toFindQueryResult):[]}async handleSLOServicesQuery({projectName:e}){return(await this.datasource.getSLOServices(e)).map(this.toFindQueryResult)}async handleSLOQuery({selectedSLOService:e,projectName:a}){return(await this.datasource.getServiceLevelObjectives(a,e)).map(this.toFindQueryResult)}async handleSelectorQuery(){return Re.map(this.toFindQueryResult)}handleAlignmentPeriodQuery(){return te.map(this.toFindQueryResult)}toFindQueryResult(e){return(0,S.isString)(e)?{text:e,expandable:!0}:{...e,expandable:!0}}}class oa extends la.Mg{constructor(e){super(),this.datasource=e,this.editor=tt,this.metricFindQuery=new ia(e)}query(e){const a=(0,Be.D)(this.metricFindQuery.execute(e.targets[0]));return(0,Be.D)(this.datasource.ensureGCEDefaultProject()).pipe((0,rt.z)(()=>a),(0,nt.U)(r=>({data:r})))}}class ca extends Xt.CK{constructor(e,a=(0,ta.J)(),r=(0,ea.$t)()){super(e),this.instanceSettings=e,this.templateSrv=a,this.timeSrv=r,this.authenticationType=e.jsonData.authenticationType||"jwt",this.variables=new oa(this),this.intervalMs=0,this.annotations=sa(this),this.backendSrv=(0,Zt.i)()}getVariables(){return this.templateSrv.getVariables().map(e=>`$${e.name}`)}query(e){return e.targets=e.targets.map(a=>({...this.migrateQuery(a),intervalMs:e.intervalMs})),super.query(e)}applyTemplateVariables(e,a){const{timeSeriesList:r,timeSeriesQuery:s,sloQuery:l,promQLQuery:c}=e;return{...e,datasource:this.getRef(),intervalMs:this.intervalMs,timeSeriesList:r&&{...this.interpolateProps(r,a),projectName:this.templateSrv.replace(r.projectName?r.projectName:this.getDefaultProject(),a),filters:this.interpolateFilters(r.filters||[],a),groupBys:this.interpolateGroupBys(r.groupBys||[],a),view:r.view||"FULL"},timeSeriesQuery:s&&{...this.interpolateProps(s,a),projectName:this.templateSrv.replace(s.projectName?s.projectName:this.getDefaultProject(),a)},sloQuery:l&&this.interpolateProps(l,a),promQLQuery:c&&this.interpolateProps(c,a)}}async getLabels(e,a,r,s,l){const c={targets:[{refId:a,datasource:this.getRef(),queryType:E.TIME_SERIES_LIST,timeSeriesList:Ye({projectName:this.templateSrv.replace(r),groupBys:this.interpolateGroupBys(s?.groupBys||[],{}),crossSeriesReducer:s?.crossSeriesReducer??"REDUCE_NONE",view:"HEADERS"},e)}],range:l??this.timeSrv.timeRange()},u=c.targets;return u.length?(0,at.n)((0,Be.D)(this.ensureGCEDefaultProject()).pipe((0,rt.z)(()=>this.backendSrv.fetch({url:"/api/ds/query",method:"POST",headers:this.getRequestHeaders(),data:{from:c.range.from.valueOf().toString(),to:c.range.to.valueOf().toString(),queries:u}})),(0,nt.U)(({data:p})=>{const A=(0,qt.z1)({data:p})?.data.map(v=>v.meta?.custom?.labels).filter(v=>!!v).reduce((v,L)=>{for(let U in L)v[U]||(v[U]=new Set),L[U]&&v[U].add(L[U]);return v},{});return Object.fromEntries(Object.entries(A).map(v=>(v[1]=Array.from(v[1]),v)))}))):(0,at.n)((0,zt.of)({results:[]}))}async getGCEDefaultProject(){return this.getResource("gceDefaultProject")}getDefaultProject(){const{defaultProject:e,authenticationType:a,gceDefaultProject:r}=this.instanceSettings.jsonData;return a==="gce"?r||"":e||""}async ensureGCEDefaultProject(){const{authenticationType:e,gceDefaultProject:a}=this.instanceSettings.jsonData;e==="gce"&&!a&&(this.instanceSettings.jsonData.gceDefaultProject=await this.getGCEDefaultProject())}async getMetricTypes(e){return e?this.getResource(`metricDescriptors/v3/projects/${this.templateSrv.replace(e)}/metricDescriptors`):[]}async filterMetricsByType(e,a){return e?this.getResource(`metricDescriptors/v3/projects/${this.templateSrv.replace(e)}/metricDescriptors`,{filter:`metric.type : "${a}"`}):[]}async getSLOServices(e){return this.getResource(`services/v3/projects/${this.templateSrv.replace(e)}/services?pageSize=1000`)}async getServiceLevelObjectives(e,a){if(!a)return Promise.resolve([]);let{projectName:r,serviceId:s}=this.interpolateProps({projectName:e,serviceId:a});return this.getResource(`slo-services/v3/projects/${r}/services/${s}/serviceLevelObjectives`)}getProjects(){return this.getResource("projects")}migrateMetricTypeFilter(e,a){const r=["metric.type","=",e];return a?.length?a.concat("AND",r):r}migrateQuery(e){const{hide:a,refId:r,datasource:s,key:l,queryType:c,maxLines:u,metric:p,intervalMs:h,type:A,...v}=e;if(!e.hasOwnProperty("metricQuery")&&!e.hasOwnProperty("sloQuery")&&!e.hasOwnProperty("timeSeriesQuery")&&!e.hasOwnProperty("timeSeriesList"))return{datasource:s,key:l,refId:r,intervalMs:h,hide:a,queryType:A==="annotationQuery"?E.ANNOTATION:E.TIME_SERIES_LIST,timeSeriesList:{...v,view:v.view||"FULL"}};if((0,S.has)(e,"metricQuery")&&["metrics",E.ANNOTATION].includes(e.queryType??"")){const L=(0,S.get)(e,"metricQuery");L.editorMode==="mql"?(e.timeSeriesQuery={projectName:L.projectName,query:L.query,graphPeriod:L.graphPeriod},e.queryType=E.TIME_SERIES_QUERY):(e.timeSeriesList={projectName:L.projectName,crossSeriesReducer:L.crossSeriesReducer,alignmentPeriod:L.alignmentPeriod,perSeriesAligner:L.perSeriesAligner,groupBys:L.groupBys,filters:L.filters,view:L.view,preprocessor:L.preprocessor},e.queryType=E.TIME_SERIES_LIST,L.metricType&&(e.timeSeriesList.filters=this.migrateMetricTypeFilter(L.metricType,e.timeSeriesList.filters))),e.aliasBy=L.aliasBy,e=(0,S.omit)(e,"metricQuery")}return e.queryType===E.SLO&&(0,S.has)(e,"sloQuery.aliasBy")&&(e.aliasBy=(0,S.get)(e,"sloQuery.aliasBy"),e=(0,S.omit)(e,"sloQuery.aliasBy")),e}interpolateProps(e,a={}){return Object.entries(e).reduce((r,[s,l])=>({...r,[s]:l&&(0,S.isString)(l)?this.templateSrv.replace(l,a):l}),{})}filterQuery(e){if(e.hide)return!1;if(e.queryType===E.SLO){if(!e.sloQuery)return!1;const{selectorName:a,serviceId:r,sloId:s,projectName:l,lookbackPeriod:c}=e.sloQuery;return!!a&&!!r&&!!s&&!!l&&(a!==Pe||!!c)}return e.queryType===E.TIME_SERIES_QUERY?!!e.timeSeriesQuery&&!!e.timeSeriesQuery.projectName&&!!e.timeSeriesQuery.query:e.queryType&&[E.TIME_SERIES_LIST,E.ANNOTATION].includes(e.queryType)?!!e.timeSeriesList&&!!e.timeSeriesList.projectName&&!!ke(e.timeSeriesList):e.queryType===E.PROMQL?!!e.promQLQuery&&!!e.promQLQuery.projectName&&!!e.promQLQuery.expr&&!!e.promQLQuery.step:!1}interpolateVariablesInQueries(e,a){return e.map(r=>this.applyTemplateVariables(this.migrateQuery(r),a))}interpolateFilters(e,a){const r=(0,S.chunk)(e,4).map(([l,c,u,p])=>({key:l,operator:c,value:u,...p&&{condition:p}})).filter(l=>l.value);return(0,S.flatten)(r.map(({key:l,operator:c,value:u,condition:p})=>[this.templateSrv.replace(l,a||{}),c,this.templateSrv.replace(u,a||{},h=>(0,S.isArray)(h)&&h.length?`(${h.join("|")})`:h),...p?[p]:[]]))||[]}interpolateGroupBys(e,a){let r=[];return(e||[]).forEach(s=>{const l=this.templateSrv.replace(s,a||{},"csv").split(",");Array.isArray(l)?r=r.concat(l):r.push(l)}),r}}var ua=m(20022);const ma=n=>{(0,ne.ff)("grafana_ds_cloudmonitoring_dashboard_loaded",n)},pa=new x.hf(ca).setQueryEditorHelp(d).setQueryEditor(Ht).setConfigEditor(fe).setVariableQueryEditor(tt);(0,G.N$)().subscribe(y.Pl,({payload:{dashboardId:n,orgId:e,grafanaVersion:a,queries:r}})=>{const s=r[ua.id];let l={[E.TIME_SERIES_QUERY]:0,[E.TIME_SERIES_LIST]:0,[E.SLO]:0,[E.ANNOTATION]:0,[E.PROMQL]:0};s.forEach(c=>{c.queryType===E.TIME_SERIES_QUERY||c.queryType===E.TIME_SERIES_LIST||c.queryType===E.SLO||c.queryType===E.ANNOTATION||c.queryType===E.PROMQL?l[c.queryType]++:c.queryType==="metrics"&&(c.hasOwnProperty("type")&&(0,S.get)(c,"type")==="annotationQuery"&&l.annotation++,(0,S.get)(c,"metricQuery.editorMode")==="mql"?l.timeSeriesQuery++:l.timeSeriesList++)}),s&&s.length>0&&ma({grafana_version:a,dashboard_id:n,org_id:e,mql_queries:l[E.TIME_SERIES_QUERY],time_series_filter_queries:l[E.TIME_SERIES_LIST],slo_queries:l[E.SLO],annotation_queries:l[E.ANNOTATION],promQL_queries:l[E.PROMQL]})})}}]);

//# sourceMappingURL=9711.js.map