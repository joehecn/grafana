"use strict";(this.webpackChunkGrafanaToWebComponent=this.webpackChunkGrafanaToWebComponent||[]).push([[1569],{9865:(Me,he,i)=>{i.d(he,{JX:()=>$e,Wz:()=>L,oZ:()=>ye,uG:()=>D});var v=i(41407),R=i(86832),u=i.n(R),H=i(39953),re=i(32688),O=i(56921),j=i(20454),Z=i(69171),ge=i(38637),ue=i(9558),pe=i(11569),ne=i(73363);const D=[{value:ne.EM.Range,label:"Range",description:"Run query over a range of time."},{value:ne.EM.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}];re.config.featureToggles.lokiExperimentalStreaming&&D.push({value:ne.EM.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});const ye=[{value:1,label:"1/1"}].concat((0,R.map)([2,3,4,5,10],A=>({value:A,label:"1/"+A})));function $e(A){const{lineLimitValue:I,resolution:k,onRunQuery:z,runOnBlur:U,onChange:T}=A,m=A.query??{},X=(0,pe.Lw)(m);function Q(_){const N={...m,maxLines:L(_)};T(N)}function te(_){const{instant:N,range:B,...S}=m;T({...S,queryType:_})}function ve(_){m.maxLines!==L(_.currentTarget.value)&&Q(_.currentTarget.value)}function g(_){_.key==="Enter"&&z()}function E(_){const N={...m,resolution:_.value};T(N)}return H.createElement("div",{"aria-label":"Loki extra field",className:"gf-form-inline"},H.createElement("div",{"data-testid":"queryTypeField",className:(0,v.cx)("gf-form explore-input-margin",(0,v.css)`
            flex-wrap: nowrap;
          `),"aria-label":"Query type field"},H.createElement(O.c,{width:"auto"},"Query type"),H.createElement(j.S,{options:D,value:X,onChange:_=>{te(_),U&&z()}})),H.createElement("div",{"data-testid":"lineLimitField",className:(0,v.cx)("gf-form",(0,v.css)`
            flex-wrap: nowrap;
          `),"aria-label":"Line limit field"},H.createElement(Z._,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},H.createElement(ge.I,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:ve,onKeyDown:g,value:I,onBlur:()=>{U&&z()}})),H.createElement(Z._,{label:"Resolution",tooltip:"Resolution 1/1 sets step parameter of Loki metrics range queries such that each pixel corresponds to one data point. For better performance, lower resolutions can be picked. 1/2 only retrieves a data point for every other pixel, and 1/10 retrieves one data point per 10 pixels."},H.createElement(ue.Ph,{isSearchable:!1,onChange:E,options:ye,value:k,"aria-label":"Select resolution"}))))}var ce=(0,H.memo)($e);function L(A){const I=parseInt(A,10);if(!(isNaN(I)||I<0))return I}},16699:(Me,he,i)=>{i.d(he,{O:()=>u,t:()=>j});var v=i(71258),R=i(65234);function u(Z,ge,ue){if(!Z)return!1;const pe=H(ge);if(!pe.length)return!1;let ne=pe;if(Z!==ge){const D=H(Z);ne=pe.flatMap(h=>D.filter(ye=>h.text===ye.text)||h)}return ne.map(D=>re(Z,ue,D)).filter(O)}function H(Z){const ge=[];return v.E2.parse(Z).iterate({enter:pe=>{if(pe.type.id===R._A){const ne=pe.node;ge.push({node:ne,text:Z.substring(ne.from,ne.to)})}}}),ge}function re(Z,ge,ue){if(ge.length===1){const D=ue.node.from===ue.node.to,h=D&&ue.node.parent?ue.node.parent:ue.node,ye=D?Z.substring(h.from,h.to):ue.text;return{startLineNumber:1,startColumn:h.from+1,endLineNumber:1,endColumn:h.to+1,error:ye}}let pe=0,ne=0;for(let D=0;D<ge.length;D++){if(ne=pe+ge[D].length,ue.node.from>ne){pe+=ge[D].length+1;continue}return{startLineNumber:D+1,startColumn:ue.node.from-pe+1,endLineNumber:D+1,endColumn:ue.node.to-pe+1,error:ue.text}}return null}function O(Z){return Z!==null}const j={__interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},96062:(Me,he,i)=>{i.d(he,{KV:()=>br,Ic:()=>nt,xf:()=>Ft,NZ:()=>mt,V8:()=>Ge,$f:()=>Ze});var v=i(86832),R=i(8894),u=i(3195),H=i(63302),re=i(31312),O=i(71476),j=i(10752),Z=i(82696),ge=i(61782),ue=i(81626),pe=i(10694),ne=i(69323),D=i(96083),h=i(98579),ye=i(72964),$e=i(76892),ce=i(89591),L=i(71258),A=i(92743),I=i(32688),k=i(44951),z=i(6278),U=i(41182),T=i(5365),m=i(41891),X=i(20810),Q=i(65234),te=i(63781),ve=i(10963),g=i.n(ve),E=i(92403),_=i(54721),N=i(63163),B=i(74480),S=i(88553),d=i(73363);const o=["job","namespace"],c="{}",y=10,F=1e3*60*60*24,W=1e6,J=[{label:"$__auto",sortValue:"$__auto"},{label:"1m",sortValue:"00:01:00"},{label:"5m",sortValue:"00:05:00"},{label:"10m",sortValue:"00:10:00"},{label:"30m",sortValue:"00:30:00"},{label:"1h",sortValue:"01:00:00"},{label:"1d",sortValue:"24:00:00"}],me=null,fe=s=>({label:s,filterText:`"${s}"`});function xe(s,t){const e=Date.now()-F,r=t.filter(l=>l.ts>e&&l.query.expr===s.label);let a=`Queried ${r.length} times in the last 24h.`;const n=r[0];if(n){const l=(0,E.CQ)(n.ts).fromNow();a=`${a} Last queried ${l}.`}return{...s,documentation:a}}class Ee extends _.iL{constructor(t,e){super(),this.started=!1,this.lookupsDisabled=!1,this.seriesCache=new te.z({max:10}),this.labelsCache=new te.z({max:10}),this.cleanText=r=>r.replace(/[{}[\]="(),!~+\-*/^%\|]/g,"").trim(),this.request=async(r,a)=>{try{return await this.datasource.metadataRequest(r,a)}catch(n){console.error(n)}},this.start=()=>(this.startTask||(this.startTask=this.fetchLabels().then(()=>(this.started=!0,[]))),this.startTask),this.getBeginningCompletionItems=r=>({suggestions:[...this.getEmptyCompletionItems(r).suggestions,...this.getTermCompletionItems().suggestions]}),this.getTermCompletionItems=()=>{const r=[];return r.push({prefixMatch:!0,label:"Functions",items:S.r8.map(a=>({...a,kind:"function"}))}),{suggestions:r}},this.getPipeCompletionItem=()=>{const r=[];return r.push({label:"Operators",items:S.Rd.map(a=>({...a,kind:"operators"}))}),r.push({label:"Parsers",items:S.uR.map(a=>({...a,kind:"parsers"}))}),{suggestions:r}},this.fetchSeriesLabels=async r=>{const a=this.datasource.interpolateString(r),n="series",{start:l,end:p}=this.datasource.getTimeRangeParams(),f=this.generateCacheKey(n,l,p,a);let b=this.seriesCache.get(f);if(!b){const $={"match[]":a,start:l,end:p},Y=await this.request(n,$),{values:q}=(0,N.DY)(Y);b=q,this.seriesCache.set(f,b)}return b},this.fetchSeries=async r=>{const a="series",{start:n,end:l}=this.datasource.getTimeRangeParams(),p={"match[]":r,start:n,end:l};return await this.request(a,p)},this.datasource=t,this.labelKeys=[],this.labelFetchTs=0,Object.assign(this,e)}getSyntax(){return S.ZP}getLabelKeys(){return this.labelKeys}async provideCompletionItems(t,e){const{wrapperClasses:r,value:a,prefix:n,text:l}=t,p={suggestions:[]};if(!a)return p;const f=a?.document.text.length===0,b=a.document.getTextsAtRange(a.selection),$=b.size===1?b.first().getText():null,Y=$?$[a.selection.anchor.offset]:null,q=r.length>3,V=n&&!q,se=!Y||Y===")",ae=n&&!l.match(/^['"~=\]})\s]+$/)&&se,Le=/[+\-*/^%]/,Se=l.match(Le);return r.includes("context-range")?this.getRangeCompletionItems():r.includes("context-labels")?await this.getLabelCompletionItems(t):r.includes("context-pipe")?this.getPipeCompletionItem():f?this.getEmptyCompletionItems(e):V&&se&&!Se?this.getBeginningCompletionItems(e):V&&ae?this.getTermCompletionItems():p}getEmptyCompletionItems(t){const e=t?.history,r=[];if(e?.length){const a=(0,v.chain)(e).map(n=>n.query.expr).filter().uniq().take(y).map(fe).map(n=>xe(n,e)).value();r.push({prefixMatch:!0,skipSort:!0,label:"History",items:a})}return{suggestions:r}}getRangeCompletionItems(){return{context:"context-range",suggestions:[{label:"Range vector",items:[...J]}]}}async getLabelCompletionItems({text:t,wrapperClasses:e,labelKey:r,value:a}){let n="context-labels";const l=[];if(!a)return{context:n,suggestions:[]};const p=a.anchorBlock.getText(),f=a.selection.anchor.offset,b=t.match(/^(=|=~|!=|!~)/);let $,Y;try{Y=(0,N.rV)(p,f),$=Y.selector}catch{$=c}if(!r&&$===c){await this.start();const se=this.getLabelKeys();return{context:n,suggestions:[{label:"Labels",items:se.map(fe)}]}}const q=Y?Y.labelKeys:[];let V;if($)if($===c&&r){const se=await this.getLabelValues(r);V={[r]:se}}else V=await this.getSeriesLabels($);if(!V)return console.warn(`Server did not return any values for selector = ${$}`),{context:n,suggestions:l};if(t&&b||e.includes("attr-value"))r&&V[r]&&(n="context-label-values",l.push({label:`Label values for "${r}"`,items:V[r].map(fe).filter(({filterText:se})=>se!==t)}));else{const se=V?Object.keys(V):o;if(se){const ae=(0,v.difference)(se,q);if(ae.length){const Se={label:"Labels",items:ae.map(_e=>({label:_e}))};l.push(Se)}}}return{context:n,suggestions:l}}importFromAbstractQuery(t){return{refId:t.refId,expr:(0,N.PL)(t),queryType:d.EM.Range}}exportToAbstractQuery(t){const e=t.expr;if(!e||e.length===0)return{refId:t.refId,labelMatchers:[]};const r=g().tokenize(e,S.ZP);return{refId:t.refId,labelMatchers:(0,N.UO)(r)}}async getSeriesLabels(t){if(!this.lookupsDisabled)try{return await this.fetchSeriesLabels(t)}catch(e){console.error(e);return}}async fetchLabels(){const t="labels",e=this.datasource.getTimeRangeParams();this.labelFetchTs=Date.now().valueOf();const r=await this.request(t,e);if(Array.isArray(r)){const a=r.slice().sort().filter(n=>n!=="__name__");return this.labelKeys=a,this.labelKeys}return[]}generateCacheKey(t,e,r,a){return[t,this.roundTime(e),this.roundTime(r),a].join()}roundTime(t){return t?Math.floor(t/W/1e3/60/5):0}async getLabelValues(t){return await this.fetchLabelValues(t)}async fetchLabelValues(t){const e=encodeURIComponent(this.datasource.interpolateString(t)),r=`label/${e}/values`,a=this.datasource.getTimeRangeParams(),{start:n,end:l}=a,p=this.generateCacheKey(r,n,l,e),f={start:n,end:l};let b=this.labelsCache.get(p);if(!b){this.labelsCache.set(p,[]);const $=await this.request(r,f);Array.isArray($)&&(b=$.slice().sort(),this.labelsCache.set(p,b))}return b??[]}async getParserAndLabelKeys(t){const e=await this.datasource.getDataSamples({expr:t,refId:"data-samples"});if(!e.length)return{extractedLabelKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1};const{hasLogfmt:r,hasJSON:a,hasPack:n}=(0,B.OP)(e[0]);return{extractedLabelKeys:(0,B.e8)(e[0]),unwrapLabelKeys:(0,B.zb)(e[0]),hasJSON:a,hasPack:n,hasLogfmt:r}}}var Re=i(46514),Ue=i(90685),st=i(84289),Ct=i(81698),ft=i(58145),Mt=i(23997),Pr=i(9748),Dt=i(36497),jt=i(31544),gt=i(56989),Er={url:"",deserializer:function(s){return JSON.parse(s.data)},serializer:function(s){return JSON.stringify(s)}},xr="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Qr=function(s){(0,ft.__extends)(t,s);function t(e,r){var a=s.call(this)||this;if(a._socket=null,e instanceof Dt.y)a.destination=r,a.source=e;else{var n=a._config=(0,ft.__assign)({},Er);if(a._output=new Mt.x,typeof e=="string")n.url=e;else for(var l in e)e.hasOwnProperty(l)&&(n[l]=e[l]);if(!n.WebSocketCtor&&WebSocket)n.WebSocketCtor=WebSocket;else if(!n.WebSocketCtor)throw new Error("no WebSocket constructor can be found");a.destination=new gt.t}return a}return t.prototype.lift=function(e){var r=new t(this._config,this.destination);return r.operator=e,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new gt.t),this._output=new Mt.x},t.prototype.multiplex=function(e,r,a){var n=this;return new Dt.y(function(l){try{n.next(e())}catch(f){l.error(f)}var p=n.subscribe({next:function(f){try{a(f)&&l.next(f)}catch(b){l.error(b)}},error:function(f){return l.error(f)},complete:function(){return l.complete()}});return function(){try{n.next(r())}catch(f){l.error(f)}p.unsubscribe()}})},t.prototype._connectSocket=function(){var e=this,r=this._config,a=r.WebSocketCtor,n=r.protocol,l=r.url,p=r.binaryType,f=this._output,b=null;try{b=n?new a(l,n):new a(l),this._socket=b,p&&(this._socket.binaryType=p)}catch(Y){f.error(Y);return}var $=new jt.w0(function(){e._socket=null,b&&b.readyState===1&&b.close()});b.onopen=function(Y){var q=e._socket;if(!q){b.close(),e._resetState();return}var V=e._config.openObserver;V&&V.next(Y);var se=e.destination;e.destination=Pr.Lv.create(function(ae){if(b.readyState===1)try{var Le=e._config.serializer;b.send(Le(ae))}catch(Se){e.destination.error(Se)}},function(ae){var Le=e._config.closingObserver;Le&&Le.next(void 0),ae&&ae.code?b.close(ae.code,ae.reason):f.error(new TypeError(xr)),e._resetState()},function(){var ae=e._config.closingObserver;ae&&ae.next(void 0),b.close(),e._resetState()}),se&&se instanceof gt.t&&$.add(se.subscribe(e.destination))},b.onerror=function(Y){e._resetState(),f.error(Y)},b.onclose=function(Y){b===e._socket&&e._resetState();var q=e._config.closeObserver;q&&q.next(Y),Y.wasClean?f.complete():f.error(Y)},b.onmessage=function(Y){try{var q=e._config.deserializer;f.next(q(Y))}catch(V){f.error(V)}}},t.prototype._subscribe=function(e){var r=this,a=this.source;return a?a.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(function(){var n=r._socket;r._output.observers.length===0&&(n&&(n.readyState===1||n.readyState===0)&&n.close(),r._resetState())}),e)},t.prototype.unsubscribe=function(){var e=this._socket;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),s.prototype.unsubscribe.call(this)},t}(Mt.u);function Vt(s){return new Qr(s)}var Lr=i(93648),$r=i(10026);const Ot=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ht(s){return typeof s=="string"&&Ot.test(s)}const Kt=ht;function kt(s){if(!Kt(s))throw TypeError("Invalid UUID");let t;const e=new Uint8Array(16);return e[0]=(t=parseInt(s.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(s.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(s.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(s.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(s.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}const Tr=kt;function Rr(s){s=unescape(encodeURIComponent(s));const t=[];for(let e=0;e<s.length;++e)t.push(s.charCodeAt(e));return t}const Sr="6ba7b810-9dad-11d1-80b4-00c04fd430c8",_r="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Fr(s,t,e){function r(a,n,l,p){var f;if(typeof a=="string"&&(a=Rr(a)),typeof n=="string"&&(n=Tr(n)),((f=n)===null||f===void 0?void 0:f.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let b=new Uint8Array(16+a.length);if(b.set(n),b.set(a,n.length),b=e(b),b[6]=b[6]&15|t,b[8]=b[8]&63|128,l){p=p||0;for(let $=0;$<16;++$)l[p+$]=b[$];return l}return(0,$r.S)(b)}try{r.name=s}catch{}return r.DNS=Sr,r.URL=_r,r}function Cr(s,t,e,r){switch(s){case 0:return t&e^~t&r;case 1:return t^e^r;case 2:return t&e^t&r^e&r;case 3:return t^e^r}}function Nt(s,t){return s<<t|s>>>32-t}function Mr(s){const t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof s=="string"){const l=unescape(encodeURIComponent(s));s=[];for(let p=0;p<l.length;++p)s.push(l.charCodeAt(p))}else Array.isArray(s)||(s=Array.prototype.slice.call(s));s.push(128);const r=s.length/4+2,a=Math.ceil(r/16),n=new Array(a);for(let l=0;l<a;++l){const p=new Uint32Array(16);for(let f=0;f<16;++f)p[f]=s[l*64+f*4]<<24|s[l*64+f*4+1]<<16|s[l*64+f*4+2]<<8|s[l*64+f*4+3];n[l]=p}n[a-1][14]=(s.length-1)*8/Math.pow(2,32),n[a-1][14]=Math.floor(n[a-1][14]),n[a-1][15]=(s.length-1)*8&4294967295;for(let l=0;l<a;++l){const p=new Uint32Array(80);for(let V=0;V<16;++V)p[V]=n[l][V];for(let V=16;V<80;++V)p[V]=Nt(p[V-3]^p[V-8]^p[V-14]^p[V-16],1);let f=e[0],b=e[1],$=e[2],Y=e[3],q=e[4];for(let V=0;V<80;++V){const se=Math.floor(V/20),ae=Nt(f,5)+Cr(se,b,$,Y)+q+t[se]+p[V]>>>0;q=Y,Y=$,$=Nt(b,30)>>>0,b=f,f=ae}e[0]=e[0]+f>>>0,e[1]=e[1]+b>>>0,e[2]=e[2]+$>>>0,e[3]=e[3]+Y>>>0,e[4]=e[4]+q>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,e[0]&255,e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,e[1]&255,e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,e[2]&255,e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,e[3]&255,e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,e[4]&255]}const Gt=Fr("v5",80,Mr),Zt="6ec946da-0f49-47a8-983a-1d76d17e7c92";function vt(s,t){const e=s.streams;if(!e||!e.length)return;const r=t.fields[0],a=t.fields[1],n=t.fields[2],l={};for(const p of e){const f=Object.entries(p.stream).map(([b,$])=>`${b}="${$}"`).sort().join("");for(const[b,$]of p.values)r.values.push(new Date(parseInt(b.slice(0,-6),10)).toISOString()),a.values.push($),n.values.push(it(b,f,$,l,t.refId))}}function it(s,t,e,r,a){let n=Gt(`${s}_${t}_${e}`,Zt);if(n in r){const l=r[n]+1;r[n]=l,n=`${n}_${l}`}else r[n]=0;return a?`${a}_${n}`:n}class ze{constructor(){this.streams={}}getStream(t,e=5e3){let r=this.streams[t.url];if(r)return r;const a=new Lr.a({capacity:t.size});return a.addField({name:"Time",type:ce.fS.time,config:{}}),a.addField({name:"Line",type:ce.fS.string}),a.addField({name:"id",type:ce.fS.string}),a.meta={...a.meta,preferredVisualisationType:"logs"},a.refId=t.refId,r=Vt(t.url).pipe((0,O.U)(n=>(vt(n,a),[a])),(0,Ue.a)(n=>n.pipe((0,st.z)((l,p)=>{const f=p+1;return l.code===1006&&f<30?(f>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${l.reason}`),(0,Re.H)(e)):(0,R._)(l)}))),(0,Ct.x)(()=>{delete this.streams[t.url]})),this.streams[t.url]=r,r}}var zt=i(97316),bt=i(14687),Qe=i(23062),Dr=i(74600),Te=i(41407),K=i(39953),Nr=i(20653),Br=i(52807),Fe=i(72639),Ht=i(82803),Bt=i(69865),He=i(4919),wt=i(62818),Yt=i(39285),Jt=i(28409),yt=i(36495),Pt=i(9558),We=i(74661),Et=i(69171),qt=i(18328),Ye=i(26286),Je=i(6155),Xe=i(38793),le=i(11569);function er(s){return{labels:(0,Te.css)`
      display: flex;
      gap: ${s.spacing(.5)};
    `,wrapper:(0,Te.css)`
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: ${s.spacing(.5)};
      position: relative;
    `,textWrapper:(0,Te.css)`
      display: flex;
      align-items: center;
    `,hidden:(0,Te.css)`
      visibility: hidden;
    `,label:(0,Te.css)`
      max-width: 100%;
      &:first-of-type {
        margin-bottom: ${s.spacing(2)};
      }
      &:not(:first-of-type) {
        margin: ${s.spacing(2)} 0;
      }
    `,rawQueryContainer:(0,Te.css)`
      text-align: start;
      line-break: anywhere;
      margin-top: -${s.spacing(.25)};
      margin-right: ${s.spacing(6)};
      min-height: ${s.spacing(4)};
    `,ui:(0,Te.css)`
      background-color: ${s.colors.background.secondary};
      padding: ${s.spacing(2)};
    `,rawQuery:(0,Te.css)`
      display: inline;
    `,queryDescription:(0,Te.css)`
      margin-left: ${s.spacing(.5)};
    `,iconButton:(0,Te.css)`
      position: absolute;
      top: ${s.spacing(1)};
      right: ${s.spacing(1)};
      z-index: ${s.zIndex.navbarFixed};
    `,operationsToggle:(0,Te.css)`
      margin: ${s.spacing(1)} 0 ${s.spacing(-1)} 0;
      & > div {
        margin: 0;
        & > label {
          padding: 0;
        }
      }
    `}}const Ie="isLogContextQueryUiOpen";function xt(s){const{row:t,logContextProvider:e,updateFilter:r,onClose:a,origQuery:n,runContextQuery:l}=s,p=(0,Ht.wW)(er),[f,b]=(0,K.useState)([]),[$,Y]=(0,K.useState)(!1),[q,V]=(0,K.useState)(!1),[se,ae]=(0,K.useState)(Qe.Z.getBool(Ie,!1)),[Le,Se]=(0,K.useState)(Qe.Z.getBool($t,!1)),_e=K.useRef(),je=K.useRef(!1),P=K.useRef([]),x=(0,K.useMemo)(()=>!($&&f.some(G=>G.fromParser===G.enabled)||Le&&e.queryContainsValidPipelineStages(n)),[f,Le,$,e,n]);(0,K.useEffect)(()=>{if($){if(!je.current){je.current=$;return}if(f.filter(({enabled:G,fromParser:de})=>G&&!de).length===0){b(P.current);return}return P.current=structuredClone(f),_e.current&&clearTimeout(_e.current),V(!0),_e.current=window.setTimeout(()=>{r(f.filter(({enabled:de})=>de));const G={removedLabels:[],selectedExtractedLabels:[]};f.forEach(({enabled:de,fromParser:Pe,label:De})=>{!de&&!Pe&&G.removedLabels.push(De),de&&Pe&&G.selectedExtractedLabels.push(De)}),Qe.Z.set(Xt,JSON.stringify(G)),V(!1)},1500),()=>{clearTimeout(_e.current)}}},[f,$]),(0,K.useEffect)(()=>()=>{clearTimeout(_e.current),a()},[a]),(0,Nr.Z)(async()=>{V(!0);const G=await e.getInitContextFilters(t.labels,n);b(G),Y(!0),V(!1)}),(0,K.useEffect)(()=>((0,Fe.ff)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"load"}),()=>{(0,Fe.ff)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"unload"})}),[t.uid]);const C=f.filter(({fromParser:G})=>!G),M=C.filter(({enabled:G})=>G),w=f.filter(({fromParser:G})=>G),ee=w.filter(({enabled:G})=>G),ie=(0,K.useCallback)(G=>({label:`${G.label}="${(0,Xe.Hk)(G.value)}"`,value:G.label}),[]),oe=n&&(0,le.cQ)(n.expr).parserCount===1&&w.length>0;let Oe=e.prepareExpression(f.filter(({enabled:G})=>G),n);return K.createElement("div",{className:p.wrapper},K.createElement(Bt.u,{content:"Revert to initial log context query."},K.createElement("div",{className:p.iconButton},K.createElement(He.zx,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:x,onClick:G=>{(0,Fe.ff)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:t.uid}),b(de=>de.map(Pe=>({...Pe,enabled:!Pe.fromParser}))),Qe.Z.delete(Xt),Qe.Z.delete($t),Se(!1)}}))),K.createElement(wt.U,{collapsible:!0,isOpen:se,onToggle:()=>{Qe.Z.set(Ie,!se),ae(G=>!G),(0,Fe.ff)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:t.uid,action:se?"close":"open"})},label:K.createElement("div",{className:p.rawQueryContainer},$?K.createElement(K.Fragment,null,K.createElement(Je.U,{lang:{grammar:S.xY,name:"loki"},query:Oe,className:p.rawQuery}),K.createElement(Bt.u,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query."},K.createElement(Yt.J,{name:"info-circle",size:"sm",className:p.queryDescription}))):K.createElement(Jt.$,null))},K.createElement("div",{className:p.ui},K.createElement(yt._,{className:p.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters."},"Widen the search"),K.createElement(Pt.NU,{isLoading:q,options:C.map(ie),value:M.map(ie),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(G,de)=>(de.action==="select-option"&&(0,Fe.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"select"}),de.action==="remove-value"&&(0,Fe.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"remove"}),b(f.map(Pe=>(Pe.fromParser||(Pe.enabled=G.some(De=>De.value===Pe.label)),Pe))))}),oe&&K.createElement(K.Fragment,null,K.createElement(yt._,{className:p.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line."},"Refine the search"),K.createElement(Pt.NU,{isLoading:q,options:w.map(ie),value:ee.map(ie),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(G,de)=>{de.action==="select-option"&&(0,Fe.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"select"}),de.action==="remove-value"&&(0,Fe.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"remove"}),b(f.map(Pe=>(Pe.fromParser&&(Pe.enabled=G.some(De=>De.value===Pe.label)),Pe)))}})),e.queryContainsValidPipelineStages(n)&&K.createElement(We.Z,{className:p.operationsToggle},K.createElement(Et._,{label:"Include LogQL pipeline operations",tooltip:K.createElement(qt.D,{content:(0,Br.a)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")})},K.createElement(Ye.x,{value:Le,showLabel:!0,transparent:!0,onChange:G=>{(0,Fe.ff)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:t.uid,action:G.currentTarget.checked?"enable":"disable"}),Qe.Z.set($t,G.currentTarget.checked),Se(G.currentTarget.checked),l&&l()}}))))))}var be=i(65415),Qt=i(88350),tr=(s=>(s[s.Ascending=0]="Ascending",s[s.Descending=1]="Descending",s))(tr||{});function Lt(s,t){const e=s.values,{nanos:r}=s,a=Array(e.length);for(let l=0;l<a.length;l++)a[l]=l;const n=t===0;return a.sort((l,p)=>{const f=e[l],b=e[p];if(f<b)return n?-1:1;if(f>b)return n?1:-1;if(r===void 0)return 0;const $=r[l],Y=r[p];return $<Y?n?-1:1:$>Y?n?1:-1:0}),a}function wr(s,t){const{fields:e,...r}=s,a=e.find(l=>l.type===ce.fS.time);if(a===void 0)throw new Error("missing timestamp field. should never happen");const n=Lt(a,t);return{...r,fields:e.map(l=>({...l,values:new Qt.o(l.values,n).toArray(),nanos:l.nanos===void 0?void 0:new Qt.o(l.nanos,n).toArray()}))}}const Xt="lokiLogContextPreservedLabels",$t="lokiLogContextShouldIncludePipelineOperations";class Xr{constructor(t){this.getLogRowContextQuery=async(e,r,a)=>{const{query:n}=await this.getQueryAndRange(e,r,a);return n},this.getLogRowContext=async(e,r,a)=>{const n=r&&r.direction||ne.M4.Backward,{query:l,range:p}=await this.getQueryAndRange(e,r,a),f=$=>{const q=$.data.map(V=>wr(V,tr.Descending));return{...$,data:q}},b=D.zj.Explore;return(0,re.n)(this.datasource.query(Ze(l,p,b,`${mt}${n}`)).pipe((0,j.K)($=>{throw{message:"Error during context query. Please check JS console logs.",status:$.status,statusText:$.statusText}}),(0,ge.w)($=>(0,H.of)(f($)))))},this.processContextFiltersToExpr=(e,r)=>{let n=`{${e.map(l=>!l.fromParser&&l.enabled?`${l.label}="${(0,Xe.U9)(l.value)}"`:"").filter(l=>!!l).join(",")}}`;if(r&&(0,le.cQ)(r.expr).parserCount===1){const l=(0,le.oi)(r.expr);if(l){n=(0,be.Pg)(n,l);const p=e.filter(f=>f.fromParser&&f.enabled);for(const f of p)f.enabled&&(n=(0,be.F2)(n,f.label,"=",f.value))}}return n},this.processPipelineStagesToExpr=(e,r)=>{let a=e;const n=r?.expr??"";if((0,le.cQ)(n).parserCount>1)return a;const l=(0,le.te)(n,[L.We,L.Li,L.af,L.bb,L.wm,L.pj]),p=l.filter(b=>b.type?.id===L.We),f=l.filter(b=>b.type?.id!==L.We);for(const b of p)f.some($=>b.contains($))||(a+=` ${b.getExpression(n)}`);return a},this.queryContainsValidPipelineStages=e=>{const r=e?.expr??"",a=(0,le.te)(r,[L.We,L.Li,L.wm,L.pj]),n=a.filter(p=>p.type?.id===L.We),l=a.filter(p=>p.type?.id!==L.We);return n.some(p=>l.every(f=>p.contains(f)===!1))},this.getInitContextFilters=async(e,r)=>{if(!r||(0,v.isEmpty)(e))return[];let a=[];if(!(0,le.cQ)(r.expr).queryWithParser)await this.datasource.languageProvider.start(),a=this.datasource.languageProvider.getLabelKeys();else{const p=(0,le.QI)(r.expr),f=await this.datasource.languageProvider.fetchSeriesLabels(p[0]);a=Object.keys(f)}const n=[];Object.entries(e).forEach(([p,f])=>{const b={label:p,value:f,enabled:a.includes(p),fromParser:!a.includes(p)};n.push(b)});let l;try{l=JSON.parse(Qe.Z.get(Xt))}catch{}if(l){let p=!1;const f=n.map($=>l.removedLabels.includes($.label)?(p=!0,{...$,enabled:!1}):l.selectedExtractedLabels.includes($.label)?(p=!0,{...$,enabled:!0}):{...$});return f.some(({enabled:$,fromParser:Y})=>$&&!Y)?(p&&(0,Dr.WI)((0,zt.$l)((0,bt.AT)("Previously used log context filters have been applied."))),f):n}else return n},this.datasource=t,this.appliedContextFilters=[]}async getQueryAndRange(t,e,r){const a=e&&e.direction||ne.M4.Backward,n=e&&e.limit||this.datasource.maxLines;if(this.appliedContextFilters.length===0){const l=(await this.getInitContextFilters(t.labels,r)).filter(p=>p.enabled);this.appliedContextFilters=l}return await this.prepareLogRowContextQueryTarget(t,n,a,r)}async prepareLogRowContextQueryTarget(t,e,r,a){const n=this.prepareExpression(this.appliedContextFilters,a),l=2*60*60*1e3,p=r===ne.M4.Forward?d.sb.Forward:d.sb.Backward,f={expr:n,queryType:d.EM.Range,refId:`${mt}_${Math.random().toString()}`,maxLines:e,direction:p,datasource:{uid:this.datasource.uid,type:this.datasource.type}},$=new $e.N(t.dataFrame).getFirstFieldOfType(ce.fS.time);if($===void 0)throw new Error("loki: data frame missing time-field, should never happen");const Y=$.values[t.rowIndex],q=(0,E.zh)(Y),V=p===d.sb.Forward?{from:q,to:(0,E.zh)(t.timeEpochMs+l)}:{from:(0,E.zh)(t.timeEpochMs-l),to:q};return{query:f,range:{from:V.from,to:V.to,raw:V}}}getLogRowContextUi(t,e,r){const a=n=>{this.appliedContextFilters=n,e&&e()};return this.onContextClose=this.onContextClose??(()=>{this.appliedContextFilters=[]}),xt({row:t,origQuery:r,updateFilter:a,onClose:this.onContextClose,logContextProvider:this,runContextQuery:e})}prepareExpression(t,e){let r=this.processContextFiltersToExpr(t,e);return Qe.Z.getBool($t,!1)&&(r=this.processPipelineStagesToExpr(r,e)),r}}var It=i(53305),rr=i(26205);function At(s,t){if(!t.length)return[];const e=(0,v.groupBy)(t,"name"),r=Object.values(e).map(Be),a=s.fields.find(n=>n.type===ce.fS.string);if(a===void 0)throw new Error("invalid logs-dataframe, string-field missing");return a.values.forEach(n=>{for(const l of r){const p=n.match(e[l.name][0].matcherRegex);l.values.push(p&&p[1])}}),r}function Be(s){const t=(0,rr.F)(),e=s.reduce((r,a)=>{if(a.datasourceUid){const n=t.getInstanceSettings(a.datasourceUid);r.push({title:a.urlDisplayLabel||"",url:"",internal:{query:{query:a.url,queryType:n?.type==="tempo"?"traceql":void 0},datasourceUid:a.datasourceUid,datasourceName:n?.name??"Data source not found"}})}else a.url&&r.push({title:a.urlDisplayLabel||"",url:a.url});return r},[]);return{name:s[0].name,type:ce.fS.string,config:{links:e},values:[]}}function qe(s){const t=s.filter(r=>r.refId!==void 0),e=(0,v.groupBy)(t,r=>r.refId);return Object.entries(e).map(([r,a])=>et(a,r))}function et(s,t){const e={name:"Time",config:{},values:[],type:ce.fS.time},r={name:`Value #${t}`,config:{},values:[],type:ce.fS.number},a=new Set(s.map(p=>p.fields.map(f=>Object.keys(f.labels??{})).flat()).flat()),l=Array.from(a).sort().map(p=>({name:p,config:{filterable:!0},values:[],type:ce.fS.string}));return s.forEach(p=>{const f=p.fields.find(V=>V.type===ce.fS.time),b=p.fields.find(V=>V.type===ce.fS.number);if(f==null||b==null)return;const $=f.values,Y=b.values;for(let V of $)e.values.push(V);for(let V of Y)r.values.push(V);const q=b.labels??{};for(let V of l){const se=q[V.name]??"";for(let ae=0;ae<Y.length;ae++)V.values.push(se)}}),{fields:[e,...l,r],refId:t,meta:{preferredVisualisationType:"table"},length:e.values.length}}function Ir(s){return s.fields.every(t=>t.type===ce.fS.time||t.type===ce.fS.number)}function Tt(s,t){const{meta:e,...r}=s,a={...e,...t};return{...r,meta:a}}function ot(s,t,e){const r={...s.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,B.vh)(s)&&(r.error="Error when parsing some of the logs");const a={preferredVisualisationType:"logs",limit:t?.maxLines,searchWords:t!==void 0?(0,le.n6)((0,le.x9)(t.expr)):void 0,custom:r},n=Tt(s,a),l=At(n,e);return{...n,fields:[...n.fields,...l]}}function ar(s,t,e){return s.map(r=>{const a=r.refId!==void 0?t.get(r.refId):void 0;return ot(r,a,e)})}function nr(s){return s.length>0?qe(s):[]}function sr(s){const t={preferredVisualisationType:"graph"};return s.map(e=>Tt(e,t))}function ir(s,t){const e=[],r=[],a=[];return s.forEach(n=>{Ir(n)?n.refId!=null&&t.get(n.refId)?.queryType===d.EM.Instant?r.push(n):a.push(n):e.push(n)}),{streamsFrames:e,metricInstantFrames:r,metricRangeFrames:a}}function or(s,t){if(s===void 0)return s;const{refId:e,message:r}=s;if(e===void 0||r===void 0)return s;const a=t.get(e);return a===void 0?s:r.includes("escape")&&a.expr.includes("\\")?{...s,message:`${r}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:s}function lr(s,t,e){const{data:r,error:a,...n}=s,l=r.map(Y=>{if(!(0,It.aY)(Y))throw new Error("transformation only supports dataframe responses");return Y}),p=new Map(t.map(Y=>[Y.refId,Y])),{streamsFrames:f,metricInstantFrames:b,metricRangeFrames:$}=ir(l,p);return{...n,error:or(a,p),data:[...sr($),...nr(b),...ar(f,p,e)]}}var Ne=i(87355),tt=i(46101),Ve=i(38637),Ar=i(9865),Ur=i(88132);const Wr=(0,K.memo)(function(t){const{annotation:e,onAnnotationChange:r,history:a}=t;if(e===void 0||r===void 0)return null;const n=p=>{const f=(0,le.Ib)(p).queryType===d.EM.Instant;r({...e,expr:p.expr,maxLines:p.maxLines,instant:f})},l={refId:"",expr:e.expr,maxLines:e.maxLines,instant:e.instant,queryType:e.queryType};return K.createElement(K.Fragment,null,K.createElement("div",{className:"gf-form-group"},K.createElement(Ur.n,{datasource:t.datasource,query:l,onChange:n,onRunQuery:()=>{},history:a,ExtraFieldElement:K.createElement(Ar.JX,{lineLimitValue:l?.maxLines?.toString()||"",resolution:l.resolution||1,query:l,onRunQuery:()=>{},onChange:n})})),K.createElement(Ne.p,null,K.createElement(tt.S,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},K.createElement(Ve.I,{type:"text",placeholder:"alertname",value:e.titleFormat,onChange:p=>{r({...e,titleFormat:p.currentTarget.value})}})),K.createElement(tt.S,{label:"Tags"},K.createElement(Ve.I,{type:"text",placeholder:"label1,label2",value:e.tagKeys,onChange:p=>{r({...e,tagKeys:p.currentTarget.value})}})),K.createElement(tt.S,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},K.createElement(Ve.I,{type:"text",placeholder:"instance",value:e.textFormat,onChange:p=>{r({...e,textFormat:p.currentTarget.value})}}))))});var ur=i(16699);const cr=/^label_names\(\)\s*$/,mr=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function jr(s){if(typeof s!="string")return s;const t={refId:"LokiVariableQueryEditor-VariableQuery",type:d.Z3.LabelNames};if(s.match(cr))return{...t,type:d.Z3.LabelNames};const r=s.match(mr);return r?{...t,type:d.Z3.LabelValues,label:r[2]?r[2]:r[1],stream:r[2]?r[1]:void 0}:t}function Vr(s,t){if(t.length===0)return[];const e=[],{queryWithParser:r,parserCount:a}=(0,le.cQ)(s);if(!r){const{hasLogfmt:p,hasJSON:f,hasPack:b}=(0,B.OP)(t[0]);f&&(b?e.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:s}}}):e.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:s}}})),p&&e.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:s}}})}if(r){if(a===1){const f=(0,le.N7)(s);(0,B.ki)(t[0])&&!f&&e.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:s}}})}(0,le.Iu)(s)||e.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:s}}})}if(!(0,le.hI)(s)){const p=(0,B.EO)(t[0]),f=(0,B.Y)(t[0]);!p&&f&&e.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${f}" label.`,fix:{title:"add label level format",label:`If ${f} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:s,options:{renameTo:"level",originalLabel:f}}}})}return(0,le.Qh)(s)||e.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:s}}}),e}var Kr=i(34032),kr=i(33975),Gr=i(30976),Rt=i(5195),Ut=i(41406);function Zr(s,t,e){if(t-s<=e)return[[s,t]];const r=[];for(let a=t;a>s;a-=e){const n=Math.max(a-e,s);r.push([n,a])}return r.reverse(),r}function zr(s,t,e){const r=s-s%e;let a=t;const n=t%e;return n!==0&&(a+=e-n),[r,a]}function lt(s,t,e,r){if(r<e)return[[s,t]];const a=Math.trunc(r/e)*e,[n,l]=zr(s,t,e),p=[];for(let f=l;f>n;f-=a+e){const b=Math.max(f-a,n);p.push([b,f])}return p.reverse(),p}var Ke=i(17583);function rt(s,t,e,r){const a=t.from.toDate().getTime(),n=t.to.toDate().getTime();return(s?Zr(a,n,r):lt(a,n,e,r)).map(([p,f])=>{const b=(0,E.CQ)(p),$=(0,E.CQ)(f);return{from:b,to:$,raw:{from:b,to:$}}})}function at(s,t){return t?s.map(e=>{if(!e.maxLines||!(0,le.rE)(e.expr))return e;const r=t.data.find(n=>n.refId===e.refId);if(!r)return e;const a=e.maxLines-r.length;return{...e,maxLines:a<0?0:a}}).filter(e=>e.maxLines===void 0||e.maxLines>0):s}function ut(s,t){let e={data:[],state:Ut.Gu.Streaming};const r=Math.max(...t.map(({partition:b})=>b.length)),a=t.filter(({partition:b})=>b.length===r)[0].partition;let n=!1,l=null;const p=(b,$,Y)=>{if(n){b.complete();return}const q=()=>{e.state=Ut.Gu.Done,b.next(e),b.complete()},V=()=>{const{nextRequestN:_e,nextRequestGroup:je}=Jr(t,Y,$);if(_e>0&&je>=0){p(b,_e,je);return}q()},se=t[Y],ae=se.partition[$-1],Le=at(se.request.targets,e);if(!Le.length){V();return}const Se={...t[Y].request,range:ae,targets:Le};se.request.requestId&&(Se.requestId=`${se.request.requestId}_${$}`),l=s.runQuery(Se).subscribe({next:_e=>{e=(0,B._P)(e,_e),e=Hr(e,Se,a,$),((e.errors??[]).length>0||e.error!=null)&&(n=!0)},complete:()=>{b.next(e),V()},error:_e=>{b.error(_e)}})};return new Dt.y(b=>(p(b,r,0),()=>{n=!0,l?.unsubscribe()}))}function Hr(s,t,e,r){if((0,le.rE)(t.targets[0].expr)||Yr(t))return s;const a="loki-splitting-progress";if(s.data=s.data.filter(l=>l.name!==a),r<=1)return s;const n=(0,kr.P)([{time:e[0].from.valueOf(),timeEnd:e[r-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return n.name=a,n.meta={dataTopic:Gr.w5.Annotations},s.data.push(n),s}function Yr(s){return s.targets.some(t=>t.refId.startsWith("log-volume"))}function Jr(s,t,e){for(let r=t+1;r<s.length;r++)if(s[r].partition[e-1])return{nextRequestGroup:r,nextRequestN:e};return{nextRequestGroup:s.findIndex(r=>r?.partition[e-1]!==void 0),nextRequestN:e-1}}function ke(s){return s.queryType!==d.EM.Instant&&!(0,le.zE)(s.expr)}function qr(s,t){const e=t.targets.filter(q=>!q.hide).filter(q=>q.expr),[r,a]=(0,v.partition)(e,q=>!ke(q)),[n,l]=(0,v.partition)(a,q=>(0,le.rE)(q.expr));t.queryGroupId=(0,Kr.Z)();const p=24*60*60*1e3,f=(0,v.groupBy)(n,q=>q.splitDuration?(0,Rt.iX)((0,Rt.RA)(q.splitDuration)):p),b=(0,v.groupBy)(l,q=>q.splitDuration?(0,Rt.iX)((0,Rt.RA)(q.splitDuration)):p),$=[];for(const[q,V]of Object.entries(f)){const se=(0,v.groupBy)(V,ae=>ae.resolution||1);for(const ae in se)$.push({request:{...t,targets:se[ae]},partition:rt(!0,t.range,t.intervalMs,Number(q))})}for(const[q,V]of Object.entries(b)){const se=(0,v.groupBy)(V,ae=>ct(t.intervalMs,t.range,ae.resolution||1,ae.step));for(const ae in se)$.push({request:{...t,targets:se[ae]},partition:rt(!1,t.range,Number(ae),Number(q))})}r.length&&$.push({request:{...t,targets:r},partition:[t.range]});const Y=new Date;return ut(s,$).pipe((0,Z.b)(q=>{q.state===Ut.Gu.Done&&(0,Ke.Dl)(q,$,t,Y,{predefinedOperations:s.predefinedOperations})}))}function ct(s,t,e,r){const a=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(r?.match(a))return ue.intervalToMs(r)*e;const n=s*e,l=Math.round((t.to.valueOf()-t.from.valueOf())/11e3);return Math.max(n,l)}var St=i(53072),_t=i(26058),dr=i(48614),pr=i(16843);async function fr(s){const t=JSON.stringify({expr:s.expr}),e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(r.slice(0,8))).map(n=>n.toString(16).padStart(2,"0")).join("")}function gr(s,t,e){const r=e.range,a=r.to.valueOf()-r.from.valueOf()+1e3;let n=e.maxDataPoints??1e3;n>100&&(n*=2);let l;const p=f=>{if(f?.message){const b=f.message;l?l.push(b):l=_t.Av.fromDataFrameJSON(b,{maxLength:n,maxDelta:a,displayNameFormat:s.legendFormat})}return l};return(0,St.P)(()=>fr(s)).pipe((0,st.z)(f=>(0,pr.gj)().getStream({scope:dr.z.DataSource,namespace:t.uid,path:`tail/${f}`,data:{...s,timeRange:{from:r.from.valueOf().toString(),to:r.to.valueOf().toString()}}}).pipe((0,O.U)(b=>{const $=p(b);return{data:$?[$]:[],state:pe.Gu.Streaming}}))))}var ea=i(22605),ta=i(95405);const Or=[{label:"Label names",value:d.Z3.LabelNames},{label:"Label values",value:d.Z3.LabelValues}],hr="LokiVariableQueryEditor-VariableQuery",ra=({onChange:s,query:t,datasource:e})=>{const[r,a]=(0,K.useState)(void 0),[n,l]=(0,K.useState)(""),[p,f]=(0,K.useState)([]),[b,$]=(0,K.useState)("");(0,K.useEffect)(()=>{if(!t)return;const ae=typeof t=="string"?jr(t):t;a(ae.type),l(ae.label||""),$(ae.stream||"")},[t]),(0,K.useEffect)(()=>{r===d.Z3.LabelValues&&e.labelNamesQuery().then(ae=>{f(ae.map(({text:Le})=>({label:Le,value:Le})))})},[e,r]);const Y=ae=>{a(ae.value),ae.value!==void 0&&s({type:ae.value,label:n,stream:b,refId:hr})},q=ae=>{l(ae.value||"")},V=ae=>{$(ae.currentTarget.value)},se=()=>{r!==void 0&&s({type:r,label:n,stream:b,refId:"LokiVariableQueryEditor-VariableQuery"})};return K.createElement(K.Fragment,null,K.createElement(We.Z,null,K.createElement(Et._,{label:"Query type",labelWidth:20},K.createElement(Pt.Ph,{"aria-label":"Query type",onChange:Y,onBlur:se,value:r,options:Or,width:16})),r===d.Z3.LabelValues&&K.createElement(K.Fragment,null,K.createElement(Et._,{label:"Label",labelWidth:20},K.createElement(Pt.Ph,{"aria-label":"Label",onChange:q,onBlur:se,value:{label:n,value:n},options:p,width:16,allowCustomValue:!0})))),r===d.Z3.LabelValues&&K.createElement(We.Z,null,K.createElement(Et._,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:K.createElement("div",null,'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}')},K.createElement(Ve.I,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:b,onChange:V,onBlur:se}))))};class aa extends ta.Mg{constructor(t){super(),this.datasource=t,this.editor=ra}async execute(t){return this.datasource.metricFindQuery(t)}query(t){const e=this.execute(t.targets[0]);return(0,ea.D)(e).pipe((0,O.U)(r=>({data:r})))}}const na=1e3,oa="/loki/api/v1",nt="loki-data-samples",Ft="annotation-",mt="log-row-context-query-",Ge="log-volume-",vr="log-sample-",we=1e6;function Ze(s,t,e,r,a){const n=ue.calculateInterval(t,1);return{targets:[s],requestId:r,interval:n.interval,intervalMs:n.intervalMs,range:t,scopedVars:{},timezone:"UTC",app:e,startTime:Date.now(),hideFromInspector:a}}class br extends A.CK{constructor(t,e=(0,U.J)(),r=(0,z.$t)()){super(t),this.instanceSettings=t,this.templateSrv=e,this.timeSrv=r,this.streams=new ze,this.runLiveQuery=(n,l)=>{const p=this.createLiveTarget(n,l);return this.streams.getStream(p).pipe((0,O.U)(f=>({data:f||[],key:`loki-${p.refId}`,state:pe.Gu.Streaming})),(0,j.K)(f=>(0,R._)(()=>`Live tailing was stopped due to following error: ${f.reason}`)))},this.getLogRowContext=async(n,l,p)=>await this.logContextProvider.getLogRowContext(n,l,(0,le.QT)(p)),this.getLogRowContextQuery=async(n,l,p)=>await this.logContextProvider.getLogRowContextQuery(n,l,(0,le.QT)(p)),this.languageProvider=new Ee(this);const a=t.jsonData||{};this.maxLines=parseInt(a.maxLines??"0",10)||na,this.predefinedOperations=a.predefinedOperations??"",this.annotations={QueryEditor:Wr},this.variables=new aa(this),this.logContextProvider=new Xr(this)}getDataProvider(t,e){if(this.getSupportedSupplementaryQueryTypes().includes(t))switch(t){case ne.v8.LogsVolume:return this.getLogsVolumeDataProvider(e);case ne.v8.LogsSample:return this.getLogsSampleDataProvider(e);default:return}}getSupportedSupplementaryQueryTypes(){return[ne.v8.LogsVolume,ne.v8.LogsSample]}getSupplementaryQuery(t,e){if(!this.getSupportedSupplementaryQueryTypes().includes(t.type))return;const r=(0,le.Ib)(e),a=(0,be.C6)(r.expr);let n=!1;switch(t.type){case ne.v8.LogsVolume:return n=!!(a&&(0,le.rE)(a)&&r.queryType===d.EM.Range),n?{...r,refId:`${Ge}${r.refId}`,queryType:d.EM.Range,supportingQueryType:d.$o.LogsVolume,expr:`sum by (level) (count_over_time(${a}[$__auto]))`}:void 0;case ne.v8.LogsSample:return n=!!(a&&!(0,le.rE)(a)),n?{...r,queryType:d.EM.Range,refId:`${vr}${r.refId}`,expr:(0,le.SP)(a),maxLines:Number.isNaN(Number(t.limit))?this.maxLines:Number(t.limit)}:void 0;default:return}}getLogsVolumeDataProvider(t){const e=(0,v.cloneDeep)(t),r=e.targets.map(a=>this.getSupplementaryQuery({type:ne.v8.LogsVolume},a)).filter(a=>!!a);if(r.length)return(0,m.Bz)(this,{...e,targets:r},{extractLevel:Ae,range:t.range,targets:t.targets})}getLogsSampleDataProvider(t){const e=(0,v.cloneDeep)(t),r=e.targets.map(a=>this.getSupplementaryQuery({type:ne.v8.LogsSample,limit:100},a)).filter(a=>!!a);if(r.length)return(0,m.Ce)(this,{...e,targets:r})}query(t){const e=t.targets.map(le.Ib).map(l=>({...l,maxLines:l.maxLines??this.maxLines})),r={...t,targets:e},a=r.targets.filter(l=>l.queryType===d.EM.Stream);if(I.config.featureToggles.lokiExperimentalStreaming&&a.length>0&&r.rangeRaw?.to==="now"){const l={...r,targets:a};return(0,u.T)(...a.map(p=>gr(this.applyTemplateVariables(p,t.scopedVars),this,l)))}if(r.liveStreaming)return this.runLiveQueryThroughBackend(r);if(I.config.featureToggles.lokiQuerySplitting&&(0,le.TH)(r.targets))return qr(this,r);const n=new Date;return this.runQuery(r).pipe((0,Z.b)(l=>(0,Ke.Ci)(l,r,n,{predefinedOperations:this.predefinedOperations})))}runQuery(t){return super.query(t).pipe((0,O.U)(e=>lr(e,t.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(t){const e=t.targets.filter(a=>a.expr!==""&&(0,le.rE)(a.expr));if(e.length===0)return(0,H.of)({data:[],state:pe.Gu.Done});const r=e.map(a=>{const n=a.maxLines||this.maxLines;return this.runLiveQuery(a,n)});return(0,u.T)(...r)}createLiveTarget(t,e){const r=t.expr,a=this.instanceSettings.url,n=(0,T.tW)({query:r});return{query:r,url:(0,k.F3)(`${a}/loki/api/v1/tail?${n}`),refId:t.refId,size:e}}interpolateVariablesInQueries(t,e){let r=t;return t&&t.length&&(r=t.map(a=>({...a,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(a.expr,e,this.interpolateQueryExpr))}))),r}getQueryDisplayText(t){return t.expr}getTimeRange(){return this.timeSrv.timeRange()}getTimeRangeParams(){const t=this.getTimeRange();return{start:t.from.valueOf()*we,end:t.to.valueOf()*we}}async importFromAbstractQueries(t){await this.languageProvider.start();const e=this.languageProvider.labelKeys;return e&&e.length&&(t=t.map(r=>(r.labelMatchers=r.labelMatchers.filter(a=>e.includes(a.name)),r))),t.map(r=>this.languageProvider.importFromAbstractQuery(r))}async exportToAbstractQueries(t){return t.map(e=>this.languageProvider.exportToAbstractQuery(e))}async metadataRequest(t,e,r){if(t.startsWith("/"))throw new Error(`invalid metadata request url: ${t}`);return(await this.getResource(t,e,r)).data||[]}async statsMetadataRequest(t,e,r){if(t.startsWith("/"))throw new Error(`invalid metadata request url: ${t}`);return await this.getResource(t,e,r)}async getQueryStats(t){if((0,le.I2)(this.interpolateString(t.expr,ur.t)))return;const e=(0,le.QI)(t.expr);let r={streams:0,chunks:0,bytes:0,entries:0};for(const a in e){const{start:n,end:l}=this.getStatsTimeRange(t,Number(a));if(n===void 0||l===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const p=await this.statsMetadataRequest("index/stats",{query:e[a],start:n,end:l},{showErrorAlert:!1});r={streams:r.streams+p.streams,chunks:r.chunks+p.chunks,bytes:r.bytes+p.bytes,entries:r.entries+p.entries}}catch{break}}return r}getStatsTimeRange(t,e){let r,a;const p=(0,le.Yk)(t.expr,[L.nL]).map(f=>t.expr.substring(f.from,f.to));return(0,le.rE)(t.expr)?t.queryType===d.EM.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams():t.queryType===d.EM.Instant?p[e]?(a=this.getTimeRangeParams().end,r=a-(0,ue.intervalToMs)(p[e])*1e6,{start:r,end:a}):/(\$__auto|\$__range)/.test(t.expr)?this.getTimeRangeParams():{start:void 0,end:void 0}:this.getTimeRangeParams()}async getStats(t){if(!t)return null;const e=await this.getQueryStats(t);return e?Object.values(e).every(r=>r===0)?null:e:null}async metricFindQuery(t){if(!t)return Promise.resolve([]);if(typeof t=="string"){const r=this.interpolateString(t);return await this.legacyProcessMetricFindQuery(r)}const e={...t,label:this.interpolateString(t.label||""),stream:this.interpolateString(t.stream||"")};return await this.processMetricFindQuery(e)}async processMetricFindQuery(t){return t.type===d.Z3.LabelNames?this.labelNamesQuery():t.label?t.stream?this.labelValuesSeriesQuery(t.stream,t.label):this.labelValuesQuery(t.label):[]}async legacyProcessMetricFindQuery(t){if(t.match(cr))return await this.labelNamesQuery();const r=t.match(mr);return r?r[1]?await this.labelValuesSeriesQuery(r[1],r[2]):await this.labelValuesQuery(r[2]):Promise.resolve([])}async labelNamesQuery(){const t="labels",e=this.getTimeRangeParams();return(await this.metadataRequest(t,e)).map(a=>({text:a}))}async labelValuesQuery(t){const e=this.getTimeRangeParams(),r=`label/${t}/values`;return(await this.metadataRequest(r,e)).map(n=>({text:n}))}async labelValuesSeriesQuery(t,e){const a={...this.getTimeRangeParams(),"match[]":t},n="series",l=new Set;return(await this.metadataRequest(n,a)).forEach(f=>{f[e]&&l.add({text:f[e]})}),Array.from(l)}async getDataSamples(t){if(!(0,le.rE)(t.expr)||(0,le.I2)(this.interpolateString(t.expr,ur.t)))return[];const e={expr:t.expr,queryType:d.EM.Range,refId:nt,maxLines:10},r=this.getTimeRange(),a=Ze(e,r,D.zj.Unknown,nt,!0);return await(0,re.n)(this.query(a).pipe((0,ge.w)(n=>(0,H.of)(n.data))))}async getTagKeys(){return await this.labelNamesQuery()}async getTagValues(t={}){return await this.labelValuesQuery(t.key)}interpolateQueryExpr(t,e){return!e.multi&&!e.includeAll?dt(t):typeof t=="string"?Ce(t):(0,v.map)(t,Ce).join("|")}toggleQueryFilter(t,e){let r=t.expr??"";switch(e.type){case"FILTER_FOR":{if(e.options?.key&&e.options?.value){const a=(0,Xe.Hk)(e.options.value);r=(0,be.j2)(r,e.options.key,"=",a)?(0,be.zX)(r,e.options.key,"=",a):(0,be.F2)(r,e.options.key,"=",a)}break}case"FILTER_OUT":{if(e.options?.key&&e.options?.value){const a=(0,Xe.Hk)(e.options.value);(0,be.j2)(r,e.options.key,"=",a)&&(r=(0,be.zX)(r,e.options.key,"=",a)),r=(0,be.F2)(r,e.options.key,"!=",a)}break}default:break}return{...t,expr:r}}queryHasFilter(t,e){let r=t.expr??"";return(0,be.j2)(r,e.key,"=",e.value)}modifyQuery(t,e){let r=t.expr??"";const a=this.languageProvider.getLabelKeys();switch(e.type){case"ADD_FILTER":{if(e.options?.key&&e.options?.value){const n=(0,Xe.Hk)(e.options.value);r=(0,be.F2)(r,e.options.key,"=",n,a.includes(e.options.key)===!1)}break}case"ADD_FILTER_OUT":{if(e.options?.key&&e.options?.value){const n=(0,Xe.Hk)(e.options.value);r=(0,be.F2)(r,e.options.key,"!=",n,a.includes(e.options.key)===!1)}break}case"ADD_LOGFMT_PARSER":{r=(0,be.Pg)(r,"logfmt");break}case"ADD_JSON_PARSER":{r=(0,be.Pg)(r,"json");break}case"ADD_UNPACK_PARSER":{r=(0,be.Pg)(r,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{r=(0,be.cT)(r);break}case"ADD_LEVEL_LABEL_FORMAT":{e.options?.originalLabel&&e.options?.renameTo&&(r=(0,be.NT)(r,{renameTo:e.options.renameTo,originalLabel:e.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const n=(0,be.qC)(t.expr),l=(0,be.st)(t.expr),p=(0,be.EF)([...n,...l]),f=(0,be.y2)("","","=");r=(0,be.g8)(r,[p],f);break}case"ADD_LINE_FILTER":{r=(0,be.Ld)(r);break}default:break}return{...t,expr:r}}getLogRowContextUi(t,e,r){return this.logContextProvider.getLogRowContextUi(t,e,(0,le.QT)(r))}async annotationQuery(t){const{expr:e,maxLines:r,instant:a,tagKeys:n="",titleFormat:l="",textFormat:p=""}=t.annotation;if(!e)return[];const f=`${Ft}${t.annotation.name}`,b={refId:f,expr:e,maxLines:r,instant:a,queryType:a?d.EM.Instant:d.EM.Range},$=Ze(b,t.range,D.zj.Dashboard,f),{data:Y}=await(0,re.n)(this.query($)),q=[],V=n.split(",").filter(se=>se!=="");for(const se of Y)new h.U(se).forEach(Le=>{const{labels:Se}=Le,_e=Object.entries(Se).map(([P,x])=>[P,x.trim()]).filter(([P,x])=>!(x===""||V.length&&!V.includes(P))).map(([P,x])=>x),je=Array.from(new Set(_e));q.push({time:new Date(Le.Time).valueOf(),title:(0,ye.W)(l,Se),text:(0,ye.W)(p,Se)||Le.Line,tags:je})});return q}showContextToggle(t){return!0}addAdHocFilters(t){const e=this.templateSrv.getAdhocFilters(this.name);let r=(0,Q.bU)(t);return r=e.reduce((a,n)=>{const{key:l,operator:p}=n;let{value:f}=n;return(0,Xe._z)(p)?f=dt(f):f=(0,Xe.Hk)(f,p),(0,be.F2)(a,l,p,f)},r),(0,Q.Tt)(r)}filterQuery(t){return!(t.hide||t.expr==="")}applyTemplateVariables(t,e){const{__auto:r,__interval:a,__interval_ms:n,__range:l,__range_s:p,__range_ms:f,...b}=e||{},$=this.addAdHocFilters(t.expr);return{...t,legendFormat:this.templateSrv.replace(t.legendFormat,b),expr:this.templateSrv.replace($,b,this.interpolateQueryExpr)}}interpolateString(t,e){return this.templateSrv.replace(t,e,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(t=>`$${t.name}`)}getQueryHints(t,e){return Vr(t.expr,e)}getDefaultQuery(t){const e={refId:"A",expr:""};return t===D.zj.UnifiedAlerting?{...e,queryType:d.EM.Instant}:{...e,queryType:d.EM.Range}}}function dt(s){return typeof s=="string"?s.replace(/'/g,"\\\\'"):s}function Ce(s){return typeof s=="string"?dt(s.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):s}function Ae(s){let t;try{t=new $e.N(s).getFirstFieldOfType(ce.fS.number)}catch{}return t?.labels?pt(t.labels):ne.in.unknown}function pt(s){const t=["level","lvl","loglevel"];let e;for(let r of t)if(r in s){e=r;break}return e?(0,X.jx)(s[e]):ne.in.unknown}},65415:(Me,he,i)=>{i.d(he,{C6:()=>L,EF:()=>N,F2:()=>h,Ff:()=>Z,Ld:()=>g,NT:()=>ce,Pg:()=>ye,Xw:()=>A,cT:()=>$e,g8:()=>Q,j2:()=>ge,qC:()=>k,st:()=>z,y2:()=>m,zX:()=>ue});var v=i(86832),R=i.n(v),u=i(71258),H=i(38793),re=i(11569),O=i(53859),j=i(59983);class Z{constructor(o,c,y){this.from=o,this.to=c,this.type=y}static fromNode(o){return new Z(o.from,o.to,o.type)}contains(o){return this.from<=o.from&&this.to>=o.to}getExpression(o){return o.substring(this.from,this.to)}}function ge(d,o,c,y){return D(d,o,c,y).length>0}function ue(d,o,c,y){const F=D(d,o,c,y);for(const W of F)d=W.parent?.type.id===u.pj?pe(d,W):ne(d,W);return d}function pe(d,o){const c=o.parent?.parent;return!c||c.type.id!==u.We?d:(d.substring(0,c.from)+d.substring(c.to)).trim()}function ne(d,o){let c=o;do c=c.parent;while(c&&c.type.id!==u.Qf);const y=o.getChild(u.xb);if(!c||!y)return d;const F=d.substring(y.from,y.to),W=d.substring(0,c.from),J=d.substring(c.to),me=(0,j._z)(d.substring(c.from,c.to));return me.query.labels=me.query.labels.filter(fe=>fe.label!==F),W+O.y.renderQuery(me.query)+J}function D(d,o,c,y){const F=u.E2.parse(d),W=[];return F.iterate({enter:({type:J,node:me})=>{J.id===u.xO&&W.push(me)}}),W.filter(J=>{const me=J.getChild(u.xb),fe=me?.nextSibling,xe=J.getChild(u.Ld);if(!me||!fe||!xe||d.substring(me.from,me.to)!==o)return!1;const Re=d.substring(xe.from,xe.to);return!((0,j.LE)(Re)!==(0,H.iS)(y)||d.substring(fe.from,fe.to)!==c)})}function h(d,o,c,y,F=!1){if(!o||!y)throw new Error("Need label to add to query.");const W=A(d);if(!W.length)return d;const J=I(d),me=W.every(Re=>J.some(Ue=>Ue.from>=Re.from&&Ue.to<=Re.to)),fe=k(d),xe=z(d),Ee=m(o,y,c);if(F){const Re=N([...W,...xe,...fe]);return Q(d,[Re],Ee)}else if(me&&(xe.length||fe.length)){const Re=S((0,re.te)(d,[u.wi])),Ue=[...fe,...xe],st=Re.map(Ct=>N(Ue.filter(ft=>Ct.contains(ft))));return Q(d,st,Ee)}else return X(d,W,Ee)}function ye(d,o){const c=U(d);if(c.length)return te(d,c,o);{const y=A(d);return y.length?te(d,y,o):d}}function $e(d){const o=k(d);if(!o.length)return d;const c=m("__error__","","=");return Q(d,o,c)}function ce(d,o){const c=T(d);return ve(d,c,o)}function L(d){const o=E(d);if(!o.length)return d;let c="",y=0;for(let F of o)c=c+d.substring(y,F.from),y=F.to;return c=c+d.substring(y),c}function A(d){const o=u.E2.parse(d),c=[];return o.iterate({enter:({type:y,node:F})=>{if(y.id===u.Qf)return c.push(Z.fromNode(F)),!1}}),c}function I(d){const o=u.E2.parse(d),c=[];return o.iterate({enter:({node:y})=>{y.type.id===u.Qf&&c.push(...B(y,u.xO))}}),c}function k(d){const o=u.E2.parse(d),c=[],y=[u.Li,u.Lu,u.dp,u.m7];return o.iterate({enter:({type:F,node:W})=>{if(y.includes(F.id))return c.push(Z.fromNode(W)),!1}}),c}function z(d){const o=u.E2.parse(d),c=[];return o.iterate({enter:({type:y,node:F})=>{if(y.id===u.pj)return c.push(Z.fromNode(F)),!1}}),c}function U(d){const o=u.E2.parse(d),c=[];return o.iterate({enter:({type:y,node:F})=>{if(y.id===u.wm)return c.push(Z.fromNode(F)),!1}}),c}function T(d){const o=u.E2.parse(d),c=[];return o.iterate({enter:({type:y,node:F})=>{if(y.id===u.bL)return c.push(Z.fromNode(F)),!1;if(y.id===u.UN){const W=[],J=F.getChild(u.Qf);J&&W.push(Z.fromNode(J));const me=F.getChild(u.iP);me&&W.push(Z.fromNode(me));const fe=F.getChild(u.Xt);fe&&W.push(Z.fromNode(fe));const xe=(0,v.sortBy)(W,Ee=>Ee.to);return c.push(new Z(xe[0].from,xe[xe.length-1].to)),!1}}}),c}function m(d,o,c){return{label:d,op:c,value:o}}function X(d,o,c){let y="",F=0;for(let W=0;W<o.length;W++){const J=o[W],me=W===o.length-1,fe=d.substring(F,J.from),xe=me?d.substring(J.to):"",Ee=(0,j._z)(d.substring(J.from,J.to));_(Ee.query.labels,c)||Ee.query.labels.push(c);const Re=O.y.renderQuery(Ee.query);y+=fe+Re+xe,F=J.to}return y}function Q(d,o,c){let y="",F=0;for(let W=0;W<o.length;W++){const J=o[W],me=W===o.length-1,fe=d.substring(F,J.to),xe=me?d.substring(J.to):"";let Ee="";!Number.isNaN(Number(c.value))&&(c.op==="<"||c.op===">")?Ee=` | ${c.label}${c.op}${Number(c.value)}`:Ee=` | ${c.label}${c.op}\`${(0,H.iS)(c.value)}\``,y+=fe+Ee+xe,F=J.to}return y}function te(d,o,c){let y="",F=0;for(let W=0;W<o.length;W++){const J=o[W],me=W===o.length-1,fe=d.substring(F,J.to),xe=me?d.substring(J.to):"";y+=fe+` | ${c}`+xe,F=J.to}return y}function ve(d,o,c){let y="",F=0;for(let W=0;W<o.length;W++){const J=o[W],me=W===o.length-1,fe=d.substring(F,J.to),xe=me?d.substring(J.to):"",Ee=` | label_format ${c.renameTo}=${c.originalLabel}`;y+=fe+Ee+xe,F=J.to}return y}function g(d){const o=A(d);if(!o.length)return d;const c=o[0].to;return d.slice(0,c)+" |= ``"+d.slice(c)}function E(d){const o=u.E2.parse(d),c=[];return o.iterate({enter:({type:y,from:F,to:W})=>{if(y.id===u.gD)return c.push(new Z(F,W,y)),!1}}),c}function _(d,o){return d.find(c=>c.label===o.label&&c.value===o.value)}function N(d){return d.reduce((o,c)=>o.to>c.to?o:c)}function B(d,o){if(d.type.id===o)return[Z.fromNode(d)];const c=[];let y=0,F=d.childAfter(y);for(;F;)c.push(...B(F,o)),y=F.to,F=d.childAfter(y);return c}function S(d){return d.filter(o=>d.every(c=>o.contains(c)===!1||o===c))}},11569:(Me,he,i)=>{i.d(he,{Eb:()=>te,H6:()=>ye,I2:()=>k,Ib:()=>pe,Iu:()=>ve,Ix:()=>d,Lw:()=>ne,N7:()=>m,QI:()=>_,QT:()=>S,Qh:()=>g,SP:()=>Q,TH:()=>N,Yk:()=>L,cQ:()=>U,dQ:()=>$e,hI:()=>X,n6:()=>ue,oi:()=>T,rE:()=>z,te:()=>A,x9:()=>ge,zE:()=>E});var v=i(86832),R=i.n(v),u=i(71258),H=i(72639),re=i(65234),O=i(16699),j=i(65415),Z=i(73363);function ge(o){return`${o||""}`.trim()}function ue(o){const c=[],y=L(o,[u.yx]);for(let F of y){const W=F.getChild(u.wn)?.getChild(u.OC),J=F.getChild(u.wn)?.getChild(u.Ih),me=F.getChild(u.Ld);if(!W&&!J||!me)continue;const fe=o.substring(me.from,me.to).trim(),xe=fe[0]==="`",Ee=fe.substring(1,fe.length-1);if(!Ee)continue;let Re="";J?Re=xe?Ee:Ee.replace(/\\\\/g,"\\"):Re=(0,v.escapeRegExp)(Ee),Re&&c.push(Re)}return c}function pe(o){const c=ne(o),{instant:y,range:F,...W}=o;return{...W,queryType:c}}function ne(o){const{queryType:c}=o;return c===Z.EM.Range||c===Z.EM.Instant||c===Z.EM.Stream?c:o.instant===!0?Z.EM.Instant:Z.EM.Range}const D=["String","Identifier","LineComment","Number"],h=["__error__","__interval","__interval_ms","__auto"];function ye(o){let c=o;return u.E2.parse(o).iterate({enter:({name:F,from:W,to:J})=>{const me=o.substring(W,J);D.includes(F)&&!h.includes(me)&&(c=c.replace(me,F))}}),c}function $e(o){const c=[];return u.E2.parse(o).iterate({enter:({name:F})=>{c.push(F)}}),c}function ce(o,c){let y=!1;return u.E2.parse(o).iterate({enter:({type:W})=>{if(W.id===c)return y=!0,!1}}),y}function L(o,c){const y=[];return u.E2.parse(o).iterate({enter:W=>{(c===void 0||c.includes(W.type.id))&&y.push(W.node)}}),y}function A(o,c){const y=[];return u.E2.parse(o).iterate({enter:W=>{(c===void 0||c.includes(W.type.id))&&y.push(j.Ff.fromNode(W.node))}}),y}function I(o,c){const y=L(o,[c]);return y.length>0?y[0]:void 0}function k(o){return ce(o,re._A)}function z(o){return!ce(o,u.cq)}function U(o){const y=L(o,[u.Li,u.Lu,u.af]).length;return{queryWithParser:y>0,parserCount:y}}function T(o){const c=L(o,[u.Li,u.bb,u.af]);return c.length>0?o.substring(c[0].from,c[0].to).trim():void 0}function m(o){const c=L(o,[u.pj]);for(const y of c){const F=y.getChild(u.xO)?.getChild(u.xb);if(F&&o.substring(F.from,F.to)==="__error__")return!0}return!1}function X(o){return ce(o,u.zV)}function Q(o){if(z(o))return o;const c=I(o,u.Qf);if(!c)return"";const y=o.substring(c.from,c.to),F=I(o,u.iP),W=F?o.substring(F.from,F.to):"";return`${y} ${W}`.trim()}function te(o,c){if(z(o))return o;const y=L(o,[u.cq]).reverse().find(F=>F.from<=c&&F.to>=c);return y?Q(o.substring(y.from,y.to)):""}function ve(o){return ce(o,u.pj)}function g(o){return ce(o,u.yx)}function E(o){const c=L(o,[u.e6]);for(const y of c)if(o.substring(y.from,y.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function _(o){return(0,j.Xw)(o).map(F=>o.slice(F.from,F.to))}function N(o){return o.filter(y=>!y.hide).filter(y=>!y.refId.includes("do-not-chunk")).filter(y=>y.expr).length>0}const B=o=>o?o.expr!==void 0:!1,S=o=>{if(!(!o||!B(o)))return o};function d(o,c){const y=k(c.interpolateString(o,O.t));if((0,H.ff)("grafana_loki_format_query_clicked",{is_invalid:y,query_type:z(o)?"logs":"metric"}),y)return o;let F=(0,re.bU)(o);const W=[],J=u.E2.parse(F);if(J.topNode.firstChild?.firstChild?.type.id===u.cq){const fe=/\[__V_[0-2]__\w+__V__\]/g;W.push(...F.matchAll(fe)),F=F.replace(fe,"[0s]")}let me=(0,u.aX)(F);return J.topNode.firstChild?.firstChild?.type.id===u.cq&&W.forEach(fe=>{me=me.replace("[0s]",fe[0])}),(0,re.Tt)(me)}},53859:(Me,he,i)=>{i.d(he,{y:()=>re});var v=i(32449),R=i(29353),u=i(83566);class H extends v.x{constructor(){super(R._f),this.setOperationCategories([u.Ly.Aggregations,u.Ly.RangeFunctions,u.Ly.Formats,u.Ly.BinaryOps,u.Ly.LabelFilters,u.Ly.LineFilters])}renderLabels(j){return j.length===0?"{}":super.renderLabels(j)}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:u.Hv.Log,operations:[{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:u.Hv.Log,operations:[{id:u.B5.Json,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:u.Hv.Log,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:u.Hv.Log,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Json,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:u.Hv.Log,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:u.Hv.Log,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Json,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.LineFormat,params:["{{.message}}"]},{id:u.B5.Json,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:u.Hv.Log,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:u.Hv.Log,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:u.Hv.Metric,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.Unwrap,params:[""]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.SumOverTime,params:["$__auto"]},{id:u.B5.Sum,params:[]}]},{name:"Total requests per label of streams",type:u.Hv.Metric,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.CountOverTime,params:["$__auto"]},{id:u.B5.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:u.Hv.Metric,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.CountOverTime,params:["$__auto"]},{id:u.B5.Sum,params:[]}]},{name:"Bytes used by a log stream",type:u.Hv.Metric,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:u.Hv.Metric,operations:[{id:u.B5.LineContains,params:[""]},{id:u.B5.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:u.Hv.Metric,operations:[{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.CountOverTime,params:["$__auto"]},{id:u.B5.Sum,params:[]},{id:u.B5.TopK,params:[10]}]},{name:"Extracted quantile",type:u.Hv.Metric,operations:[{id:u.B5.Logfmt,params:[]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.Unwrap,params:["latency"]},{id:u.B5.LabelFilterNoErrors,params:[]},{id:u.B5.QuantileOverTime,params:["$__auto",.5]},{id:u.B5.Sum,params:[]}]}]}}const re=new H},36860:(Me,he,i)=>{i.d(he,{E:()=>H,i:()=>u});var v=i(82473),R=i(83566);const u=[{id:R.B5.Addition,name:"Add scalar",sign:"+"},{id:R.B5.Subtraction,name:"Subtract scalar",sign:"-"},{id:R.B5.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:R.B5.DivideBy,name:"Divide by scalar",sign:"/"},{id:R.B5.Modulo,name:"Modulo by scalar",sign:"%"},{id:R.B5.Exponent,name:"Exponent",sign:"^"},{id:R.B5.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:R.B5.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:R.B5.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:R.B5.LessThan,name:"Less than",sign:"<",comparison:!0},{id:R.B5.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:R.B5.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],H=u.map(O=>{const j=[{name:"Value",type:"number"}],Z=[2];return O.comparison&&(j.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),Z.push(!1)),{id:O.id,name:O.name,params:j,defaultParams:Z,alternativesKey:"binary scalar operations",category:R.Ly.BinaryOps,renderer:re(O.sign),addOperationHandler:v.PP}});function re(O){return function(Z,ge,ue){let pe=Z.params[0],ne="";return Z.params.length===2&&(ne=Z.params[1]?" bool":""),`${ue} ${O}${ne} ${pe}`}}},71190:(Me,he,i)=>{i.d(he,{O6:()=>O,Ql:()=>pe,ZO:()=>ue,f0:()=>h,qV:()=>ye,we:()=>re,xu:()=>ge,zj:()=>$e});var v=i(14091),R=i(82473),u=i(88553),H=i(83566);function re(L,A){const I=[ce()],k=["$__auto"];let z;return L===H.B5.QuantileOverTime&&(k.push("0.95"),I.push({name:"Quantile",type:"number"})),A&&(I.push({name:"By label",type:"string",restParam:!0,optional:!0}),z=(0,R.ZI)(`__${L}_by`)),{id:L,name:(0,R.t7)(L),params:I,defaultParams:k,alternativesKey:"range function",category:H.Ly.RangeFunctions,orderRank:H.jK.RangeVectorFunction,renderer:Z,addOperationHandler:h,paramChangedHandler:z,explainHandler:(U,T)=>{let m=u.r8.find(X=>X.insertText===U.id)?.documentation??"";return U.params[0]==="$__auto"?`${m} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${m} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${U.params[0]}\`.`}}}function O(L){const A=re(L,!0),I=A.params.slice(0,-1);return[A,{id:`__${L}_by`,name:`${(0,R.t7)(L)} by`,params:[...I,{name:"Label",type:"string",restParam:!0,optional:!0,editor:v.g}],defaultParams:[...A.defaultParams,""],alternativesKey:"range function with grouping",category:H.Ly.RangeFunctions,renderer:j(L,"by"),paramChangedHandler:(0,R.j8)(L),explainHandler:(0,R.Sp)(L,"by"),addOperationHandler:h,hideFromList:!0},{id:`__${L}_without`,name:`${(0,R.t7)(L)} without`,params:[...I,{name:"Label",type:"string",restParam:!0,optional:!0,editor:v.g}],defaultParams:[...A.defaultParams,""],alternativesKey:"range function with grouping",category:H.Ly.RangeFunctions,renderer:j(L,"without"),paramChangedHandler:(0,R.j8)(L),explainHandler:(0,R.Sp)(L,"without"),addOperationHandler:h,hideFromList:!0}]}function j(L,A){return function(k,z,U){const T=z.params.findIndex(Q=>Q.restParam),m=k.params.slice(0,T),X=k.params.slice(T);return m.length===2&&L===H.B5.QuantileOverTime?`${L}(${m[1]}, ${U} [${m[0]}]) ${A} (${X.join(", ")})`:`${L}(${U} [${m[0]}]) ${A} (${X.join(", ")})`}}function Z(L,A,I){const k=L.params??[],z=k[0]??"$__auto";if(k.length===2&&L.id===H.B5.QuantileOverTime){const U=k[1];return`${L.id}(${U}, ${I} [${z}])`}return`${L.id}(${I} [${k[0]??"$__auto"}])`}function ge(L,A,I){return["<","<=",">",">="].includes(String(L.params[1]))?`${I} | ${L.params[0]} ${L.params[1]} ${L.params[2]}`:`${I} | ${L.params[0]} ${L.params[1]} \`${L.params[2]}\``}function ue(L,A){const I=L.params[1].toString().startsWith("!");return A.filter(U=>U.id===H.B5.LabelFilter&&U.params[0]===L.params[0]&&U.params[2]===L.params[2]).some(U=>!!(I&&U.params[1].toString().startsWith("!")===!1||I===!1&&U.params[1].toString().startsWith("!")))}function pe(L,A,I){switch(L.id){case H.B5.Logfmt:const[k=!1,z=!1,...U]=L.params;return`${I} | logfmt${k?" --strict":""}${z?" --keep-empty":""} ${U.join(", ")}`.trim();default:return`${I} | ${L.id}`}}function ne(L){return L.category===H.Ly.RangeFunctions}function D(L,A,I){const k=L.findIndex(z=>{const U=A.getOperationDef(z.id);return U?I(U):!1});return k===-1?L.length:k}function h(L,A,I){const k={id:L.id,params:L.defaultParams},z=[...A.operations],U=z.find(T=>{const m=I.getOperationDef(T.id);return m?ne(m):!1});switch(L.category){case H.Ly.Aggregations:case H.Ly.Functions:if(!U){const m=D(z,I,X=>X.category===H.Ly.Functions);z.splice(m,0,{id:H.B5.Rate,params:["$__auto"]})}z.push(k);break;case H.Ly.RangeFunctions:if(U){const m=z.indexOf(U);z[m]=k;break}default:const T=D(z,I,m=>(L.orderRank??100)<(m.orderRank??100));z.splice(T,0,k);break}return{...A,operations:z}}function ye(L,A){return{...A,binaryQueries:[...A.binaryQueries??[],{operator:"/",query:A}]}}function $e(L,A){return function(k,z,U){return A?`${U} ${L} \`(?i)${k.params[0]}\``:`${U} ${L} \`${k.params[0]}\``}}function ce(){return{name:"Range",type:"string",options:["$__auto","1m","5m","10m","1h","24h"]}}},29353:(Me,he,i)=>{i.d(he,{j$:()=>A,kf:()=>ce,XK:()=>L,_f:()=>ye});var v=i(82473),R=i(36860),u=i(39953),H=i(99456),re=i(9558),O=i(16699),j=i(96062),Z=i(11569),ge=i(74480),ue=i(53859);function pe({onChange:I,index:k,operationId:z,value:U,query:T,datasource:m}){const[X,Q]=(0,u.useState)({});return u.createElement(re.Ph,{inputId:(0,v.i1)(z,k),onOpenMenu:async()=>{if(m instanceof j.KV){Q({isLoading:!0});const te=await ne(T,m);Q({options:te,isLoading:void 0})}},isLoading:X.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:X.options,value:U?(0,H.E)(U.toString()):null,onChange:te=>{te.value&&I(k,te.value)}})}async function ne(I,k){const z=ue.y.renderQuery(I),U=(0,Z.SP)(z);if((0,Z.I2)(k.interpolateString(U,O.t)))return[];const T=await k.getDataSamples({expr:U,refId:"unwrap_samples"});return(0,ge.zb)(T[0]).map(Q=>({label:Q,value:Q}))}var D=i(71190),h=i(83566);function ye(){const I=[h.B5.Sum,h.B5.Min,h.B5.Max,h.B5.Avg,h.B5.Stddev,h.B5.Stdvar,h.B5.Count].flatMap(m=>(0,v.IT)(m,{addOperationHandler:D.f0,orderRank:h.jK.Last})),k=[h.B5.TopK,h.B5.BottomK].flatMap(m=>(0,v.Z3)(m,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:D.f0,orderRank:h.jK.Last})),z=[(0,D.we)(h.B5.Rate),(0,D.we)(h.B5.RateCounter),(0,D.we)(h.B5.CountOverTime),(0,D.we)(h.B5.SumOverTime),(0,D.we)(h.B5.BytesRate),(0,D.we)(h.B5.BytesOverTime),(0,D.we)(h.B5.AbsentOverTime)],U=[...(0,D.O6)(h.B5.AvgOverTime),...(0,D.O6)(h.B5.MaxOverTime),...(0,D.O6)(h.B5.MinOverTime),...(0,D.O6)(h.B5.FirstOverTime),...(0,D.O6)(h.B5.LastOverTime),...(0,D.O6)(h.B5.StdvarOverTime),...(0,D.O6)(h.B5.StddevOverTime),...(0,D.O6)(h.B5.QuantileOverTime)];return[...I,...k,...z,...U,{id:h.B5.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.Parsers,renderer:(m,X,Q)=>`${Q} | json ${m.params.join(", ")}`.trim(),addOperationHandler:D.f0,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:h.B5.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.Parsers,renderer:D.Ql,addOperationHandler:D.f0,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:h.B5.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.Parsers,renderer:(m,X,Q)=>`${Q} | regexp \`${m.params[0]}\``,addOperationHandler:D.f0,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:h.B5.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.Parsers,renderer:(m,X,Q)=>`${Q} | pattern \`${m.params[0]}\``,addOperationHandler:D.f0,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:h.B5.Unpack,name:"Unpack",params:[],defaultParams:[],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.Parsers,renderer:D.Ql,addOperationHandler:D.f0,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:h.B5.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.PipeOperations,renderer:(m,X,Q)=>`${Q} | line_format \`${m.params[0]}\``,addOperationHandler:D.f0,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:h.B5.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.PipeOperations,renderer:(m,X,Q)=>`${Q} | label_format ${m.params[1]}=${m.params[0]}`,addOperationHandler:D.f0,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:h.B5.LineContains,name:"Line contains",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:h.Ly.LineFilters,orderRank:h.jK.LineFilters,renderer:(0,D.zj)("|="),addOperationHandler:D.f0,explainHandler:m=>`Return log lines that contain string \`${m.params[0]}\`.`},{id:h.B5.LineContainsNot,name:"Line does not contain",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:h.Ly.LineFilters,orderRank:h.jK.LineFilters,renderer:(0,D.zj)("!="),addOperationHandler:D.f0,explainHandler:m=>`Return log lines that does not contain string \`${m.params[0]}\`.`},{id:h.B5.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:h.Ly.LineFilters,orderRank:h.jK.LineFilters,renderer:(0,D.zj)("|~",!0),addOperationHandler:D.f0,explainHandler:m=>`Return log lines that match regex \`(?i)${m.params[0]}\`.`},{id:h.B5.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:h.Ly.LineFilters,orderRank:h.jK.LineFilters,renderer:(0,D.zj)("!~",!0),addOperationHandler:D.f0,explainHandler:m=>`Return log lines that does not match regex \`(?i)${m.params[0]}\`.`},{id:h.B5.LineMatchesRegex,name:"Line contains regex match",params:[{name:"Regex",type:"string",hideName:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:h.Ly.LineFilters,orderRank:h.jK.LineFilters,renderer:(0,D.zj)("|~"),addOperationHandler:D.f0,explainHandler:m=>`Return log lines that match a \`RE2\` regex pattern. \`${m.params[0]}\`.`},{id:h.B5.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"Regex",type:"string",hideName:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:h.Ly.LineFilters,orderRank:h.jK.LineFilters,renderer:(0,D.zj)("!~"),addOperationHandler:D.f0,explainHandler:m=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${m.params[0]}\`.`},{id:h.B5.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[h.AI.contains,h.AI.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],alternativesKey:"line filter",category:h.Ly.LineFilters,orderRank:h.jK.LineFilters,renderer:(m,X,Q)=>`${Q} ${m.params[0]} ip(\`${m.params[1]}\`)`,addOperationHandler:D.f0,explainHandler:m=>`Return log lines using IP matching of \`${m.params[1]}\``},{id:h.B5.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[h.AI.equals,h.AI.doesNotEqual,h.AI.matchesRegex,h.AI.doesNotMatchRegex,h.AI.greaterThan,h.AI.lessThan,h.AI.greaterThanOrEqual,h.AI.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:h.Ly.LabelFilters,orderRank:h.jK.PipeOperations,renderer:D.xu,addOperationHandler:D.f0,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:h.B5.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[h.AI.equals,h.AI.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:h.Ly.LabelFilters,orderRank:h.jK.PipeOperations,renderer:(m,X,Q)=>`${Q} | ${m.params[0]} ${m.params[1]} ip(\`${m.params[2]}\`)`,addOperationHandler:D.f0,explainHandler:m=>`Return log lines using IP matching of \`${m.params[2]}\` for \`${m.params[0]}\` label`},{id:h.B5.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],alternativesKey:"label filter",category:h.Ly.LabelFilters,orderRank:h.jK.NoErrors,renderer:(m,X,Q)=>`${Q} | __error__=\`\``,addOperationHandler:D.f0,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:h.B5.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:pe},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.Unwrap,renderer:(m,X,Q)=>`${Q} | unwrap ${m.params[1]?`${m.params[1]}(${m.params[0]})`:m.params[0]}`,addOperationHandler:D.f0,explainHandler:m=>{let X=String(m.params[0]).length>0?m.params[0]:"<label>";return`Use the extracted label \`${X}\` as sample values instead of log lines for the subsequent range aggregation.${m.params[1]?` Conversion function \`${m.params[1]}\` wrapping \`${X}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:h.B5.Decolorize,name:"Decolorize",params:[],defaultParams:[],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.PipeOperations,renderer:(m,X,Q)=>`${Q} | decolorize`,addOperationHandler:D.f0,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:h.B5.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.PipeOperations,renderer:(m,X,Q)=>`${Q} | drop ${m.params.join(",")}`,addOperationHandler:D.f0,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:h.B5.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],alternativesKey:"format",category:h.Ly.Formats,orderRank:h.jK.PipeOperations,renderer:(m,X,Q)=>`${Q} | keep ${m.params.join(",")}`,addOperationHandler:D.f0,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...R.E,{id:h.B5.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:h.Ly.BinaryOps,renderer:(m,X,Q)=>Q,addOperationHandler:D.qV}]}const $e=ye();function ce(I){return($e.find(U=>U.id===I)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function L(I){return $e.find(k=>k.id===I)}function A(I,k){return!(k.length<I.params.filter(z=>!z.optional).length)}},59983:(Me,he,i)=>{i.d(he,{LE:()=>T,_z:()=>O});var v=i(71258),R=i(65234),u=i(36860),H=i(29353),re=i(83566);function O(g){const E=(0,R.bU)(g),N=v.E2.parse(E).topNode,S={query:{labels:[],operations:[]},errors:[]};try{j(E,N,S)}catch(d){console.error(d),d instanceof Error&&S.errors.push({text:d.message})}return Q(S.query)&&(S.errors=[]),S}function j(g,E,_){const N=_.query;switch(E.type.id){case v.xO:{N.labels.push(Z(g,E));const B=E.getChild(R._A);B&&_.errors.push((0,R.wf)(g,B));break}case v.yx:{const{operation:B,error:S}=ge(g,E);B&&N.operations.push(B),S&&_.errors.push(X(g,E,S));break}case v.Li:{N.operations.push(ue(g,E));break}case v.pj:{const{operation:B,error:S}=D(g,E);B&&N.operations.push(B),S&&_.errors.push(X(g,E,S));break}case v.Lu:{N.operations.push(pe(g,E));break}case v.dp:case v.m7:{const{operation:B,error:S}=ne(g,E);B&&N.operations.push(B),S&&_.errors.push(X(g,E,S));break}case v.PQ:{N.operations.push(h(g,E));break}case v.Md:{N.operations.push(ye(g,E));break}case v.Xt:{const{operation:B,error:S}=ce(g,E,_);B&&N.operations.push(B),S&&_.errors.push(X(g,E,S));break}case v.pM:{N.operations.push($e());break}case v.Tr:{N.operations.push(L(g,E,_));break}case v.M0:{N.operations.push(A(g,E,_));break}case v.uf:{k(g,E,_);break}case R._A:{if(U(E))break;_.errors.push((0,R.wf)(g,E));break}case v.yB:{N.operations.push(te(g,E,_));break}case v.ge:{N.operations.push(ve(g,E,_));break}default:{let B=E.firstChild;for(;B;)j(g,B,_),B=B.nextSibling}}}function Z(g,E){const _=E.getChild(v.xb),N=(0,R.KF)(g,_),B=(0,R.KF)(g,_.nextSibling);let S=(0,R.KF)(g,E.getChild(v.Ld));return S=S.substring(1,S.length-1),{label:N,op:B,value:S}}function ge(g,E){const _=(0,R.KF)(g,E.getChild(v.wn)),N=T((0,R.KF)(g,E.getChild(v.Ld)));return E.getChild(v.JX)?.getChild(v.Ip)?{operation:{id:re.B5.LineFilterIpMatches,params:[_,N]}}:{operation:{id:{"|=":re.B5.LineContains,"!=":re.B5.LineContainsNot,"|~":re.B5.LineMatchesRegex,"!~":re.B5.LineMatchesRegexNot}[_],params:[N]}}}function ue(g,E){const _=E.firstChild,N=(0,R.KF)(g,_),B=T((0,R.KF)(g,E.getChild(v.Ld)));let S=B?[B]:[];const d=(0,H.XK)(N);return d&&!(0,H.j$)(d,S)&&(S=d?.defaultParams||[]),{id:N,params:S}}function pe(g,E){const _=E.getChild(v.bb),N=(0,R.KF)(g,_),B=[...(0,R.ff)(g,E,v.lc)];return{id:N,params:B}}function ne(g,E){const _=[],N=[];let B;const S=E.from;return E.toTree().iterate({enter:o=>{o.type.id===v.$Q?_.push(g.substring(o.from+S,o.to+S)):o.type.id===v.lc?N.push(g.substring(o.from+S,o.to+S)):o.type.id===R._A&&(B=`Unexpected string "${g.substring(o.from+S,o.to+S)}"`)}}),{operation:{id:re.B5.Logfmt,params:[_.includes("--strict"),_.includes("--keep-empty"),...N]},error:B}}function D(g,E){if(E.getChild(v.Or)||E.getChild(v.W8)||E.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(E.firstChild.type.id===v.Fo){const c=E.firstChild,y=c?.getChild(v.xb),F=y?.nextSibling,W=c?.getChild(v.Ld),J=T((0,R.KF)(g,W));return{operation:{id:re.B5.LabelFilterIpMatches,params:[(0,R.KF)(g,y),(0,R.KF)(g,F),J]}}}const _=re.B5.LabelFilter;if(E.firstChild.type.id===v.ai){const y=E.firstChild.firstChild.firstChild,F=y.nextSibling,W=F.nextSibling,J=T((0,R.KF)(g,W));return{operation:{id:_,params:[(0,R.KF)(g,y),(0,R.KF)(g,F),J]}}}const B=E.firstChild.firstChild,S=B.nextSibling,d=S.nextSibling,o=[(0,R.KF)(g,B),(0,R.KF)(g,S),T((0,R.KF)(g,d))];return o.join("")==="__error__="?{operation:{id:re.B5.LabelFilterNoErrors,params:[]}}:{operation:{id:_,params:o}}}function h(g,E){const _=re.B5.LineFormat,N=T((0,R.KF)(g,E.getChild(v.Ld)));return{id:_,params:[N]}}function ye(g,E){const _=re.B5.LabelFormat,N=E.getChild(v.xb),S=N.nextSibling.nextSibling;return{id:_,params:[(0,R.KF)(g,S),T((0,R.KF)(g,N))]}}function $e(){return{id:re.B5.Decolorize,params:[]}}function ce(g,E,_){const N=E.getChild(v.Xt),B=E.getChild(v.pj),S=E.getChild(v.Z7);if(N&&j(g,N,_),B&&j(g,B,_),S){if(S.nextSibling?.type.id===v.h3){const d=S.nextSibling,o=d.nextSibling;return{operation:{id:re.B5.Unwrap,params:[(0,R.KF)(g,o),(0,R.KF)(g,d)]}}}return{operation:{id:re.B5.Unwrap,params:[(0,R.KF)(g,S?.nextSibling),""]}}}return{}}function L(g,E,_){const N=E.getChild(v.gQ),B=(0,R.KF)(g,N),S=E.getChild(v.Mr),d=E.getChild(v.UN),o=S!=null?[(0,R.KF)(g,S)]:[],c=d?.getChild(v.e6),y=c?(0,R.KF)(g,c):null;y&&o.unshift(y.substring(1,y.length-1));const F={id:B,params:o};return d&&j(g,d,_),F}function A(g,E,_){const N=E.getChild(v.Up);let B=(0,R.KF)(g,N);const S=E.getChild(v.Kz),d=[],o=E.getChild(v.Mr);o&&d.push(Number((0,R.KF)(g,o))),S&&(S.getChild(v.By)&&B&&(B=`__${B}_by`),S.getChild(v.yN)&&(B=`__${B}_without`),d.push(...(0,R.ff)(g,S,v.xb)));const c=E.getChild(v.cq),y={id:B,params:d};return c&&(c.firstChild?.type.id===v.uf&&_.errors.push({text:"Query parsing is ambiguous.",from:c.firstChild.from,to:c.firstChild?.to}),j(g,c,_)),y}const I=u.i.reduce((g,E)=>(g[E.sign]={id:E.id,comparison:E.comparison},g),{});function k(g,E,_){const N=_.query,B=E.firstChild,S=(0,R.KF)(g,B.nextSibling),d=z(g,E.getChild(v.V7)),o=E.lastChild,c=I[S],y=m(B,"MetricExpr.LiteralExpr.Number"),F=m(o,"MetricExpr.LiteralExpr.Number"),W=o.getChild(v.uf);if(y||j(g,B,_),F)N.operations.push((0,R.Es)(c,g,o,!!d?.isBool));else if(W){const J=(0,R.ge)(o);J?.type.id===v.Mr&&N.operations.push((0,R.Es)(c,g,J,!!d?.isBool)),j(g,o,_)}else{N.binaryQueries=N.binaryQueries||[];const J={operator:S,query:{labels:[],operations:[]}};d?.isMatcher&&(J.vectorMatchesType=d.matchType,J.vectorMatches=d.matches),N.binaryQueries.push(J),j(g,o,{query:J.query,errors:_.errors})}}function z(g,E){if(!E)return;const _=E.getChild(v.JM),N=E.getChild(v.tW);if(!_&&N)return{isBool:!0,isMatcher:!1};{if(!_)return;const B=(0,R.KF)(g,_.getChild(v.XT)?.getChild(v.pQ));return{isMatcher:!0,isBool:!!N,matches:B,matchType:_.getChild(v.On)?"on":"ignoring"}}}function U(g){return g?.parent?.type.id===v.e6}function T(g){return g[0]==='"'&&g[g.length-1]==='"'?g.substring(1,g.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):g.replace(/`/g,"")}function m(g,E){let _=g;const N=E.split(".");for(const B of N)if(_=_.getChild(B),!_)return null;return _}function X(g,E,_){const N=(0,R.wf)(g,E);return N.text=`${_}: ${N.text}`,N}function Q(g){return g.labels.length===0&&g.operations.length===0}function te(g,E,_){const N=[];let B=E.getChild(v.Ph);for(;B;){const S=(0,R.KF)(g,B.getChild(v.ch));S&&N.push(S),B=B?.getChild(v.Ph)}return N.reverse(),{id:re.B5.Drop,params:N}}function ve(g,E,_){const N=[];let B=E.getChild(v.Di);for(;B;){const S=(0,R.KF)(g,B.getChild(v.x4));S&&N.push(S),B=B?.getChild(v.Di)}return N.reverse(),{id:re.B5.Keep,params:N}}},83566:(Me,he,i)=>{i.d(he,{AI:()=>re,B5:()=>u,Hv:()=>v,Ly:()=>R,jK:()=>H});var v=(O=>(O.Log="log",O.Metric="metric",O))(v||{}),R=(O=>(O.Aggregations="Aggregations",O.RangeFunctions="Range functions",O.Functions="Functions",O.Formats="Formats",O.LineFilters="Line filters",O.LabelFilters="Label filters",O.BinaryOps="Binary operations",O))(R||{}),u=(O=>(O.Json="json",O.Logfmt="logfmt",O.Regexp="regexp",O.Pattern="pattern",O.Unpack="unpack",O.LineFormat="line_format",O.LabelFormat="label_format",O.Decolorize="decolorize",O.Drop="drop",O.Keep="keep",O.Rate="rate",O.RateCounter="rate_counter",O.CountOverTime="count_over_time",O.SumOverTime="sum_over_time",O.AvgOverTime="avg_over_time",O.MaxOverTime="max_over_time",O.MinOverTime="min_over_time",O.FirstOverTime="first_over_time",O.LastOverTime="last_over_time",O.StdvarOverTime="stdvar_over_time",O.StddevOverTime="stddev_over_time",O.QuantileOverTime="quantile_over_time",O.BytesRate="bytes_rate",O.BytesOverTime="bytes_over_time",O.AbsentOverTime="absent_over_time",O.Sum="sum",O.Avg="avg",O.Min="min",O.Max="max",O.Stddev="stddev",O.Stdvar="stdvar",O.Count="count",O.TopK="topk",O.BottomK="bottomk",O.LineContains="__line_contains",O.LineContainsNot="__line_contains_not",O.LineContainsCaseInsensitive="__line_contains_case_insensitive",O.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",O.LineMatchesRegex="__line_matches_regex",O.LineMatchesRegexNot="__line_matches_regex_not",O.LineFilterIpMatches="__line_filter_ip_matches",O.LabelFilter="__label_filter",O.LabelFilterNoErrors="__label_filter_no_errors",O.LabelFilterIpMatches="__label_filter_ip_marches",O.Unwrap="unwrap",O.SumBy="__sum_by",O.SumWithout="__sum_without",O.Addition="__addition",O.Subtraction="__subtraction",O.MultiplyBy="__multiply_by",O.DivideBy="__divide_by",O.Modulo="__modulo",O.Exponent="__exponent",O.NestedQuery="__nested_query",O.EqualTo="__equal_to",O.NotEqualTo="__not_equal_to",O.GreaterThan="__greater_than",O.LessThan="__less_than",O.GreaterOrEqual="__greater_or_equal",O.LessOrEqual="__less_or_equal",O))(u||{}),H=(O=>(O[O.LineFilters=1]="LineFilters",O[O.Parsers=2]="Parsers",O[O.PipeOperations=3]="PipeOperations",O[O.Unwrap=4]="Unwrap",O[O.NoErrors=5]="NoErrors",O[O.RangeVectorFunction=5]="RangeVectorFunction",O[O.Last=6]="Last",O))(H||{});const re={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},74480:(Me,he,i)=>{i.d(he,{_P:()=>L,EO:()=>pe,vh:()=>ue,ki:()=>ye,e8:()=>D,Y:()=>$e,OP:()=>ne,zb:()=>h});var v=i(89591),R=i(5195),u=i(51226),H=i(99977),re=i(38793);function O(T){let m;try{m=JSON.parse(T)}catch{}return typeof m=="object"}const j=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function Z(T){return j.test(T)}function ge(T){let m;try{return m=JSON.parse(T),m.hasOwnProperty("_entry")}catch{return!1}}function ue(T){return(T.fields.find(X=>X.name==="labels")?.values??[]).some(X=>X.__error__!==void 0)}function pe(T){return(T.fields.find(X=>X.name==="labels")?.values??[]).some(X=>X.level!==void 0)}function ne(T){const m=T.fields.find(g=>g.type===v.fS.string);if(m==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const X=m.values;let Q=!1,te=!1,ve=!1;return X.forEach(g=>{O(g)&&(Q=!0,ve=ge(g)),Z(g)&&(te=!0)}),{hasLogfmt:te,hasJSON:Q,hasPack:ve}}function D(T){const m=T?.fields?.find(X=>X.name==="labels")?.values??[];return m?.length?Object.keys(m[0]):[]}function h(T){const m=T?.fields?.find(Q=>Q.name==="labels")?.values??[];return m?.length?Object.keys(m[0]).filter(Q=>{const te=m[0][Q];return te?!isNaN(Number(te))||(0,R.IA)(te)||(0,re.aC)(te):!1}).filter(Q=>m.every(te=>te[Q])):[]}function ye(T){const m=T.fields.find(Q=>Q.name==="labels"&&Q.type===v.fS.other);return m==null?!1:m.values.some(Q=>Q.__error__)}function $e(T){const m=T.fields.find(te=>te.name==="labels"&&te.type===v.fS.other);if(m==null)return null;const X=m.values.slice(0,2);let Q=null;for(let te of X){const ve=Object.keys(te).find(g=>g==="lvl"||g.includes("level"));if(ve){Q=ve;break}}return Q}function ce(T,m){if(T.refId!==m.refId)return!1;const X=T.meta?.type,Q=m.meta?.type;if(X!==Q)return!1;if(X===u.P.TimeSeriesMulti){const g=T.fields.find(_=>_.type===v.fS.number),E=m.fields.find(_=>_.type===v.fS.number);return g===void 0||E===void 0?!1:(0,H.Vv)(g.labels??{},E.labels??{})}const te=T.meta?.custom?.frameType,ve=m.meta?.custom?.frameType;return te==="LabeledTimeValues"&&ve==="LabeledTimeValues"}function L(T,m){if(!T)return z(m);m.data.forEach(ve=>{const g=T.data.find(E=>ce(E,ve));if(!g){T.data.push(U(ve));return}A(g,ve)});const X=[...T.errors??[],...m.errors??[]];X.length>0&&(T.errors=X);const Q=T.error??m.error;Q!=null&&(T.error=Q);const te=[...T.traceIds??[],...m.traceIds??[]];return te.length>0&&(T.traceIds=te),T}function A(T,m){const X=T.fields.length;for(let Q=0;Q<X;Q++)if(T.fields[Q].values=[].concat.apply(m.fields[Q].values,T.fields[Q].values),m.fields[Q].nanos){const te=T.fields[Q].nanos?.slice()||[];T.fields[Q].nanos=m.fields[Q].nanos?.concat(te)}T.length+=m.length,T.meta={...T.meta,stats:k(T.meta?.stats??[],m.meta?.stats??[])}}const I="Summary: total bytes processed";function k(T,m){const X=T.find(ve=>ve.displayName===I),Q=m.find(ve=>ve.displayName===I);if(Q!=null&&X!=null)return[{value:Q.value+X.value,displayName:I,unit:X.unit}];const te=Q??X;return te!=null?[te]:[]}function z(T){return{...T,data:T.data.map(U)}}function U(T){return{...T,fields:T.fields.map(m=>({...m,values:m.values}))}}},17583:(Me,he,i)=>{i.d(he,{Ci:()=>ce,Dl:()=>L,uJ:()=>ue});var v=i(96083),R=i(72639),u=i(32688),H=i(49955),re=i(83065),O=i(96062),j=i(93716),Z=i(11569),ge=i(73363);const ue=({payload:{dashboardId:A,orgId:I,grafanaVersion:k,queries:z}})=>{try{const U=z[j.id].filter(S=>!S.hide).map(S=>(0,Z.Ib)(S));if(!U?.length)return;const T=U.filter(S=>(0,Z.rE)(S.expr)),m=U.filter(S=>!(0,Z.rE)(S.expr)),X=U.filter(S=>S.queryType===ge.EM.Instant),Q=U.filter(S=>S.queryType===ge.EM.Range),te=U.filter(S=>S.editorMode===re.c.Builder),ve=U.filter(S=>S.editorMode===re.c.Code),g=U.filter(pe),E=U.filter(ne),_=U.filter(D),N=U.filter(h),B={grafana_version:k,dashboard_id:A,org_id:I,queries_count:U.length,logs_queries_count:T.length,metric_queries_count:m.length,instant_queries_count:X.length,range_queries_count:Q.length,builder_mode_queries_count:te.length,code_mode_queries_count:ve.length,queries_with_template_variables_count:g.length,queries_with_changed_resolution_count:E.length,queries_with_changed_line_limit_count:_.length,queries_with_changed_legend_count:N.length};(0,R.ff)("grafana_loki_dashboard_loaded",B)}catch(U){console.error("error in loki tracking handler",U)}},pe=A=>H.J7.test(A.expr),ne=A=>A.resolution?A.resolution!==1:!1,D=A=>A.maxLines!==null&&A.maxLines!==void 0,h=A=>A.legendFormat?A.legendFormat!=="":!1,ye=A=>{const I=[O.xf,O.NZ,O.V8];return!!(A===O.Ic||I.some(k=>A.startsWith(k)))},$e=A=>{let I=0;for(const k of A.data){const z=k.meta?.custom?.lokiQueryStatKey;z&&(I+=k.meta?.stats?.find(U=>U.displayName===z)?.value??0)}return I};function ce(A,I,k,z={},U={}){const{app:T,targets:m}=I;if(T===v.zj.Dashboard||T===v.zj.PanelViewer)return;let X=$e(A);for(const Q of m){if(ye(Q.refId))return;(0,R.ff)("grafana_loki_query_executed",{app:T,grafana_version:u.config.buildInfo.version,editor_mode:Q.editorMode,has_data:A.data.some(te=>te.length>0),has_error:A.error!==void 0,legend:Q.legendFormat,line_limit:Q.maxLines,parsed_query:(0,Z.dQ)(Q.expr).join(","),obfuscated_query:(0,Z.H6)(Q.expr),query_type:(0,Z.rE)(Q.expr)?"logs":"metric",query_vector_type:Q.queryType,resolution:Q.resolution,simultaneously_executed_query_count:m.filter(te=>!te.hide).length,simultaneously_hidden_query_count:m.filter(te=>te.hide).length,time_range_from:I?.range?.from?.toISOString(),time_range_to:I?.range?.to?.toISOString(),time_taken:Date.now()-k.getTime(),bytes_processed:X,is_split:!1,predefined_operations_applied:z.predefinedOperations?Q.expr.includes(z.predefinedOperations):"n/a",...U})}}function L(A,I,k,z,U={}){const T={split_query_group_count:I.length,split_query_largest_partition_size:Math.max(...I.map(({partition:m})=>m.length)),split_query_total_request_count:I.reduce((m,{partition:X})=>m+X.length,0),is_split:!0,simultaneously_executed_query_count:k.targets.filter(m=>!m.hide).length,simultaneously_hidden_query_count:k.targets.filter(m=>m.hide).length};for(const m of I){const X=m.partition.length;ce(A,m.request,z,U,{...T,split_query_partition_size:X})}}},73363:(Me,he,i)=>{i.d(he,{sb:()=>H,EM:()=>R,Z3:()=>O,$o:()=>u});var v=(j=>(j.Builder="builder",j.Code="code",j))(v||{}),R=(j=>(j.Instant="instant",j.Range="range",j.Stream="stream",j))(R||{}),u=(j=>(j.DataSample="dataSample",j.LogsSample="logsSample",j.LogsVolume="logsVolume",j))(u||{}),H=(j=>(j.Backward="backward",j.Forward="forward",j))(H||{}),re=(j=>(j.Stream="streams",j.Vector="vector",j.Matrix="matrix",j))(re||{}),O=(j=>(j[j.LabelNames=0]="LabelNames",j[j.LabelValues=1]="LabelValues",j))(O||{})},71258:(Me,he,i)=>{i.d(he,{$Q:()=>qt,By:()=>Ot,Di:()=>or,E2:()=>J,Fo:()=>xt,Ih:()=>Jt,Ip:()=>st,JM:()=>pr,JX:()=>yt,Kz:()=>ke,Ld:()=>Te,Li:()=>Ye,Lu:()=>Je,M0:()=>ct,Md:()=>Tt,Mr:()=>Be,OC:()=>Yt,On:()=>gt,Or:()=>kt,PQ:()=>qe,Ph:()=>nr,Qf:()=>ze,Tr:()=>tt,UN:()=>lt,Up:()=>St,V7:()=>dr,W8:()=>Kt,WZ:()=>Zt,We:()=>Ht,XT:()=>fr,Xt:()=>at,Z7:()=>Ue,aX:()=>je,af:()=>fe,ai:()=>be,bL:()=>it,bb:()=>me,ch:()=>sr,cq:()=>Ne,dh:()=>nt,dp:()=>We,e6:()=>Ke,gD:()=>Gt,gP:()=>zt,gQ:()=>Ve,ge:()=>ir,h3:()=>ut,iP:()=>Fe,lc:()=>le,m7:()=>er,nL:()=>Lt,nt:()=>Xe,pM:()=>Vt,pQ:()=>gr,pj:()=>Ie,tW:()=>jt,uf:()=>_t,wi:()=>vt,wm:()=>Bt,wn:()=>wt,x4:()=>lr,xO:()=>bt,xb:()=>Qe,yB:()=>ar,yN:()=>ht,yx:()=>He,zV:()=>et});var v=i(48355);const R=1,u=2,H=3,re=4,O=5,j=6,Z=7,ge=8,ue=9,pe=10,ne=11,D=12,h=13,ye=14,$e=15,ce=16,L=17,A=18,I=19,k=20,z=21,U=22,T=23,m=24,X=25,Q=26,te=27,ve=28,g=29,E=30,_=31,N=32,B=33,S=34,d=90,o={json:R,logfmt:u,unpack:H,pattern:re,regexp:O,ip:Z,label_format:ge,line_format:ue,label_replace:pe,vector:ne,offset:D,bool:h,on:ye,ignoring:$e,group_left:ce,group_right:L,unwrap:j,decolorize:A,drop:I,keep:k},c=P=>o[P.toLowerCase()]||-1,y={by:z,without:U,and:T,or:m,unless:X,sum:Q,avg:te,count:ve,max:g,min:E,stddev:_,stdvar:N,bottomk:B,topk:S},F=P=>y[P.toLowerCase()]||-1,W={__proto__:null,count_over_time:289,rate:291,rate_counter:293,bytes_over_time:295,bytes_rate:297,avg_over_time:299,sum_over_time:301,min_over_time:303,max_over_time:305,stddev_over_time:307,stdvar_over_time:309,quantile_over_time:311,first_over_time:313,last_over_time:315,absent_over_time:317,bytes:323,duration:325,duration_seconds:327},J=v.WQ.deserialize({version:14,states:"DYOYQPOOO#]QPO'#DTO$lQPO'#DSOYQPO'#DSOOQO'#E['#E[O$yQPO'#EZOOQO'#Ew'#EwO%OQPO'#EvQ%ZQPOOOOQO'#FV'#FVO&[QPO'#FVO&aQPO'#FWO&fQPO'#FXOOQO'#EY'#EYOOQO'#DR'#DROOQO'#E]'#E]OOQO'#E^'#E^OOQO'#E_'#E_OOQO'#E`'#E`OOQO'#Ea'#EaOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkO&kQPO'#DVOOQO'#DU'#DUO&yQPO,59oOOQO'#Db'#DbO'RQPO'#DaOOQO'#D`'#D`O'ZQPO'#D_O(tQPO'#D_OOQO'#D^'#D^O*vQPO,59nO,UQPO,59nO,]QPO,5:tO,dQPO,5:uO,oQPO'#EtO.tQPO,5;bO.{QPO,5;bO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dOOQO,5;q,5;qOYQPO,5;rO1^QPO,5;sO1cQPO,59qO#]QPO,59pOOQO1G/Z1G/ZOOQO'#De'#DeOOQO,59{,59{O1hQPO,59{OOQO,59z,59zO1mQPO'#DVO2[QPO'#DgO3{QPO'#DjO5iQPO'#DjOOQO'#Dj'#DjOOQO'#Dq'#DqOOQO'#Do'#DoO)dQPO'#DoO5nQPO,59yO7XQPO'#D}O7^QPO'#EOOOQO'#ER'#ERO7cQPO'#ESO7hQPO'#EVOOQO,59y,59yOOQO,59x,59xOOQO1G/Y1G/YOOQO1G0`1G0`O7mQPO'#ElO,gQPO'#ElO8RQPO1G0aO8WQPO1G0aO8]QPO,5;`O8eQPO1G0|O9pQPO1G0|O9wQPO1G0|O:OQPO'#EzO<WQPO'#EyO<bQPO'#EyOYQPO1G1OOYQPO1G1OOYQPO1G1OOYQPO1G1OOYQPO1G1OOYQPO1G1OO<lQPO1G1^O<sQPO1G1_OOQO1G/]1G/]OOQO1G/[1G/[O<xQPO1G/gO<}QPO,59qO=TQPO,5:^OOQO'#Dh'#DhO=`QPO,5:RO?PQPO'#DmOOQO'#Dl'#DlO@mQPO,5:YOBWQPO,5:VOOQO,5:U,5:UOCqQPO,5:ZO)dQPO,5:ZO)dQPO,5:ZOOQO,5:i,5:iODPQPO'#EQOOQO'#EP'#EPODUQPO,5:jOEoQPO'#EUOOQO'#EU'#EUOOQO'#ET'#ETOG`QPO,5:nOHyQPO'#EXOOQO'#EX'#EXOOQO'#EW'#EWOJjQPO,5:qOLTQPO'#D_O7mQPO,5;WOL[QPO'#EmOLaQPO,5;WOLzQPO,5;WOMUQPO,5;WOM]QPO,5;WOMbQPO7+%{O,gQPO7+%{OOQO'#Eu'#EuONrQPO1G0zOOQO1G0z1G0zONzQPO7+&hOYQPO7+&hO!![QPO7+&hO!!cQPO7+&hO!!jQQO'#E{OOQO,5;f,5;fO!$rQPO,5;eO!$yQPO,5;eO!&[QPO7+&jO!&cQPO7+&jOOQO7+&j7+&jO!&pQPO7+&jO!&wQPO7+&jO!'|QPO7+&jO!(^QPO7+&xOOQO7+&y7+&yO!(cQPO7+%RO!(hQPO1G/vOOQO1G/x1G/xOOQO1G0P1G0POOQO1G0R1G0ROOQO,5:S,5:SO!(mQPO1G/tO!*WQPO,5:XO!*]QPO,5:WOOQO1G/u1G/uO!*bQPO1G/uO!+{QPO,5:lO7^QPO,5:kO7cQPO,5:oO7hQPO,5:rO!,TQPO,5;ZOLaQPO1G0rO!,cQPO1G0rO!,kQPO,5;XO)dQPO,5;ZO!,pQPO1G0rO!,wQPO'#EnO!,|QPO1G0rO!,pQPO1G0rO!-UQPO1G0rO!-]QPO1G0rO7|QPO1G0rOOQO1G0r1G0rOOQO<<Ig<<IgO!-hQPO<<IgO!-mQPO,5;aOOQO7+&f7+&fOOQO<<JS<<JSO!-rQPO<<JSOYQPO<<JSOOQO'#E}'#E}O!-yQPO,5;gOOQO'#E|'#E|OOQO,5;g,5;gOOQO1G1P1G1PO!.RQPO1G1PO!0UQPO<<JdOOQO<<Hm<<HmO!0ZQPO7+%bOOQO1G/s1G/sOOQO1G/r1G/rOOQO1G0W1G0WOOQO1G0V1G0VOOQO1G0Z1G0ZOOQO1G0^1G0^OOQO'#Ep'#EpOOQO1G0u1G0uO!0`QPO1G0uOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsOOQO7+&^7+&^OOQO1G0s1G0sO!0eQPO1G0uO!0yQPO7+&^OOQO,5;Y,5;YO!1RQPO7+&^O7|QPO7+&^O!1YQPO7+&^O!1eQPOAN?ROOQO1G0{1G0{O!2uQPOAN?nO!4VQPOAN?nO!4^QQO1G1ROOQO1G1R1G1ROOQO7+&k7+&kO!4fQPOAN@OO!4kQPO<<H|O!4pQPO7+&aO!4uQPO<<IxO!4}QPO<<IxO!5VQPO'#EoO!5[QPO<<IxOOQOG24mG24mOOQOG25YG25YOOQO1G1S1G1SOOQO7+&m7+&mO!5dQPOG25jOOQOAN>hAN>hO!5iQPO<<I{OOQOAN?dAN?dO!5nQPOAN?dO!5vQPOLD+UOOQOAN?gAN?gOOQO,5:j,5:jO!5{QPO!$'NpO!6QQPO!)9D[O!6VQPO!.K9vOOQO!4//b!4//bO7^QPO'#EOO!6[QPO'#D_O!7SQPO,59nO!7^QPO'#DSOYQPO1G1OOYQPO1G1OOYQPO1G1OOYQPO1G1OOYQPO1G1OOYQPO1G1OO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dO/QQPO,5;dO!8iQPO7+&jO!8pQPO7+&jO!8}QPO7+&jO!:VQPO7+&jO!:^QPO7+&jO!9UQPO'#Ex",stateData:"!:k~O$OOSsOS~OYZOZ[OjUOkUOlUOmUOnUOoUOpUOqUOrUO!pXO#sYO#tYO$PPO$SRO$U_O$V`O$WaO$XbO$YcO$ZdO$[eO$]fO$^gO$_hO$`iO$ajO$bkO$clO$dmO~OznO~O}qO!PqO!VqO!WqOgvXhvXivX!gvX!ivX!jvX!kvX!lvX#svX#tvX#uvX#vvX#wvX#xvX~O!YuO#|vX$TvX~P#bO$SzO~Oe{Of{O$S|O~Og!POh!OOi!PO}!TO!g!TO!i!TO!j!TO!k!TO!l!TO#s!QO#t!QO#u!RO#v!RO#w!RO#x!SO~O!p!UO~O$S!VO~O$S!WO~O{!XO}!XO!O!XO!P!XO~O$Q!YO$R!ZO~OV![O|!]O~O}qO!PqO!VqO!WqOg!RXh!RXi!RX!Y!RX!g!RX!i!RX!j!RX!k!RX!l!RX#s!RX#t!RX#u!RX#v!RX#w!RX#x!RX#|!RX$T!RX$e!RX$Q!RX~OP!bOQ!aOR!dOS!cOT!cOW!jOX!iOb!kOc!lOd!mOz!`O$S!gO~O}qO!PqO!VqO!WqOgvahvaiva!gva!iva!jva!kva!lva#sva#tva#uva#vva#wva#xva~O!YuO#|va$Tva~P)lOguXhuXiuX}uX!guX!iuX!juX!kuX!luX#suX#tuX#uuX#vuX#wuX#xuX~O$T!pO~P+TO$T!qO~P+TO!p!uO$PPO$S!sO~O$S!vO~OYZOZ[OjUOkUOlUOmUOnUOoUOpUOqUOrUO#sYO#tYO$PPO$SRO$U_O$V`O$WaO$XbO$YcO$ZdO$[eO$]fO$^gO$_hO$`iO$ajO$bkO$clO$dmO~O!p!xO~P,tO$S!yO~O]!|O^!zO_!zOY#mPZ#mPj#mPk#mPl#mPm#mPn#mPo#mPp#mPq#mPr#mP!p#mP#s#mP#t#mP$P#mP$S#mP$U#mP$V#mP$W#mP$X#mP$Y#mP$Z#mP$[#mP$]#mP$^#mP$_#mP$`#mP$a#mP$b#mP$c#mP$d#mP~O!p#UO~O|#VO~O$S#XO~O{#YO}#YO!O!XO!P!XO!g#ZO!i#ZO!j#ZO!k#ZO!l#ZO~Oz#^O!]#[Og!ZXh!ZXi!ZX}!ZX!P!ZX!V!ZX!W!ZX!Y!ZX!g!ZX!i!ZX!j!ZX!k!ZX!l!ZX#s!ZX#t!ZX#u!ZX#v!ZX#w!ZX#x!ZX#|!ZX$T!ZX$e!ZX$Q!ZX~Oz#^Og!^Xh!^Xi!^X}!^X!P!^X!V!^X!W!^X!Y!^X!g!^X!i!^X!j!^X!k!^X!l!^X#s!^X#t!^X#u!^X#v!^X#w!^X#x!^X#|!^X$T!^X$e!^X$Q!^X~O|#bO~Og#dOh#eO$Q#dOi!Ra}!Ra!P!Ra!V!Ra!W!Ra!Y!Ra!g!Ra!i!Ra!j!Ra!k!Ra!l!Ra#s!Ra#t!Ra#u!Ra#v!Ra#w!Ra#x!Ra#|!Ra$T!Ra$e!Ra~O|#fO~Oz#gO~Oz#jO~Oz#nO~O}qO!PqO!VqO!WqO!Y#rO$e#tO~O$T#yO~O$Q#zO~Oz#{O$T#}O~O$T$OO~P+TOg#yXh#yXi#yX}#yX!g#yX!i#yX!j#yX!k#yX!l#yX#s#yX#t#yX#u#yX#v#yX#w#yX#x#yX$T#yX~O$Q$PO~P8lO!p$RO~P,tO$S$SO~OY#mXZ#mXj#mXk#mXl#mXm#mXn#mXo#mXp#mXq#mXr#mX!p#mX#s#mX#t#mX$P#mX$S#mX$U#mX$V#mX$W#mX$X#mX$Y#mX$Z#mX$[#mX$]#mX$^#mX$_#mX$`#mX$a#mX$b#mX$c#mX$d#mX~O`$UOa$UO~P:TO^!zO_!zO~P:TO$Q$^O~P+TO$T$_O~O|$`O~OV$aO|#VO!h$bO!n$cO!p$dO~Oz#^O!]$eOg!Zah!Zai!Za}!Za!P!Za!V!Za!W!Za!Y!Za!g!Za!i!Za!j!Za!k!Za!l!Za#s!Za#t!Za#u!Za#v!Za#w!Za#x!Za#|!Za$T!Za$e!Za$Q!Za~O{$gOg!aXh!aXi!aX}!aX!P!aX!V!aX!W!aX!Y!aX!g!aX!i!aX!j!aX!k!aX!l!aX#s!aX#t!aX#u!aX#v!aX#w!aX#x!aX#|!aX$Q!aX$T!aX$e!aX~O$Q$hOg!bah!bai!ba}!ba!P!ba!V!ba!W!ba!Y!ba!g!ba!i!ba!j!ba!k!ba!l!ba#s!ba#t!ba#u!ba#v!ba#w!ba#x!ba#|!ba$T!ba$e!ba~O$Q$hOg!_ah!_ai!_a}!_a!P!_a!V!_a!W!_a!Y!_a!g!_a!i!_a!j!_a!k!_a!l!_a#s!_a#t!_a#u!_a#v!_a#w!_a#x!_a#|!_a$T!_a$e!_a~Og#dOh#eO$Q#dO$T$iO~O{$kO~O$Q$lOg!rah!rai!ra}!ra!P!ra!V!ra!W!ra!Y!ra!g!ra!i!ra!j!ra!k!ra!l!ra#s!ra#t!ra#u!ra#v!ra#w!ra#x!ra#|!ra$T!ra$e!ra~O{!XO}!XO!O!XO!P!XOg!xXh!xXi!xX!V!xX!W!xX!Y!xX!g!xX!i!xX!j!xX!k!xX!l!xX#s!xX#t!xX#u!xX#v!xX#w!xX#x!xX#|!xX$Q!xX$T!xX$e!xX~O$Q$mOg!vah!vai!va}!va!P!va!V!va!W!va!Y!va!g!va!i!va!j!va!k!va!l!va#s!va#t!va#u!va#v!va#w!va#x!va#|!va$T!va$e!va~O{!XO}!XO!O!XO!P!XOg!{Xh!{Xi!{X!V!{X!W!{X!Y!{X!g!{X!i!{X!j!{X!k!{X!l!{X#s!{X#t!{X#u!{X#v!{X#w!{X#x!{X#|!{X$Q!{X$T!{X$e!{X~O$Q$nOg!yah!yai!ya}!ya!P!ya!V!ya!W!ya!Y!ya!g!ya!i!ya!j!ya!k!ya!l!ya#s!ya#t!ya#u!ya#v!ya#w!ya#x!ya#|!ya$T!ya$e!ya~OU$oO~P(tO!h$rO~O!Y$sO$e#tO~O}qO!PqO!VqO!WqO!Y#rO~O[$uO$T#`a~PLiO$T$zO~P7mO$T${O~Oe{Of{Og!}qh!}qi!}q}!}q!g!}q!i!}q!j!}q!k!}q!l!}q#s!}q#t!}q#u!}q#v!}q#w!}q#x!}q#|!}q$T!}q$Q!}q~O$Q%OO$T%PO~Oe{Of{Og#jqh#jqi#jq}#jq!g#jq!i#jq!j#jq!k#jq!l#jq#s#jq#t#jq#u#jq#v#jq#w#jq#x#jq#|#jq$T#jq$Q#jq~O$T%QO~P+TO$Q%SO~P8lO#r%TO$T%WO~OY#maZ#maj#mak#mal#mam#man#mao#map#maq#mar#ma!p#ma#s#ma#t#ma$P#ma$U#ma$V#ma$W#ma$X#ma$Y#ma$Z#ma$[#ma$]#ma$^#ma$_#ma$`#ma$a#ma$b#ma$c#ma$d#ma~O$S$SO~P!!rO`%YOa%YO$S#ma~P!!rOg!POi!PO}!TO!g!TO!i!TO!j!TO!k!TO!l!TO#s!QO#t!QO#u#lq#v#lq#w#lq#x#lq#|#lq$T#lq~Oh#lq~P!%WOg#lqh#lqi#lq~P!%^Oh!OO~P!%WO#|#lq$T#lq~P%ZOg#lqh#lqi#lq}#lq!g#lq!i#lq!j#lq!k#lq!l#lq#u#lq#v#lq#w#lq#x#lq~O#s!QO#t!QO#|#lq$T#lq~P!'RO|%ZO~O$T%[O~O$S%]O~O$Q$hOg!bih!bii!bi}!bi!P!bi!V!bi!W!bi!Y!bi!g!bi!i!bi!j!bi!k!bi!l!bi#s!bi#t!bi#u!bi#v!bi#w!bi#x!bi#|!bi$T!bi$e!bi~O|%^O~Oz#^O~Og#dO$Q#dOh!cii!ci}!ci!P!ci!V!ci!W!ci!Y!ci!g!ci!i!ci!j!ci!k!ci!l!ci#s!ci#t!ci#u!ci#v!ci#w!ci#x!ci#|!ci$T!ci$e!ci~Oz%`O|%`O~Oz%eO$g%gO$h%hO$i%iO~O[$uO$T#`i~O$f%kO~O$T#`i~PLiO!h%nO~O!Y$sO$T#`i~O$T%pO~P7mO!Y$sO$T%pO$e#tO~O$T%rO~Oz%sO~O$T%tO~P+TO$Q%vO$T%wO~O$S$SOY#miZ#mij#mik#mil#mim#min#mio#mip#miq#mir#mi!p#mi#s#mi#t#mi$P#mi$U#mi$V#mi$W#mi$X#mi$Y#mi$Z#mi$[#mi$]#mi$^#mi$_#mi$`#mi$a#mi$b#mi$c#mi$d#mi~O$Q%yO~O|%zO~O$S%{O~Og#dOh#eO$Q#dO!Y#ci$e#ci$T#ci~O!Y$sO$T#`q~O$T#`q~PLiO[$uO!Y&OO$T#`q~Oe{Of{Og!}!Rh!}!Ri!}!R}!}!R!g!}!R!i!}!R!j!}!R!k!}!R!l!}!R#s!}!R#t!}!R#u!}!R#v!}!R#w!}!R#x!}!R#|!}!R$T!}!R$Q!}!R~Oe{Of{Og#j!Rh#j!Ri#j!R}#j!R!g#j!R!i#j!R!j#j!R!k#j!R!l#j!R#s#j!R#t#j!R#u#j!R#v#j!R#w#j!R#x#j!R#|#j!R$T#j!R$Q#j!R~O$T&RO~P+TO#r%TO$T&TO~O|&UO~O$T&VO~Oz&WO~O!Y$sO$T#`y~O[$uO$T#`y~OU$oO~O!Y&OO$T#`y~O$Q&ZO~O$T&[O~O!Y$sO$T#`!R~O|&^O~O$Q&_O~O|&`O~O$T&aO~OP!bOQ!aOR!dOS!cOT!cOW&bOX!iOb!kOc!lOd!mOz!`O$S!gO~O!Y&cO$Qva~P)lO!Y&cO$QvX~P#bOg&mOi&mO}&qO!g&qO!i&qO!j&qO!k&qO!l&qO#s&nO#t&nO#u#lq#v#lq#w#lq#x#lq$Q#lq~Oh#lq~P!7hOg#lqh#lqi#lq~P!7nOh&lO~P!7hOg&mOh&lOi&mO}&qO!g&qO!i&qO!j&qO!k&qO!l&qO#s&nO#t&nO#u&oO#v&oO#w&oO#x&pO~O$Q#lq~P!9UO#s&nO#t&nO$Q#lq~P!'RO",goto:"0e#|PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP#}$|%e&T&WPPPPPP&o'R'c'q(SPP(cP(f(kP(f(f(n(w(f)P)b)b)kPPPPPP)kP)bP(f(f)t)z(f(f*R*U(f*[*_*e+W+m,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,i,r-V-c-{.O.O.O.R.b+W.e+W.z/p0R0[0_PPPPPPP+W+W+W[WOR|!y$P%SQ$W!}Q$X#OS$Y#P&hQ$Z#QQ$[#RQ$]#SQ&r&fQ&s&gQ&t&iQ&u&jQ&v&kR&w!Vt^O|!V!y!}#O#P#Q#R#S$P%S&f&g&h&i&j&kRxRjQOR|!V!y!}#O#P#Q#R#S$P%SS!rz#zQ#w!s]&e&f&g&h&i&j&kRpPQoP^!fu!g#d#e#r$s&cQ#W!YS#k!l$mT#o!m$nQwQQ#s!rQ$t#vQ$x#wQ%o$wR&d&e[vQ!r#v#w$w&e]!ow#s$t$x%o&ditQw!r#s#v#w$t$w$x%o&d&ehsQw!r#s#v#w$t$w$x%o&d&eR!_tkrQtw!r#s#v#w$t$w$x%o&d&eR!^rV!nu#r&cR#]!aQ#`!aQ#a!bR$f#]U#_!a!b#]R%_$hU!hu#r&cQ#c!gQ$i#dQ$j#eR%l$s_!fu!g#d#e#r$s&c_!eu!g#d#e#r$s&cQ#i!jR&]&bS#h!j&bR%a$lR#m!lQ#l!lR%b$mR#q!mQ#p!mR%c$nj^O!}#O#P#Q#R#S&f&g&h&i&j&kQyRQ!w|Q#T!VQ$Q!yQ%R$PR%u%Sw]OR|!V!y!}#O#P#Q#R#S$P%S&f&g&h&i&j&kwTOR|!V!y!}#O#P#Q#R#S$P%S&f&g&h&i&j&kwSOR|!V!y!}#O#P#Q#R#S$P%S&f&g&h&i&j&kQ!tzQ#x!sR$}#zS#v!r#wW$q#s#u$x$yQ%j$pQ%q$zR%}%pQ$w#vQ%j$qQ&P%qR&X%}Q#u!rS$p#s$xQ$v#vQ$y#wS%m$t$wS%|%o%qR&Y&PR%f$oR%d$oQ}VQ$|#yQ%Q$OQ&Q%rR&R%tR#|!vwVOR|!V!y!}#O#P#Q#R#S$P%S&f&g&h&i&j&kQ!}!OQ#O!PQ#P!QQ#Q!RQ#R!SQ#S!TQ&f&lQ&g&mQ&h&nQ&i&oQ&j&pR&k&qh!{!O!P!Q!R!S!T&l&m&n&o&p&qR$V!|Q$T!zQ%X$UR%x%YR%U$SQ%V$SR&S%v",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap Ip LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch FilterOp Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter Number LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Add Sub Mul Div Mod Pow LiteralExpr LabelReplaceExpr VectorExpr",maxTerm:163,skippedNodes:[0,35],repeatNodeCount:0,tokenData:"5b~RvX^#ipq#iqr$^rs$qst%cuv%nxy%syz%xz{%}{|&S|}&X}!O&^!O!P(l!P!Q)l!Q!R)q!R![+X![!]2X!^!_2m!_!`2z!`!a3a!c!}3n!}#O4U#P#Q4Z#Q#R4`#R#S3n#S#T4e#T#o3n#o#p4q#p#q4v#q#r5]#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$O~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aQ!_!`$g#r#s$l~$lO}~~$qO!P~~$tUOY$qZr$qrs%Ws#O$q#O#P%]#P~$q~%]O|~~%`PO~$q~%hQs~OY%cZ~%c~%sO#w~~%xO$S~~%}O$T~~&SO#u~~&XO#s~~&^O$Q~~&cP#t~}!O&f~&iQ#_#`&o#g#h'|~&rP#X#Y&u~&xP#X#Y&{~'OP#d#e'R~'UP}!O'X~'[P#X#Y'_~'bP#a#b'e~'hP#d#e'k~'nP#h#i'q~'tP#m#n'w~'|O!]~~(PP#h#i(S~(VP#f#g(Y~(]P#]#^(`~(cP#V#W(f~(iP#h#i'w~(oP!Q![(r~(wR!p~!Q![(r!g!h)Q#X#Y)Q~)TR{|)^}!O)^!Q![)d~)aP!Q![)d~)iP!p~!Q![)d~)qO#v~~)ve!p~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#l#m1m#m#n1O~+^d!p~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#m#n1O~,oT{|)^}!O)^!Q![)d!d!e-O#]#^-T~-TO!n~~-WP#U#V-O~-^Q!d!e-O#]#^-T~-iP!h~!Q![-l~-oS!Q![-l#[#]-{#a#b.a#g#h/T~.QP!h~!Q![.T~.WR!Q![.T#a#b.a#g#h/T~.fQ!h~!Q![.l#g#h/O~.oR!Q![.l#a#b.x#g#h/T~.{P#g#h/O~/TO!h~~/YP!h~!Q![/]~/`Q!Q![/]#a#b.x~/iT{|)^}!O)^!Q![)d#U#V-O#]#^-T~/{Q#U#V-O#]#^-T~0WS!h~!Q![.l#U#V-O#]#^-T#g#h/O~0iP!h~!Q![0l~0oT!Q![0l#W#X-d#[#]-{#a#b.a#g#h/T~1TP!h~!Q![1W~1ZU!Q![1W#W#X-d#[#]-{#a#b.a#g#h/T#k#l0d~1pR!Q![1y!c!i1y#T#Z1y~2OR!p~!Q![1y!c!i1y#T#Z1yP2^TzP!Q![2X![!]2X!c!}2X#R#S2X#T#o2X~2rP!j~!_!`2u~2zO!k~~3PQ{~!_!`3V#r#s3[~3[O!l~~3aO!O~~3fP!g~!_!`3i~3nO!i~R3uTzP#rQ!Q![3n![!]2X!c!}3n#R#S3n#T#o3n~4ZO$e~~4`O$f~~4eO#x~~4hRO#S4e#S#T%W#T~4e~4vO$P~~4{Q!Y~!_!`5R#r#s5W~5WO!V~~5]O!W~~5bO$R~",tokenizers:[0,1],topRules:{LogQL:[0,36]},specialized:[{term:42,get:(P,x)=>c(P)<<1},{term:42,get:(P,x)=>F(P)<<1|1},{term:42,get:P=>W[P]||-1}],tokenPrec:0}),me=1,fe=2,xe=3,Ee=4,Re=5,Ue=6,st=7,Ct=8,ft=9,Mt=10,Pr=11,Dt=12,jt=13,gt=14,Er=15,xr=16,Qr=17,Vt=18,Lr=19,$r=20,Ot=21,ht=22,Kt=23,kt=24,Tr=25,Rr=26,Sr=27,_r=28,Fr=29,Cr=30,Nt=31,Mr=32,sa=33,ia=34,Gt=35,Zt=36,vt=37,it=38,ze=39,zt=40,bt=41,Qe=42,Dr=43,Te=44,K=45,Nr=46,Br=47,Fe=48,Ht=49,Bt=50,He=51,wt=52,Yt=53,Jt=54,yt=55,Pt=56,We=57,Et=58,qt=59,Ye=60,Je=61,Xe=62,le=63,er=64,Ie=65,xt=66,be=67,Qt=68,tr=69,Lt=70,wr=71,Xt=72,$t=73,Xr=74,It=75,rr=76,At=77,Be=78,qe=79,et=80,Ir=81,Tt=82,ot=83,ar=84,nr=85,sr=86,ir=87,or=88,lr=89,Ne=90,tt=91,Ve=92,Ar=93,Ur=94,Wr=95,ur=96,cr=97,mr=98,jr=99,Vr=100,Kr=101,kr=102,Gr=103,Rt=104,Ut=105,Zr=106,zr=107,lt=108,Ke=109,rt=110,at=111,ut=112,Hr=113,Yr=114,Jr=115,ke=116,qr=117,ct=118,St=119,_t=120,dr=121,pr=122,fr=123,gr=124,ea=125,ta=126,Or=127,hr=128,ra=129,aa=130,na=131,oa=132,nt=133,Ft=134,mt=135;function Ge(P,x){const C=[];return J.parse(P).iterate({enter:w=>{(x===void 0||x===w.type.id)&&C.push(w.node)}}),C[0]}function vr(P){return!Ge(P,d)}function we(P){return"  ".repeat(P)}function Ze(P,x){return P.split(`
`).map(M=>we(x)+M).join(`
`)}function br(P){return P.split(`
`).map(C=>C.trimEnd()).join(`
`)}function dt(P,x){const C=P.firstChild?.type.id===x;let M=!1;return P.firstChild&&C&&(M=!0,P=P.firstChild),{addBrackets:M,newNode:P}}function Ce(P,x){const C=[];let M=P.firstChild;for(;M;)x.includes(M.type.id)&&C.push(M),C.push(...Ce(M,x)),M=M.nextSibling;return C}function Ae(P,x,C){return x===P?` ${C}`:`
${we(1)}${C}`}function pt(P,x){let C=P.length-1;for(;C>=0&&x.includes(P[C]);)C--;return P.substring(0,C+1)}const s=(P,x)=>{const{addBrackets:C,newNode:M}=dt(P,it);P=M;const w=J.parse(x.substring(P.from,P.to));let ee="";return w.iterate({enter:ie=>{const oe=ie.node;switch(oe.type.id){case ze:ee+=t(oe,x);break;case Fe:oe.parent?.type.id!==Fe&&(ee+=e(oe,x));break}}}),C?"("+ee+")":ee};function t(P,x){const C=x.substring(P.from,P.to),M=J.parse(C),w=[];let ee="";return M.iterate({enter:ie=>{const oe=ie.node;oe.type.id===bt&&w.push(oe)}}),w.sort((ie,oe)=>{const Oe=ie.getChild(Qe),G=oe.getChild(Qe),de=Oe&&x.substring(Oe.from,Oe.to),Pe=G&&x.substring(G.from,G.to);return!de||!Pe?0:de<Pe?-1:de>Pe?1:0}),w.forEach(ie=>{const oe=ie.getChild(Qe),Oe=oe?oe.nextSibling:null,G=ie.getChild(Te),de=oe?x.substring(oe.from,oe.to):null,Pe=Oe?x.substring(Oe.from,Oe.to):null,De=G?x.substring(G.from,G.to):null;ee+=`${de}${Pe}${De}, `}),"{"+pt(ee,", ")+"}"}function e(P,x){const C=[He,Ye,We,Ie,Je,qe,et,ot];let M,w="";return Ce(P,C).forEach(ee=>{switch(ee.type.id){case He:w+=Ae(He,M,r(ee,x)),M=He;break;case Ye:w+=Ae(Ye,M,a(ee,x)),M=Ye;break;case We:w+=Ae(We,M,a(ee,x)),M=We;break;case Je:w+=Ae(Je,M,n(ee,x)),M=Je;break;case Ie:w+=Ae(Ie,M,l(ee,x)),M=Ie;break;case qe:w+=Ae(qe,M,p(ee,x)),M=qe;break;case et:w+=Ae(et,M,f(ee,x)),M=et;break;case ot:w+=Ae(ot,M,b()),M=ot;break}}),w}function r(P,x){const C=P.getChild(wt),M=P.getChild(yt),w=P.getChild(Te),ee=C&&x.substring(C.from,C.to),ie=w&&x.substring(w.from,w.to);return M?`${ee} ip(${ie})`:`${ee} ${ie}`}function a(P,x){if(P.getChild(Te)){const w=P.getChild(Re)||P.getChild(Ee),ee=P.getChild(Te),ie=w&&x.substring(w.from,w.to),oe=ee&&x.substring(ee.from,ee.to);return`| ${ie}${oe}`}return`| ${x.substring(P.from,P.to)}`}function n(P,x){const C=Ce(P,[le]);let M="";return C.forEach(w=>{const ee=w.getChild(Qe),ie=w.getChild(Te),oe=ee&&x.substring(ee.from,ee.to),Oe=ie&&x.substring(ie.from,ie.to);M+=`${oe}=${Oe}, `}),`| json ${pt(M,", ")}`}function l(P,x){const C=P.getChild(bt)||P.getChild(xt)||P.getChild(At)||P.getChild(be)?.getChild(Qt)||P.getChild(be)?.getChild(It);if(!C)return"";const M=C.type.id,w=C.getChild(Qe),ee=w&&w.nextSibling;let ie;M===Qt?ie=C.getChild(Lt):M===It?ie=C.getChild(rr):M===At?ie=C.getChild(Be):ie=C.getChild(Te);const oe=w&&x.substring(w.from,w.to),Oe=ee&&x.substring(ee.from,ee.to),G=ie&&x.substring(ie.from,ie.to);return M===xt?`| ${oe}${Oe}ip(${G})`:`| ${oe}${Oe}${G}`}function p(P,x){const C=P.getChild(Te);return`| line_format ${C&&x.substring(C.from,C.to)}`}function f(P,x){const C=Ce(P,[Tt]);let M="| label_format ";return C.forEach(w=>{let ee,ie;w.getChildren(Qe).length===2?[ee,ie]=w.getChildren(Qe):(ee=w.getChild(Qe),ie=w.getChild(Te));const oe=ee&&x.substring(ee.from,ee.to),Oe=ie&&x.substring(ie.from,ie.to);M+=`${oe}=${Oe}, `}),pt(M,", ")}function b(){return"| decolorize"}const $=(P,x)=>{const{addBrackets:C,newNode:M}=dt(P,Ne);P=M;let w="";const ee=P.firstChild;switch(ee&&ee.type.id){case tt:w=Y(P,x);break;case ct:w=se(P,x);break;case _t:w=ae(P,x);break;case nt:w=Le(P,x);break;case Ft:w=Se(P,x);break;case mt:w=_e(P,x);break}return C?"("+w+")":w};function Y(P,x){let C="";return Ce(P,[Ve,Be,lt,ke]).forEach(M=>{if(M.parent?.type.id===tt)switch(M.type.id){case Ve:C+=`${x.substring(M.from,M.to)}(
`;break;case Be:C+=`${we(1)+x.substring(M.from,M.to)},
`;break;case lt:C+=q(M,x);break;case ke:C+=V(M,x);break}}),C}function q(P,x){const C=[];let M="",w="",ee="",ie="",oe="";Ce(P,[ze,Ke,rt,at,Fe]).forEach(G=>{if(G.parent?.type.id===lt)switch(C.push(G),G.type.id){case ze:{let de=x.substring(G.from,G.to);M+=t({...G,from:0,to:de.length},de);break}case Fe:w+=e(G,x);break;case Ke:ee+=x.substring(G.from,G.to);break;case rt:{const de=G.getChild(Lt);ie+=` offset ${de?x.substring(de.from,de.to):""}`;break}case at:Ce(G,[Qe,ut,Ie]).forEach((de,Pe,De)=>{switch(de.type.id){case Qe:{if(de.parent?.type.id!==at||De.find(yr=>yr.type.id===ut))return;oe+=`| unwrap ${x.substring(de.from,de.to)} `;return}case ut:{const Wt=De.find(la=>la.type.id===Qe),yr=Wt?x.substring(Wt.from,Wt.to):"";oe+=`| unwrap ${x.substring(de.from,de.to)}(${yr}) `;return}case Ie:oe+=l(de,x);return}});break}});let Oe="";return C.forEach((G,de,Pe)=>{const De=Pe[de-1];G.type.id===ze&&(Oe+=we(1)+M),G.type.id===Fe&&(Oe+=Ze(w,1)),G.type.id===Ke&&(Oe+=`
`+we(1)+ee),G.type.id===rt&&(Oe+=ie),G.type.id===at&&(De?.type.id!==rt&&De?.type.id!==Ke?Oe+=`
`+we(1)+oe:Oe+=" "+oe)}),Oe+=`
)`}function V(P,x){let C="";const M=Ce(P,[Qe]).map(w=>x.substring(w.from,w.to));return Ce(P,[Ot,ht]).forEach(w=>{if(w.parent?.type.id===ke)switch(w.type.id){case Ot:C=` by (${M.join(", ")}) `;break;case ht:C=` without (${M.join(", ")}) `;break}}),C}function se(P,x){let C="";return Ce(P,[St,Be,Ne,ke]).forEach((M,w,ee)=>{if(M.parent?.type.id===ct)switch(M.type.id){case St:C+=`${x.substring(M.from,M.to)}`;break;case Be:C+=`(
`,C+=`${we(1)+x.substring(M.from,M.to)},
`;break;case Ne:{const ie=ee.find(G=>G.type.id===Be&&G.parent?.type.id===ct);C+=ie?"":`(
`;const oe=x.substring(M.from,M.to),Oe=Ge(oe,Ne);C+=Ze($(Oe,oe),1),C+=`
)`;break}case ke:C+=V(M,x);break}}),C}function ae(P,x){let C;const[M,w]=Ce(P,[vt]).map((ee,ie)=>{ie===0&&(C=x.substring(ee.nextSibling?.from??0,ee.nextSibling?.to));const oe=x.substring(ee.from,ee.to);let Oe;return vr(oe)?(Oe=Ge(oe,it),s(Oe,oe)):(Oe=Ge(oe,Ne),$(Oe,oe))});return M+`
`+C+`
`+w}function Le(P,x){P=P.getChild(nt)??P;const C=P.getChild(Or),M=P.getChild(hr),w=P.getChild(Be);return w?C?`+${x.substring(w.from,w.to)}`:M?`-${x.substring(w.from,w.to)}`:x.substring(w.from,w.to):""}function Se(P,x){let C=`label_replace(
`;return Ce(P,[Ne,Te]).forEach(M=>{if(M.parent?.type.id===Ft)if(M.type.id===Ne){const w=x.substring(M.from,M.to),ee=Ge(w,Ne);C+=Ze($(ee,w),1)+`,
`}else C+=we(1)+x.substring(M.from,M.to)+`,
`}),pt(C,`,
`)+`
)`}function _e(P,x){P=P.getChild(mt)??P;const C=P.getChild(Be);return C?`vector(${x.substring(C.from,C.to)})`:""}const je=P=>{const x=J.parse(P);let C="";return x.iterate({enter:M=>{const w=M.node;if(!(w.parent?.type.id!==vt||w.parent?.parent?.type.id===_t))switch(w.type.id){case Ne:return C=$(w,P),!1;case it:return C=s(w,P),!1}}}),br(C)}}}]);

//# sourceMappingURL=1569.js.map