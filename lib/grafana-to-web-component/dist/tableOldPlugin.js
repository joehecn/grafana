"use strict";(this.webpackChunkGrafanaToWebComponent=this.webpackChunkGrafanaToWebComponent||[]).push([[6784],{65395:(k,I,o)=>{o.d(I,{k:()=>$});var Y=o(86832),P=o.n(Y),p=o(10694),E=o(53305),x=o(71519),d=o(75041),L=o(65406);class $ extends d.q{constructor(h,c){super(h,c),this.skipDataOnInit=!1,this.dataList=[],this.useDataFrames=!1,this.panelDataObserver={next:b=>{if(this.panelData=b,b.state===p.Gu.Error&&(this.loading=!1,this.processDataError(b.error)),b.state===p.Gu.Loading){this.loading=!0,this.angularDirtyCheck();return}if(b.request){const{timeInfo:l}=b.request;l&&(this.timeInfo=l)}if(b.timeRange&&(this.range=b.timeRange),this.useDataFrames)this.handleDataFrames(b.series);else{const l=b.series.map(f=>(0,E.Zr)(f));this.handleQueryResult({data:l})}this.angularDirtyCheck()}},this.contextSrv=c.get("contextSrv"),this.datasourceSrv=c.get("datasourceSrv"),this.timeSrv=c.get("timeSrv"),this.templateSrv=c.get("templateSrv"),this.panel.datasource=this.panel.datasource||null,this.events.on(x.Kh.refresh,this.onMetricsPanelRefresh.bind(this)),this.events.on(x.Kh.panelTeardown,this.onPanelTearDown.bind(this)),this.events.on(x.Kh.componentDidMount,this.onMetricsPanelMounted.bind(this))}onMetricsPanelMounted(){const h=this.panel.getQueryRunner();this.querySubscription=h.getData({withTransforms:!0,withFieldConfig:!0}).subscribe(this.panelDataObserver)}onPanelTearDown(){this.querySubscription&&(this.querySubscription.unsubscribe(),this.querySubscription=null)}onMetricsPanelRefresh(){if(!this.otherPanelInFullscreenMode()){if(this.panel.snapshotData){this.updateTimeRange();let h=this.panel.snapshotData;return(0,Y.isArray)(h)||(h=h.data),this.panelData={state:p.Gu.Done,series:h,timeRange:this.range},this.$timeout(()=>{this.events.emit(x.Kh.dataSnapshotLoad,h)})}return delete this.error,this.loading=!0,this.datasourceSrv.get(this.panel.datasource,this.panel.scopedVars).then(this.issueQueries.bind(this)).catch(h=>{this.processDataError(h)})}}processDataError(h){if(h.cancelled){console.log("Panel request cancelled",h);return}this.error=h.message||"Request Error",h.data&&(h.data.message?this.error=h.data.message:h.data.error&&(this.error=h.data.error)),this.angularDirtyCheck()}angularDirtyCheck(){this.$scope.$root.$$phase||this.$scope.$digest()}updateTimeRange(h){this.datasource=h||this.datasource,this.range=this.timeSrv.timeRange();const c=(0,L.W1)(this.panel,this.range);this.timeInfo=c.timeInfo,this.range=c.timeRange}issueQueries(h){this.updateTimeRange(h),this.datasource=h;const c=this.panel;return c.getQueryRunner().run({datasource:c.datasource,queries:c.targets,panelId:c.id,dashboardUID:this.dashboard.uid,timezone:this.dashboard.getTimezone(),timeInfo:this.timeInfo,timeRange:this.range,maxDataPoints:c.maxDataPoints||this.width,minInterval:c.interval,scopedVars:c.scopedVars,cacheTimeout:c.cacheTimeout,queryCachingTTL:c.queryCachingTTL,transformations:c.transformations})}handleDataFrames(h){this.loading=!1,this.dashboard&&this.dashboard.snapshot&&(this.panel.snapshotData=h.map(c=>(0,E.og)(c)));try{this.events.emit(x.Kh.dataFramesReceived,h)}catch(c){this.processDataError(c)}}handleQueryResult(h){this.loading=!1,this.dashboard.snapshot&&(this.panel.snapshotData=h.data),(!h||!h.data)&&(console.log("Data source query result invalid, missing data field:",h),h={data:[]});try{this.events.emit(x.Kh.dataReceived,h.data)}catch(c){this.processDataError(c)}}}},75041:(k,I,o)=>{o.d(I,{q:()=>c});var Y=o(86832),P=o(91395),p=o(71519),E=o(14255),x=o(69307),d=o(13601);const L={http:80,https:443,ftp:21};class ${constructor(){this.absUrl=this.wrapInDeprecationWarning(this.absUrl),this.hash=this.wrapInDeprecationWarning(this.hash),this.host=this.wrapInDeprecationWarning(this.host),this.path=this.wrapInDeprecationWarning(this.path),this.port=this.wrapInDeprecationWarning(this.port,"window.location"),this.protocol=this.wrapInDeprecationWarning(this.protocol,"window.location"),this.replace=this.wrapInDeprecationWarning(this.replace),this.search=this.wrapInDeprecationWarning(this.search),this.state=this.wrapInDeprecationWarning(this.state),this.url=this.wrapInDeprecationWarning(this.url)}wrapInDeprecationWarning(l,f){let g=this;return function(){return(0,E.d)("$location",l.name,f||"locationService"),l.apply(g,arguments)}}absUrl(){return`${window.location.origin}${this.url()}`}hash(l){if((0,d.GQ)("AngularLocationWrapper",!1,"Angular compat layer: hash"),l)throw new Error("AngularLocationWrapper method not implemented.");return d.E1.getLocation().hash.slice(1)}host(){return new URL(window.location.href).hostname}path(l){(0,d.GQ)("AngularLocationWrapper",!1,"Angular compat layer: path");const f=d.E1.getLocation();if(l!=null){let g=String(l);g=g.startsWith("/")?g:`/${g}`;const M=new URL(`${window.location.origin}${g}`);return d.E1.push({pathname:M.pathname,search:M.search.length>0?M.search:f.search,hash:M.hash.length>0?M.hash:f.hash}),this}return l===null?(d.E1.push("/"),this):f.pathname}port(){const l=new URL(window.location.href);return parseInt(l.port,10)||L[l.protocol]||null}protocol(){return new URL(window.location.href).protocol.slice(0,-1)}replace(){throw new Error("AngularLocationWrapper method not implemented.")}search(l,f){if((0,d.GQ)("AngularLocationWrapper",!1,"Angular compat layer: search"),!l)return d.E1.getSearchObject();if(l&&arguments.length>1)return d.E1.partial({[l]:f}),this;if(l){let g;typeof l=="object"?g={...l}:g=(0,d.Ox)(l);for(const S of Object.keys(g))(g[S]===null||g[S]===void 0)&&delete g[S];const M=x.Cj.renderUrl(d.E1.getLocation().pathname,g);d.E1.push(M)}return this}state(l){throw(0,d.GQ)("AngularLocationWrapper",!1,"Angular compat layer: state"),new Error("AngularLocationWrapper method not implemented.")}url(l){if((0,d.GQ)("AngularLocationWrapper",!1,"Angular compat layer: url"),l!==void 0)return l.startsWith("#")?d.E1.push({...d.E1.getLocation(),hash:l}):l.startsWith("?")?d.E1.push({...d.E1.getLocation(),search:l}):l.trim().length===0?d.E1.push("/"):d.E1.push(l),d.E1;const f=d.E1.getLocation();return`${f.pathname}${f.search}${f.hash}`}}var A=o(50820),h=o(21308);class c{constructor(l,f){this.pluginName="",this.pluginId="",this.editModeInitiated=!1,this.loading=!1,this.onPluginTypeChange=M=>{},this.panel=this.panel??l.$parent.panel,this.dashboard=this.dashboard??l.$parent.dashboard,this.$injector=f,this.$scope=l,this.$timeout=f.get("$timeout"),this.editorTabs=[],this.$location=new $,this.events=new P.F,this.timing={};const g=A.default.panels[this.panel.type];g&&(this.pluginId=g.id,this.pluginName=g.name),l.$on(p.Kh.componentDidMount.name,()=>this.panelDidMount())}panelDidMount(){this.events.emit(p.Kh.componentDidMount),this.events.emit(p.Kh.initialized),this.dashboard.panelInitialized(this.panel)}renderingCompleted(){h.rv.renderingCompleted()}refresh(){this.panel.refresh()}publishAppEvent(l,f){this.$scope.$root.appEvent(l,f)}initEditMode(){this.editModeInitiated||(this.editModeInitiated=!0,this.events.emit(p.Kh.editModeInitialized))}addEditorTab(l,f,g,M){const S={title:l,directiveFn:f,icon:M};(0,Y.isString)(f)&&(S.directiveFn=()=>({templateUrl:f})),g?this.editorTabs.splice(g,0,S):this.editorTabs.push(S)}getExtendedMenu(){const l=[];return this.events.emit(p.Kh.initPanelActions,l),l}async getAdditionalMenuItems(){return[]}otherPanelInFullscreenMode(){return this.dashboard.otherPanelInFullscreen(this.panel)}render(l){this.events.emit(p.Kh.render,l)}}},50876:(k,I,o)=>{o.r(I),o.d(I,{TablePanelCtrl:()=>z,plugin:()=>Q});var Y=o(6033),P=o.n(Y),p=o(86832),E=o(71519),x=o(53305),d=o(40530),L=o(50820),$=o(75247),A=o(20510),h=o(65395),c=o(75041);class b{constructor(e,t){this.$scope=e,this.$injector=t,this.panelCtrl=this.panelCtrl??e.ctrl.panelCtrl,this.target=this.target??e.ctrl.target,this.datasource=this.datasource??e.ctrl.datasource,this.panel=this.panelCtrl?.panel??e.ctrl.panelCtrl.panel,this.isLastQuery=(0,p.indexOf)(this.panel.targets,this.target)===this.panel.targets.length-1}refresh(){this.panelCtrl.refresh()}}const l=(0,A.s)(c.q),f=(0,A.s)(h.k),g=(0,A.s)(b);var M=o(74600),S=o(83502);const B=class{constructor(a){a.editor=this,this.activeStyleIndex=0,this.panelCtrl=a.ctrl,this.panel=this.panelCtrl.panel,this.unitFormats=(0,S.QW)(),this.colorModes=[{text:"Disabled",value:null},{text:"Cell",value:"cell"},{text:"Value",value:"value"},{text:"Row",value:"row"}],this.columnTypes=[{text:"Number",value:"number"},{text:"String",value:"string"},{text:"Date",value:"date"},{text:"Hidden",value:"hidden"}],this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.dateFormats=[{text:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{text:"YYYY-MM-DD HH:mm:ss.SSS",value:"YYYY-MM-DD HH:mm:ss.SSS"},{text:"MM/DD/YY h:mm:ss a",value:"MM/DD/YY h:mm:ss a"},{text:"MMMM D, YYYY LT",value:"MMMM D, YYYY LT"},{text:"YYYY-MM-DD",value:"YYYY-MM-DD"}],this.mappingTypes=[{text:"Value to text",value:1},{text:"Range to text",value:2}],this.alignTypes=B.alignTypesEnum,this.getColumnNames=()=>this.panelCtrl.table?(0,p.map)(this.panelCtrl.table.columns,e=>e.text):[],this.onColorChange=this.onColorChange.bind(this)}render(){this.panelCtrl.render()}setUnitFormat(a){return e=>{a.unit=e,this.panelCtrl.render()}}addColumnStyle(){const a={unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"",dateFormat:"YYYY-MM-DD HH:mm:ss",thresholds:[],mappingType:1,align:"auto"},e=this.panel.styles,t=e.length;let s=t;t>0&&e[t-1].pattern==="/.*/"&&(s=t-1),e.splice(s,0,a),this.activeStyleIndex=s}removeColumnStyle(a){this.panel.styles=(0,p.without)(this.panel.styles,a)}invertColorOrder(a){const e=this.panel.styles[a].colors,t=e[0];e[0]=e[2],e[2]=t,this.panelCtrl.render()}onColorChange(a,e){return t=>{a.colors[e]=t,this.render()}}addValueMap(a){a.valueMaps||(a.valueMaps=[]),a.valueMaps.push({value:"",text:""}),this.panelCtrl.render()}removeValueMap(a,e){a.valueMaps.splice(e,1),this.panelCtrl.render()}addRangeMap(a){a.rangeMaps||(a.rangeMaps=[]),a.rangeMaps.push({from:"",to:"",text:""}),this.panelCtrl.render()}removeRangeMap(a,e){a.rangeMaps.splice(e,1),this.panelCtrl.render()}};let W=B;W.alignTypesEnum=[{text:"auto",value:""},{text:"left",value:"left"},{text:"center",value:"center"},{text:"right",value:"right"}],W.$inject=["$scope"];function tt(){"use strict";return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/column_options.html",controller:W}}var G=o(94162),et=o(24796),Z=o(57804);const w={},N=a=>Array.isArray(a)?a.reduce((e,t)=>t.datapoints?e.concat(t):e,[]):a.datapoints?[a]:[],J=a=>Array.isArray(a)?a.reduce((e,t)=>t.columns?e.concat(t):e,[]):a.columns?[a]:[];w.timeseries_to_rows={description:"Time series to rows",getColumns:()=>[],transform:(a,e,t)=>{t.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];const s=N(a);for(let r=0;r<s.length;r++){const n=s[r];for(let i=0;i<n.datapoints.length;i++){const u=n.datapoints[i];t.rows.push([u[1],n.target,u[0]])}}}},w.timeseries_to_columns={description:"Time series to columns",getColumns:()=>[],transform:(a,e,t)=>{t.columns.push({text:"Time",type:"date"});const s={},r=N(a);for(let n=0;n<r.length;n++){const i=r[n];t.columns.push({text:i.target});for(let u=0;u<i.datapoints.length;u++){const m=i.datapoints[u],v=m[1].toString();s[v]||(s[v]={time:m[1]}),s[v][n]=m[0]}}for(const n in s){const i=s[n],u=[i.time];for(let m=0;m<r.length;m++){const v=i[m];u.push(v)}t.rows.push(u)}}},w.timeseries_aggregations={description:"Time series aggregations",getColumns:()=>[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}],transform:(a,e,t)=>{let s,r;for(t.columns.push({text:"Metric"}),s=0;s<e.columns.length;s++)t.columns.push({text:e.columns[s].text});const n=N(a);for(s=0;s<n.length;s++){const i=new et.Z({datapoints:n[s].datapoints,alias:n[s].target});i.getFlotPairs("connected");const u=[i.alias];for(r=0;r<e.columns.length;r++)u.push(i.stats[e.columns[r].value]);t.rows.push(u)}}},w.annotations={description:"Annotations",getColumns:()=>[],transform:(a,e,t)=>{if(t.columns.push({text:"Time",type:"date"}),t.columns.push({text:"Title"}),t.columns.push({text:"Text"}),t.columns.push({text:"Tags"}),!(!a||!a.annotations||a.annotations.length===0))for(let s=0;s<a.annotations.length;s++){const r=a.annotations[s];t.rows.push([r.time,r.title,r.text,r.tags])}}},w.table={description:"Table",getColumns:a=>{if(!a||a.length===0)return[];if(a.length===1)return[...a[0].columns];const e=J(a),t={};return e.reduce((r,n)=>(n.columns.forEach(i=>{const{text:u}=i;t[u]===void 0&&(t[u]=r.length,r.push(i))}),r),[])},transform:(a,e,t)=>{if(!a||a.length===0)return;const s=J(a),r=(0,p.findIndex)(s,n=>"columns"in n&&"rows"in n);if(r<0)throw{message:`Result of query #${String.fromCharCode(65+r)} is not in table format, try using another transform.`};(0,G.M)(t,...s)}},w.json={description:"JSON Data",getColumns:a=>{if(!a||a.length===0)return[];const e={};for(let t=0;t<a.length;t++){const s=a[t];if(s.type!=="docs")continue;const r=Math.min(s.datapoints.length,100);for(let n=0;n<r;n++){const i=s.datapoints[n],u=(0,Z.default)(i,{});for(const m in u)e[m]=!0}}return(0,p.map)(e,(t,s)=>({text:s,value:s}))},transform:(a,e,t)=>{let s,r,n;for(const i of e.columns){const u={text:i.text};a.length>0&&a[0].filterable&&(u.filterable=!0),t.columns.push(u)}for(t.columns.length===0&&t.columns.push({text:"JSON"}),s=0;s<a.length;s++){const i=a[s];for(r=0;r<i.datapoints.length;r++){const u=i.datapoints[r],m=[];if((0,p.isObject)(u)&&e.columns.length>0){const v=(0,Z.default)(u);for(n=0;n<e.columns.length;n++)m.push(v[e.columns[n].value])}else m.push(JSON.stringify(u));t.rows.push(m)}}}};function st(a,e){const t=new G.Z;if(!a||a.length===0)return t;const s=w[e.transform];if(!s)throw{message:"Transformer "+e.transform+" not found"};return s.transform(a,e,t),t}class X{constructor(e,t){this.uiSegmentSrv=t,this.canSetColumns=!1,this.columnsHelpMessage="",e.editor=this,this.panelCtrl=e.ctrl,this.panel=this.panelCtrl.panel,this.transformers=w,this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.addColumnSegment=t.newPlusButton(),this.updateTransformHints()}updateTransformHints(){switch(this.canSetColumns=!1,this.columnsHelpMessage="",this.panel.transform){case"timeseries_aggregations":{this.canSetColumns=!0;break}case"json":{this.canSetColumns=!0;break}case"table":this.columnsHelpMessage="Columns and their order are determined by the data query"}}getColumnOptions(){if(!this.panelCtrl.dataRaw)return Promise.resolve([]);const e=this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),t=(0,p.map)(e,s=>this.uiSegmentSrv.newSegment({value:s.text}));return Promise.resolve(t)}addColumn(){const e=w[this.panel.transform].getColumns(this.panelCtrl.dataRaw),t=(0,p.find)(e,{text:this.addColumnSegment.value});t&&(this.panel.columns.push(t),this.render());const s=this.uiSegmentSrv.newPlusButton();this.addColumnSegment.html=s.html,this.addColumnSegment.value=s.value}transformChanged(){this.panel.columns=[],this.panel.transform==="annotations"?this.panelCtrl.refresh():(this.panel.transform==="timeseries_aggregations"&&this.panel.columns.push({text:"Avg",value:"avg"}),this.updateTransformHints(),this.render())}render(){this.panelCtrl.render()}removeColumn(e){this.panel.columns=(0,p.without)(this.panel.columns,e),this.panelCtrl.render()}}X.$inject=["$scope","uiSegmentSrv"];function nt(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/editor.html",controller:X}}var O=o(55705),K=o(28425),q=o(48069),at=o(79059);class rt{constructor(e,t,s,r,n=(0,at.J)(),i){this.panel=e,this.table=t,this.timeZone=s,this.sanitize=r,this.templateSrv=n,this.theme=i,this.formatters=[],this.initColumns()}setTable(e){this.table=e,this.initColumns()}initColumns(){this.formatters=[],this.colorState={};for(let e=0;e<this.table.columns.length;e++){const t=this.table.columns[e];t.title=t.text;for(let s=0;s<this.panel.styles.length;s++){const r=this.panel.styles[s],n=(0,O.oH)(r.pattern)?r.pattern:(0,O.GE)((0,O.x6)(r.pattern)),i=(0,O.jO)(n);if(t.text.match(i)){t.style=r,r.alias&&(t.title=K.QX.escapeHtml(t.text.replace(i,r.alias)));break}}this.formatters[e]=this.createColumnFormatter(t)}}getColorForValue(e,t){if(!t.thresholds||!t.colors)return null;for(let s=t.thresholds.length;s>0;s--)if(e>=t.thresholds[s-1])return this.theme.visualization.getColorByName(t.colors[s]);return this.theme.visualization.getColorByName((0,p.first)(t.colors))}defaultCellFormatter(e,t){return e==null||e===void 0?"":((0,p.isArray)(e)&&(e=e.join(", ")),t&&t.sanitize?this.sanitize(e):(0,p.escape)(e))}createColumnFormatter(e){if(!e.style)return this.defaultCellFormatter;if(e.style.type==="hidden")return t=>{};if(e.style.type==="date")return t=>t==null?"-":((0,p.isArray)(t)&&(t=t[0]),(0,p.isString)(t)&&!isNaN(t)&&t.length>12&&(t=parseInt(t,10)),e.style.dateFormat?(0,q.dq)(t,{format:e.style.dateFormat,timeZone:this.timeZone}):(0,q.lf)(t,{timeZone:this.timeZone}));if(e.style.type==="string")return t=>{(0,p.isArray)(t)&&(t=t.join(", "));const s=e.style.mappingType||0;if(s===1&&e.style.valueMaps)for(let r=0;r<e.style.valueMaps.length;r++){const n=e.style.valueMaps[r];if(t===null){if(n.value==="null")return n.text;continue}if(!(0,p.isString)(t)&&Number(n.value)===Number(t)||n.value===t)return this.setColorState(t,e.style),this.defaultCellFormatter(n.text,e.style)}if(s===2&&e.style.rangeMaps)for(let r=0;r<e.style.rangeMaps.length;r++){const n=e.style.rangeMaps[r];if(t===null){if(n.from==="null"&&n.to==="null")return n.text;continue}if(Number(n.from)<=Number(t)&&Number(n.to)>=Number(t))return this.setColorState(t,e.style),this.defaultCellFormatter(n.text,e.style)}return t==null?"-":(this.setColorState(t,e.style),this.defaultCellFormatter(t,e.style))};if(e.style.type==="number"){const t=(0,S.Cf)(e.unit||e.style.unit);return s=>s==null?"-":isNaN(s)||(0,p.isArray)(s)?this.defaultCellFormatter(s,e.style):(this.setColorState(s,e.style),(0,S.zc)(t(s,e.style.decimals,null)))}return t=>this.defaultCellFormatter(t,e.style)}setColorState(e,t){if(!t.colorMode||e==null||(0,p.isArray)(e))return;const s=Number(e);isNaN(s)||(this.colorState[t.colorMode]=this.getColorForValue(s,t))}renderRowVariables(e){const t={};let s;const r=this.table.rows[e];for(let n=0;n<r.length;n++)s=`__cell_${n}`,t[s]={value:r[n],text:r[n]?r[n].toString():""};return t}formatColumnValue(e,t){const s=this.formatters[e];return s?s(t):t}renderCell(e,t,s,r=!1){s=this.formatColumnValue(e,s);const n=this.table.columns[e],i=[];let u="";const m=[];let v="";this.colorState.cell?(i.push("background-color:"+this.colorState.cell),m.push("table-panel-color-cell"),this.colorState.cell=null):this.colorState.value&&(i.push("color:"+this.colorState.value),this.colorState.value=null);let C="";if(r&&(C='<div class="table-panel-width-hack">'+this.table.columns[e].title+"</div>"),s===void 0?(i.push("display:none"),n.hidden=!0):n.hidden=!1,n.hidden===!0)return"";if(n.style&&n.style.preserveFormat&&m.push("table-panel-cell-pre"),n.style&&n.style.align){const D=(0,p.find)(W.alignTypesEnum,["text",n.style.align]);D&&D.value&&i.push(`text-align:${D.value}`)}if(i.length&&(u=' style="'+i.join(";")+'"'),n.style&&n.style.link){const D=this.renderRowVariables(t);D.__cell={value:s,text:s?s.toString():""};const R=this.templateSrv.replace(n.style.linkUrl,D,encodeURIComponent),U=K.QX.sanitizeUrl(R),V=K.QX.escapeHtml(this.templateSrv.replace(n.style.linkTooltip,D)),y=n.style.linkTargetBlank?"_blank":"";m.push("table-panel-cell-link"),C+=`<a href="${U}" target="${y}" data-link-tooltip data-original-title="${V}" data-placement="right"${u}>`,C+=`${s}`,C+="</a>"}else C+=s;return n.filterable&&(m.push("table-panel-cell-filterable"),C+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter out value" data-placement="bottom"
           data-row="${t}" data-column="${e}" data-operator="!=">`,C+='<i class="fa fa-search-minus"></i>',C+="</a>",C+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter for value" data-placement="bottom"
           data-row="${t}" data-column="${e}" data-operator="=">`,C+='<i class="fa fa-search-plus"></i>',C+="</a>"),m.length&&(v=' class="'+m.join(" ")+'"'),C="<td"+v+u+">"+C+"</td>",C}render(e){const t=this.panel.pageSize||100,s=e*t,r=Math.min(s+t,this.table.rows.length);let n="";for(let i=s;i<r;i++){const u=this.table.rows[i];let m="",v="";const C=[];let D="";for(let R=0;R<this.table.columns.length;R++)m+=this.renderCell(R,i,u[R],i===s);this.colorState.row&&(v=' style="background-color:'+this.colorState.row+'"',C.push("table-panel-color-row"),this.colorState.row=null),C.length&&(D=' class="'+C.join(" ")+'"'),n+="<tr "+D+v+">"+m+"</tr>"}return n}render_values(){const e=[],t=this.table.columns.filter(s=>!s.hidden);for(let s=0;s<this.table.rows.length;s++){const r=this.table.rows[s],n=[];for(let i=0;i<this.table.columns.length;i++)this.table.columns[i].hidden||n.push(this.formatColumnValue(i,r[i]));e.push(n)}return{columns:t,rows:e}}}class z extends f{constructor(e,t,s,r){super(e,t),this.annotationsSrv=s,this.$sanitize=r,this.panelDefaults={targets:[{}],transform:"timeseries_to_columns",pageSize:null,showHeader:!0,styles:[{type:"date",pattern:"Time",alias:"Time",dateFormat:"YYYY-MM-DD HH:mm:ss",align:"auto"},{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"/.*/",thresholds:[],align:"right"}],columns:[],fontSize:"100%",sort:{col:0,desc:!0}},this.pageIndex=0,this.panel.styles===void 0&&(this.panel.styles=this.panel.columns,this.panel.columns=this.panel.fields,delete this.panel.columns,delete this.panel.fields),(0,p.defaults)(this.panel,this.panelDefaults),this.panelHasRowColorMode=!!this.panel.styles.find(n=>n.colorMode==="row"),this.panelHasLinks=!!this.panel.styles.find(n=>n.link),this.events.on(E.Kh.dataReceived,this.onDataReceived.bind(this)),this.events.on(E.Kh.dataSnapshotLoad,this.onDataReceived.bind(this)),this.events.on(E.Kh.editModeInitialized,this.onInitEditMode.bind(this))}onInitEditMode(){this.addEditorTab("Options",nt,2),this.addEditorTab("Column Styles",tt,3)}migrateToPanel(e){this.onPluginTypeChange(L.default.panels[e])}issueQueries(e){return this.pageIndex=0,this.panel.transform==="annotations"?this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}).then(t=>(this.loading=!1,this.dataRaw=t,this.pageIndex=0,this.render(),{data:this.dataRaw})):super.issueQueries(e)}onDataReceived(e){this.dataRaw=e,this.pageIndex=0,this.dataRaw&&this.dataRaw.length&&((0,x.Ji)(this.dataRaw[0])?this.panel.transform="table":this.dataRaw[0].type==="docs"?this.panel.transform="json":(this.panel.transform==="table"||this.panel.transform==="json")&&(this.panel.transform="timeseries_to_rows")),this.render()}render(){return this.table=st(this.dataRaw,this.panel),this.table.sort(this.panel.sort),this.renderer=new rt(this.panel,this.table,this.dashboard.getTimezone(),this.$sanitize,this.templateSrv,L.default.theme2),super.render(this.table)}toggleColumnSort(e,t){this.table.columns[this.panel.sort.col]&&(this.table.columns[this.panel.sort.col].sort=!1),this.panel.sort.col===t?this.panel.sort.desc?this.panel.sort.desc=!1:this.panel.sort.col=null:(this.panel.sort.col=t,this.panel.sort.desc=!0),this.render()}link(e,t,s,r){let n;const i=r.panel;let u=0;function m(){let y=r.height;return u>1&&(y-=26),y-31+"px"}function v(y){r.renderer.setTable(n),y.empty(),y.html(r.renderer.render(r.pageIndex))}function C(y){const T=P()(y.currentTarget);r.pageIndex=parseInt(T.text(),10)-1,R()}function D(y){y.empty();const T=i.pageSize||100;if(u=Math.ceil(n.rows.length/T),u===1)return;const F=Math.max(r.pageIndex-3,0),j=Math.min(u,F+9),_=P()("<ul></ul>");for(let H=F;H<j;H++){const it=H===r.pageIndex?"active":"",lt=P()('<li><a class="table-panel-page-link pointer '+it+'">'+(H+1)+"</a></li>");_.append(lt)}y.append(_)}function R(){const y=t.parents(".panel-content"),T=t.find(".table-panel-scroll"),F=t.find("tbody"),j=t.find(".table-panel-footer");t.css({"font-size":i.fontSize}),y.addClass("table-panel-content"),v(F),D(j),T.css({"max-height":m()})}t.tooltip({selector:"[data-link-tooltip]"});function U(y){const T=P()(y.currentTarget).data(),F={datasource:i.datasource,key:n.columns[T.column].text,value:n.rows[T.row][T.column],operator:T.operator};(0,M.WI)((0,$.m2)(F))}t.on("click",".table-panel-page-link",C),t.on("click",".table-panel-filter-link",U);const V=e.$on("$destroy",()=>{t.off("click",".table-panel-page-link"),t.off("click",".table-panel-filter-link"),V()});r.events.on(E.Kh.render,y=>{n=y||n,n&&R(),r.renderingCompleted()})}}z.templateUrl="module.html",z.$inject=["$scope","$injector","annotationsSrv","$sanitize"];const Q=new d.c(null);Q.angularPanelCtrl=z,Q.setNoPadding()}}]);

//# sourceMappingURL=tableOldPlugin.js.map